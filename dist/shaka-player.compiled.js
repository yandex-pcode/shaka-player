/*! mp4box 23-06-2020 */

var Log=function(){var i=new Date,r=4;return{setLogLevel:function(t){r=t==this.debug?1:t==this.info?2:t==this.warn?3:(this.error,4)},debug:function(t,e){void 0===console.debug&&(console.debug=console.log),r<=1&&console.debug("["+Log.getDurationString(new Date-i,1e3)+"]","["+t+"]",e)},log:function(t,e){this.debug(t.msg)},info:function(t,e){r<=2&&console.info("["+Log.getDurationString(new Date-i,1e3)+"]","["+t+"]",e)},warn:function(t,e){r<=3&&console.warn("["+Log.getDurationString(new Date-i,1e3)+"]","["+t+"]",e)},error:function(t,e){r<=4&&console.error("["+Log.getDurationString(new Date-i,1e3)+"]","["+t+"]",e)}}}();Log.getDurationString=function(t,e){var i;function r(t,e){for(var i=(""+t).split(".");i[0].length<e;)i[0]="0"+i[0];return i.join(".")}t<0?(i=!0,t=-t):i=!1;var s=t/(e||1),a=Math.floor(s/3600);s-=3600*a;var n=Math.floor(s/60),o=1e3*(s-=60*n);return o-=1e3*(s=Math.floor(s)),o=Math.floor(o),(i?"-":"")+a+":"+r(n,2)+":"+r(s,2)+"."+r(o,3)},Log.printRanges=function(t){var e=t.length;if(0<e){for(var i="",r=0;r<e;r++)0<r&&(i+=","),i+="["+Log.getDurationString(t.start(r))+","+Log.getDurationString(t.end(r))+"]";return i}return"(empty)"},"undefined"!=typeof exports&&(exports.Log=Log);var MP4BoxStream=function(t){if(!(t instanceof ArrayBuffer))throw"Needs an array buffer";this.buffer=t,this.dataview=new DataView(t),this.position=0};MP4BoxStream.prototype.getPosition=function(){return this.position},MP4BoxStream.prototype.getEndPosition=function(){return this.buffer.byteLength},MP4BoxStream.prototype.getLength=function(){return this.buffer.byteLength},MP4BoxStream.prototype.seek=function(t){var e=Math.max(0,Math.min(this.buffer.byteLength,t));return this.position=isNaN(e)||!isFinite(e)?0:e,!0},MP4BoxStream.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},MP4BoxStream.prototype.readAnyInt=function(t,e){var i=0;if(this.position+t<=this.buffer.byteLength){switch(t){case 1:i=e?this.dataview.getInt8(this.position):this.dataview.getUint8(this.position);break;case 2:i=e?this.dataview.getInt16(this.position):this.dataview.getUint16(this.position);break;case 3:if(e)throw"No method for reading signed 24 bits values";i=this.dataview.getUint8(this.position)<<16,i|=this.dataview.getUint8(this.position)<<8,i|=this.dataview.getUint8(this.position);break;case 4:i=e?this.dataview.getInt32(this.position):this.dataview.getUint32(this.position);break;case 8:if(e)throw"No method for reading signed 64 bits values";i=this.dataview.getUint32(this.position)<<32,i|=this.dataview.getUint32(this.position);break;default:throw"readInt method not implemented for size: "+t}return this.position+=t,i}throw"Not enough bytes in buffer"},MP4BoxStream.prototype.readUint8=function(){return this.readAnyInt(1,!1)},MP4BoxStream.prototype.readUint16=function(){return this.readAnyInt(2,!1)},MP4BoxStream.prototype.readUint24=function(){return this.readAnyInt(3,!1)},MP4BoxStream.prototype.readUint32=function(){return this.readAnyInt(4,!1)},MP4BoxStream.prototype.readUint64=function(){return this.readAnyInt(8,!1)},MP4BoxStream.prototype.readString=function(t){if(this.position+t<=this.buffer.byteLength){for(var e="",i=0;i<t;i++)e+=String.fromCharCode(this.readUint8());return e}throw"Not enough bytes in buffer"},MP4BoxStream.prototype.readCString=function(){for(var t=[];;){var e=this.readUint8();if(0===e)break;t.push(e)}return String.fromCharCode.apply(null,t)},MP4BoxStream.prototype.readInt8=function(){return this.readAnyInt(1,!0)},MP4BoxStream.prototype.readInt16=function(){return this.readAnyInt(2,!0)},MP4BoxStream.prototype.readInt32=function(){return this.readAnyInt(4,!0)},MP4BoxStream.prototype.readInt64=function(){return this.readAnyInt(8,!1)},MP4BoxStream.prototype.readUint8Array=function(t){for(var e=new Uint8Array(t),i=0;i<t;i++)e[i]=this.readUint8();return e},MP4BoxStream.prototype.readInt16Array=function(t){for(var e=new Int16Array(t),i=0;i<t;i++)e[i]=this.readInt16();return e},MP4BoxStream.prototype.readUint16Array=function(t){for(var e=new Int16Array(t),i=0;i<t;i++)e[i]=this.readUint16();return e},MP4BoxStream.prototype.readUint32Array=function(t){for(var e=new Uint32Array(t),i=0;i<t;i++)e[i]=this.readUint32();return e},MP4BoxStream.prototype.readInt32Array=function(t){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=this.readInt32();return e},"undefined"!=typeof exports&&(exports.MP4BoxStream=MP4BoxStream);var DataStream=function(t,e,i){this._byteOffset=e||0,t instanceof ArrayBuffer?this.buffer=t:"object"==typeof t?(this.dataView=t,e&&(this._byteOffset+=e)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=null==i?DataStream.LITTLE_ENDIAN:i};DataStream.prototype={},DataStream.prototype.getPosition=function(){return this.position},DataStream.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,i=this._buffer.byteLength;if(e<=i)e>this._byteLength&&(this._byteLength=e);else{for(i<1&&(i=1);i<e;)i*=2;var r=new ArrayBuffer(i),s=new Uint8Array(this._buffer);new Uint8Array(r,0,s.length).set(s),this.buffer=r,this._byteLength=e}}},DataStream.prototype._trimAlloc=function(){var t,e,i;this._byteLength!=this._buffer.byteLength&&(t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),i=new Uint8Array(this._buffer,0,e.length),e.set(i),this.buffer=t)},DataStream.BIG_ENDIAN=!1,DataStream.LITTLE_ENDIAN=!0,DataStream.prototype._byteLength=0,Object.defineProperty(DataStream.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(DataStream.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(DataStream.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(DataStream.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),DataStream.prototype.seek=function(t){var e=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(e)||!isFinite(e)?0:e},DataStream.prototype.isEof=function(){return this.position>=this._byteLength},DataStream.prototype.mapUint8Array=function(t){this._realloc(+t);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=+t,e},DataStream.prototype.readInt32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Int32Array(t);return DataStream.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},DataStream.prototype.readInt16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var i=new Int16Array(t);return DataStream.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},DataStream.prototype.readInt8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Int8Array(t);return DataStream.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},DataStream.prototype.readUint32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Uint32Array(t);return DataStream.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},DataStream.prototype.readUint16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var i=new Uint16Array(t);return DataStream.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},DataStream.prototype.readUint8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Uint8Array(t);return DataStream.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},DataStream.prototype.readFloat64Array=function(t,e){t=null==t?this.byteLength-this.position/8:t;var i=new Float64Array(t);return DataStream.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},DataStream.prototype.readFloat32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Float32Array(t);return DataStream.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},DataStream.prototype.readInt32=function(t){var e=this._dataView.getInt32(this.position,null==t?this.endianness:t);return this.position+=4,e},DataStream.prototype.readInt16=function(t){var e=this._dataView.getInt16(this.position,null==t?this.endianness:t);return this.position+=2,e},DataStream.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},DataStream.prototype.readUint32=function(t){var e=this._dataView.getUint32(this.position,null==t?this.endianness:t);return this.position+=4,e},DataStream.prototype.readUint16=function(t){var e=this._dataView.getUint16(this.position,null==t?this.endianness:t);return this.position+=2,e},DataStream.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},DataStream.prototype.readFloat32=function(t){var e=this._dataView.getFloat32(this.position,null==t?this.endianness:t);return this.position+=4,e},DataStream.prototype.readFloat64=function(t){var e=this._dataView.getFloat64(this.position,null==t?this.endianness:t);return this.position+=8,e},DataStream.endianness=0<new Int8Array(new Int16Array([1]).buffer)[0],DataStream.memcpy=function(t,e,i,r,s){var a=new Uint8Array(t,e,s),n=new Uint8Array(i,r,s);a.set(n)},DataStream.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)},DataStream.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)},DataStream.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=0;i<t.byteLength;i+=t.BYTES_PER_ELEMENT)for(var r=i+t.BYTES_PER_ELEMENT-1,s=i;s<r;r--,s++){var a=e[s];e[s]=e[r],e[r]=a}return t},DataStream.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return String.fromCharCode.apply(null,e)},DataStream.prototype.readString=function(t,e){return null==e||"ASCII"==e?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(null==t?this.byteLength-this.position:t)]):new TextDecoder(e).decode(this.mapUint8Array(t))},DataStream.prototype.readCString=function(t){var e=this.byteLength-this.position,i=new Uint8Array(this._buffer,this._byteOffset+this.position),r=e;null!=t&&(r=Math.min(t,e));for(var s=0;s<r&&0!==i[s];s++);var a=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(s)]);return null!=t?this.position+=r-s:s!=e&&(this.position+=1),a};var MAX_SIZE=Math.pow(2,32);DataStream.prototype.readInt64=function(){return this.readInt32()*MAX_SIZE+this.readUint32()},DataStream.prototype.readUint64=function(){return this.readUint32()*MAX_SIZE+this.readUint32()},DataStream.prototype.readInt64=function(){return this.readUint32()*MAX_SIZE+this.readUint32()},DataStream.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},"undefined"!=typeof exports&&(exports.DataStream=DataStream),DataStream.prototype.save=function(t){var e=new Blob([this.buffer]);if(!window.URL||!URL.createObjectURL)throw"DataStream.save: Can't create object URL.";var i=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.setAttribute("href",i),r.setAttribute("download",t),r.setAttribute("target","_self"),r.click(),window.URL.revokeObjectURL(i)},DataStream.prototype._dynamicSize=!0,Object.defineProperty(DataStream.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),DataStream.prototype.shift=function(t){var e=new ArrayBuffer(this._byteLength-t),i=new Uint8Array(e),r=new Uint8Array(this._buffer,t,i.length);i.set(r),this.buffer=e,this.position-=t},DataStream.prototype.writeInt32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt32(t[i],e)},DataStream.prototype.writeInt16Array=function(t,e){if(this._realloc(2*t.length),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt16(t[i],e)},DataStream.prototype.writeInt8Array=function(t){if(this._realloc(+t.length),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var e=0;e<t.length;e++)this.writeInt8(t[e])},DataStream.prototype.writeUint32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint32(t[i],e)},DataStream.prototype.writeUint16Array=function(t,e){if(this._realloc(2*t.length),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint16(t[i],e)},DataStream.prototype.writeUint8Array=function(t){if(this._realloc(+t.length),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var e=0;e<t.length;e++)this.writeUint8(t[e])},DataStream.prototype.writeFloat64Array=function(t,e){if(this._realloc(8*t.length),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat64(t[i],e)},DataStream.prototype.writeFloat32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat32(t[i],e)},DataStream.prototype.writeInt32=function(t,e){this._realloc(4),this._dataView.setInt32(this.position,t,null==e?this.endianness:e),this.position+=4},DataStream.prototype.writeInt16=function(t,e){this._realloc(2),this._dataView.setInt16(this.position,t,null==e?this.endianness:e),this.position+=2},DataStream.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},DataStream.prototype.writeUint32=function(t,e){this._realloc(4),this._dataView.setUint32(this.position,t,null==e?this.endianness:e),this.position+=4},DataStream.prototype.writeUint16=function(t,e){this._realloc(2),this._dataView.setUint16(this.position,t,null==e?this.endianness:e),this.position+=2},DataStream.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},DataStream.prototype.writeFloat32=function(t,e){this._realloc(4),this._dataView.setFloat32(this.position,t,null==e?this.endianness:e),this.position+=4},DataStream.prototype.writeFloat64=function(t,e){this._realloc(8),this._dataView.setFloat64(this.position,t,null==e?this.endianness:e),this.position+=8},DataStream.prototype.writeUCS2String=function(t,e,i){null==i&&(i=t.length);for(var r=0;r<t.length&&r<i;r++)this.writeUint16(t.charCodeAt(r),e);for(;r<i;r++)this.writeUint16(0)},DataStream.prototype.writeString=function(t,e,i){var r=0;if(null==e||"ASCII"==e)if(null!=i){for(var s=Math.min(t.length,i),r=0;r<s;r++)this.writeUint8(t.charCodeAt(r));for(;r<i;r++)this.writeUint8(0)}else for(r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));else this.writeUint8Array(new TextEncoder(e).encode(t.substring(0,i)))},DataStream.prototype.writeCString=function(t,e){var i=0;if(null!=e){for(var r=Math.min(t.length,e),i=0;i<r;i++)this.writeUint8(t.charCodeAt(i));for(;i<e;i++)this.writeUint8(0)}else{for(i=0;i<t.length;i++)this.writeUint8(t.charCodeAt(i));this.writeUint8(0)}},DataStream.prototype.writeStruct=function(t,e){for(var i=0;i<t.length;i+=2){var r=t[i+1];this.writeType(r,e[t[i]],e)}},DataStream.prototype.writeType=function(t,e,i){var r;if("function"==typeof t)return t(this,e);if("object"==typeof t&&!(t instanceof Array))return t.set(this,e,i);var s=null,a="ASCII",n=this.position;switch("string"==typeof t&&/:/.test(t)&&(t=(r=t.split(":"))[0],s=parseInt(r[1])),"string"==typeof t&&/,/.test(t)&&(t=(r=t.split(","))[0],a=parseInt(r[1])),t){case"uint8":this.writeUint8(e);break;case"int8":this.writeInt8(e);break;case"uint16":this.writeUint16(e,this.endianness);break;case"int16":this.writeInt16(e,this.endianness);break;case"uint32":this.writeUint32(e,this.endianness);break;case"int32":this.writeInt32(e,this.endianness);break;case"float32":this.writeFloat32(e,this.endianness);break;case"float64":this.writeFloat64(e,this.endianness);break;case"uint16be":this.writeUint16(e,DataStream.BIG_ENDIAN);break;case"int16be":this.writeInt16(e,DataStream.BIG_ENDIAN);break;case"uint32be":this.writeUint32(e,DataStream.BIG_ENDIAN);break;case"int32be":this.writeInt32(e,DataStream.BIG_ENDIAN);break;case"float32be":this.writeFloat32(e,DataStream.BIG_ENDIAN);break;case"float64be":this.writeFloat64(e,DataStream.BIG_ENDIAN);break;case"uint16le":this.writeUint16(e,DataStream.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(e,DataStream.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(e,DataStream.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(e,DataStream.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(e,DataStream.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(e,DataStream.LITTLE_ENDIAN);break;case"cstring":this.writeCString(e,s);break;case"string":this.writeString(e,a,s);break;case"u16string":this.writeUCS2String(e,this.endianness,s);break;case"u16stringle":this.writeUCS2String(e,DataStream.LITTLE_ENDIAN,s);break;case"u16stringbe":this.writeUCS2String(e,DataStream.BIG_ENDIAN,s);break;default:if(3==t.length){for(var o=t[1],h=0;h<e.length;h++)this.writeType(o,e[h]);break}this.writeStruct(t,e)}null!=s&&(this.position=n,this._realloc(s),this.position=n+s)},DataStream.prototype.writeUint64=function(t){var e=Math.floor(t/MAX_SIZE);this.writeUint32(e),this.writeUint32(4294967295&t)},DataStream.prototype.writeUint24=function(t){this.writeUint8((16711680&t)>>16),this.writeUint8((65280&t)>>8),this.writeUint8(255&t)},DataStream.prototype.adjustUint32=function(t,e){var i=this.position;this.seek(t),this.writeUint32(e),this.seek(i)},DataStream.prototype.mapInt32Array=function(t,e){this._realloc(4*t);var i=new Int32Array(this._buffer,this.byteOffset+this.position,t);return DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=4*t,i},DataStream.prototype.mapInt16Array=function(t,e){this._realloc(2*t);var i=new Int16Array(this._buffer,this.byteOffset+this.position,t);return DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=2*t,i},DataStream.prototype.mapInt8Array=function(t){this._realloc(+t);var e=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=+t,e},DataStream.prototype.mapUint32Array=function(t,e){this._realloc(4*t);var i=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=4*t,i},DataStream.prototype.mapUint16Array=function(t,e){this._realloc(2*t);var i=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=2*t,i},DataStream.prototype.mapFloat64Array=function(t,e){this._realloc(8*t);var i=new Float64Array(this._buffer,this.byteOffset+this.position,t);return DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=8*t,i},DataStream.prototype.mapFloat32Array=function(t,e){this._realloc(4*t);var i=new Float32Array(this._buffer,this.byteOffset+this.position,t);return DataStream.arrayToNative(i,null==e?this.endianness:e),this.position+=4*t,i};var MultiBufferStream=function(t){this.buffers=[],this.bufferIndex=-1,t&&(this.insertBuffer(t),this.bufferIndex=0)};MultiBufferStream.prototype=new DataStream(new ArrayBuffer,0,DataStream.BIG_ENDIAN),MultiBufferStream.prototype.initialized=function(){var t;return-1<this.bufferIndex||(0<this.buffers.length?0===(t=this.buffers[0]).fileStart?(this.buffer=t,this.bufferIndex=0,Log.debug("MultiBufferStream","Stream ready for parsing"),!0):(Log.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1):(Log.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1))},ArrayBuffer.concat=function(t,e){Log.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+e.byteLength));var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer},MultiBufferStream.prototype.reduceBuffer=function(t,e,i){var r=new Uint8Array(i);return r.set(new Uint8Array(t,e,i)),r.buffer.fileStart=t.fileStart+e,r.buffer.usedBytes=0,r.buffer},MultiBufferStream.prototype.insertBuffer=function(t){for(var e=!0,i=0;i<this.buffers.length;i++){var r=this.buffers[i];if(t.fileStart<=r.fileStart){if(t.fileStart===r.fileStart){if(t.byteLength>r.byteLength){this.buffers.splice(i,1),i--;continue}Log.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring")}else t.fileStart+t.byteLength<=r.fileStart||(t=this.reduceBuffer(t,0,r.fileStart-t.fileStart)),Log.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(i,0,t),0===i&&(this.buffer=t);e=!1;break}if(t.fileStart<r.fileStart+r.byteLength){var s=r.fileStart+r.byteLength-t.fileStart,a=t.byteLength-s;if(!(0<a)){e=!1;break}t=this.reduceBuffer(t,s,a)}}e&&(Log.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),0===i&&(this.buffer=t))},MultiBufferStream.prototype.logBufferLevel=function(t){for(var e,i,r=[],s="",a=0,n=0,o=0;o<this.buffers.length;o++)e=this.buffers[o],0===o?(i={},r.push(i),i.start=e.fileStart,i.end=e.fileStart+e.byteLength,s+="["+i.start+"-"):i.end===e.fileStart?i.end=e.fileStart+e.byteLength:((i={}).start=e.fileStart,s+=r[r.length-1].end-1+"], ["+i.start+"-",i.end=e.fileStart+e.byteLength,r.push(i)),a+=e.usedBytes,n+=e.byteLength;0<r.length&&(s+=i.end-1+"]");var h=t?Log.info:Log.debug;0===this.buffers.length?h("MultiBufferStream","No more buffer in memory"):h("MultiBufferStream",this.buffers.length+" stored buffer(s) ("+a+"/"+n+" bytes): "+s)},MultiBufferStream.prototype.cleanBuffers=function(){for(var t,e=0;e<this.buffers.length;e++)(t=this.buffers[e]).usedBytes===t.byteLength&&(Log.debug("MultiBufferStream","Removing buffer #"+e),this.buffers.splice(e,1),e--)},MultiBufferStream.prototype.mergeNextBuffer=function(){var t;if(this.bufferIndex+1<this.buffers.length){if((t=this.buffers[this.bufferIndex+1]).fileStart!==this.buffer.fileStart+this.buffer.byteLength)return!1;var e=this.buffer.byteLength,i=this.buffer.usedBytes,r=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=i,this.buffer.fileStart=r,Log.debug("ISOFile","Concatenating buffer for box parsing (length: "+e+"->"+this.buffer.byteLength+")"),!0}return!1},MultiBufferStream.prototype.findPosition=function(t,e,i){for(var r=null,s=-1,a=!0===t?0:this.bufferIndex;a<this.buffers.length&&(r=this.buffers[a]).fileStart<=e;)s=a,i&&(r.fileStart+r.byteLength<=e?r.usedBytes=r.byteLength:r.usedBytes=e-r.fileStart,this.logBufferLevel()),a++;return-1!==s&&(r=this.buffers[s]).fileStart+r.byteLength>=e?(Log.debug("MultiBufferStream","Found position in existing buffer #"+s),s):-1},MultiBufferStream.prototype.findEndContiguousBuf=function(t){var e,i,r=void 0!==t?t:this.bufferIndex,s=this.buffers[r];if(this.buffers.length>r+1)for(e=r+1;e<this.buffers.length&&(i=this.buffers[e]).fileStart===s.fileStart+s.byteLength;e++)s=i;return s.fileStart+s.byteLength},MultiBufferStream.prototype.getEndFilePositionAfter=function(t){var e=this.findPosition(!0,t,!1);return-1!==e?this.findEndContiguousBuf(e):t},MultiBufferStream.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()},MultiBufferStream.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},MultiBufferStream.prototype.seek=function(t,e,i){var r=this.findPosition(e,t,i);return-1!==r?(this.buffer=this.buffers[r],this.bufferIndex=r,this.position=t-this.buffer.fileStart,Log.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(Log.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},MultiBufferStream.prototype.getPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},MultiBufferStream.prototype.getLength=function(){return this.byteLength},MultiBufferStream.prototype.getEndPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},"undefined"!=typeof exports&&(exports.MultiBufferStream=MultiBufferStream);var MPEG4DescriptorParser=function(){var a=[];a[3]="ES_Descriptor",a[4]="DecoderConfigDescriptor",a[5]="DecoderSpecificInfo",a[6]="SLConfigDescriptor",this.getDescriptorName=function(t){return a[t]};var r=this,n={};return this.parseOneDescriptor=function(t){var e,i,r=0,s=t.readUint8();for(i=t.readUint8(),0;128&i;)r=(127&i)<<7,i=t.readUint8(),0;return r+=127&i,Log.debug("MPEG4DescriptorParser","Found "+(a[s]||"Descriptor "+s)+", size "+r+" at position "+t.getPosition()),(e=a[s]?new n[a[s]](r):new n.Descriptor(r)).parse(t),e},n.Descriptor=function(t,e){this.tag=t,this.size=e,this.descs=[]},n.Descriptor.prototype.parse=function(t){this.data=t.readUint8Array(this.size)},n.Descriptor.prototype.findDescriptor=function(t){for(var e=0;e<this.descs.length;e++)if(this.descs[e].tag==t)return this.descs[e];return null},n.Descriptor.prototype.parseRemainingDescriptors=function(t){for(var e=t.position;t.position<e+this.size;){var i=r.parseOneDescriptor(t);this.descs.push(i)}},n.ES_Descriptor=function(t){n.Descriptor.call(this,3,t)},n.ES_Descriptor.prototype=new n.Descriptor,n.ES_Descriptor.prototype.parse=function(t){var e;this.ES_ID=t.readUint16(),this.flags=t.readUint8(),this.size-=3,128&this.flags?(this.dependsOn_ES_ID=t.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,64&this.flags?(e=t.readUint8(),this.URL=t.readString(e),this.size-=e+1):this.URL="",32&this.flags?(this.OCR_ES_ID=t.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(t)},n.ES_Descriptor.prototype.getOTI=function(t){var e=this.findDescriptor(4);return e?e.oti:0},n.ES_Descriptor.prototype.getAudioConfig=function(t){var e=this.findDescriptor(4);if(!e)return null;var i=e.findDescriptor(5);if(i&&i.data){var r=(248&i.data[0])>>3;return 31===r&&2<=i.data.length&&(r=32+((7&i.data[0])<<3)+((224&i.data[1])>>5)),r}return null},n.DecoderConfigDescriptor=function(t){n.Descriptor.call(this,4,t)},n.DecoderConfigDescriptor.prototype=new n.Descriptor,n.DecoderConfigDescriptor.prototype.parse=function(t){this.oti=t.readUint8(),this.streamType=t.readUint8(),this.bufferSize=t.readUint24(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32(),this.size-=13,this.parseRemainingDescriptors(t)},n.DecoderSpecificInfo=function(t){n.Descriptor.call(this,5,t)},n.DecoderSpecificInfo.prototype=new n.Descriptor,n.SLConfigDescriptor=function(t){n.Descriptor.call(this,6,t)},n.SLConfigDescriptor.prototype=new n.Descriptor,this};"undefined"!=typeof exports&&(exports.MPEG4DescriptorParser=MPEG4DescriptorParser);var BoxParser={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){BoxParser.FullBox.prototype=new BoxParser.Box,BoxParser.ContainerBox.prototype=new BoxParser.Box,BoxParser.SampleEntry.prototype=new BoxParser.Box,BoxParser.TrackGroupTypeBox.prototype=new BoxParser.FullBox,BoxParser.BASIC_BOXES.forEach(function(t){BoxParser.createBoxCtor(t)}),BoxParser.FULL_BOXES.forEach(function(t){BoxParser.createFullBoxCtor(t)}),BoxParser.CONTAINER_BOXES.forEach(function(t){BoxParser.createContainerBoxCtor(t[0],null,t[1])})},Box:function(t,e,i){this.type=t,this.size=e,this.uuid=i},FullBox:function(t,e,i){BoxParser.Box.call(this,t,e,i),this.flags=0,this.version=0},ContainerBox:function(t,e,i){BoxParser.Box.call(this,t,e,i),this.boxes=[]},SampleEntry:function(t,e,i,r){BoxParser.ContainerBox.call(this,t,e),this.hdr_size=i,this.start=r},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,e){BoxParser.FullBox.call(this,t,e)},createBoxCtor:function(e,t){BoxParser.boxCodes.push(e),BoxParser[e+"Box"]=function(t){BoxParser.Box.call(this,e,t)},BoxParser[e+"Box"].prototype=new BoxParser.Box,t&&(BoxParser[e+"Box"].prototype.parse=t)},createFullBoxCtor:function(e,i){BoxParser[e+"Box"]=function(t){BoxParser.FullBox.call(this,e,t)},BoxParser[e+"Box"].prototype=new BoxParser.FullBox,BoxParser[e+"Box"].prototype.parse=function(t){this.parseFullHeader(t),i&&i.call(this,t)}},addSubBoxArrays:function(t){if(t)for(var e=(this.subBoxNames=t).length,i=0;i<e;i++)this[t[i]+"s"]=[]},createContainerBoxCtor:function(e,t,i){BoxParser[e+"Box"]=function(t){BoxParser.ContainerBox.call(this,e,t),BoxParser.addSubBoxArrays.call(this,i)},BoxParser[e+"Box"].prototype=new BoxParser.ContainerBox,t&&(BoxParser[e+"Box"].prototype.parse=t)},createMediaSampleEntryCtor:function(t,e,i){BoxParser.sampleEntryCodes[t]=[],BoxParser[t+"SampleEntry"]=function(t,e){BoxParser.SampleEntry.call(this,t,e),BoxParser.addSubBoxArrays.call(this,i)},BoxParser[t+"SampleEntry"].prototype=new BoxParser.SampleEntry,e&&(BoxParser[t+"SampleEntry"].prototype.parse=e)},createSampleEntryCtor:function(e,i,t,r){BoxParser.sampleEntryCodes[e].push(i),BoxParser[i+"SampleEntry"]=function(t){BoxParser[e+"SampleEntry"].call(this,i,t),BoxParser.addSubBoxArrays.call(this,r)},BoxParser[i+"SampleEntry"].prototype=new BoxParser[e+"SampleEntry"],t&&(BoxParser[i+"SampleEntry"].prototype.parse=t)},createEncryptedSampleEntryCtor:function(t,e,i){BoxParser.createSampleEntryCtor.call(this,t,e,i,["sinf"])},createSampleGroupCtor:function(e,t){BoxParser[e+"SampleGroupEntry"]=function(t){BoxParser.SampleGroupEntry.call(this,e,t)},BoxParser[e+"SampleGroupEntry"].prototype=new BoxParser.SampleGroupEntry,t&&(BoxParser[e+"SampleGroupEntry"].prototype.parse=t)},createTrackGroupCtor:function(e,t){BoxParser[e+"TrackGroupTypeBox"]=function(t){BoxParser.TrackGroupTypeBox.call(this,e,t)},BoxParser[e+"TrackGroupTypeBox"].prototype=new BoxParser.TrackGroupTypeBox,t&&(BoxParser[e+"TrackGroupTypeBox"].prototype.parse=t)},createUUIDBox:function(e,i,r,s){BoxParser.UUIDs.push(e),BoxParser.UUIDBoxes[e]=function(t){i?BoxParser.FullBox.call(this,"uuid",t,e):r?BoxParser.ContainerBox.call(this,"uuid",t,e):BoxParser.Box.call(this,"uuid",t,e)},BoxParser.UUIDBoxes[e].prototype=i?new BoxParser.FullBox:r?new BoxParser.ContainerBox:new BoxParser.Box,s&&(BoxParser.UUIDBoxes[e].prototype.parse=i?function(t){this.parseFullHeader(t),s&&s.call(this,t)}:s)}};BoxParser.initialize(),BoxParser.TKHD_FLAG_ENABLED=1,BoxParser.TKHD_FLAG_IN_MOVIE=2,BoxParser.TKHD_FLAG_IN_PREVIEW=4,BoxParser.TFHD_FLAG_BASE_DATA_OFFSET=1,BoxParser.TFHD_FLAG_SAMPLE_DESC=2,BoxParser.TFHD_FLAG_SAMPLE_DUR=8,BoxParser.TFHD_FLAG_SAMPLE_SIZE=16,BoxParser.TFHD_FLAG_SAMPLE_FLAGS=32,BoxParser.TFHD_FLAG_DUR_EMPTY=65536,BoxParser.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,BoxParser.TRUN_FLAGS_DATA_OFFSET=1,BoxParser.TRUN_FLAGS_FIRST_FLAG=4,BoxParser.TRUN_FLAGS_DURATION=256,BoxParser.TRUN_FLAGS_SIZE=512,BoxParser.TRUN_FLAGS_FLAGS=1024,BoxParser.TRUN_FLAGS_CTS_OFFSET=2048,BoxParser.Box.prototype.add=function(t){return this.addBox(new BoxParser[t+"Box"])},BoxParser.Box.prototype.addBox=function(t){return this.boxes.push(t),this[t.type+"s"]?this[t.type+"s"].push(t):this[t.type]=t,t},BoxParser.Box.prototype.set=function(t,e){return this[t]=e,this},BoxParser.Box.prototype.addEntry=function(t,e){var i=e||"entries";return this[i]||(this[i]=[]),this[i].push(t),this},"undefined"!=typeof exports&&(exports.BoxParser=BoxParser),BoxParser.parseUUID=function(t){return BoxParser.parseHex16(t)},BoxParser.parseHex16=function(t){for(var e="",i=0;i<16;i++){var r=t.readUint8().toString(16);e+=1===r.length?"0"+r:r}return e},BoxParser.parseOneBox=function(t,e,i){var r,s,a,n=t.getPosition(),o=0;if(t.getEndPosition()-n<8)return Log.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:BoxParser.ERR_NOT_ENOUGH_DATA};if(i&&i<8)return Log.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:BoxParser.ERR_NOT_ENOUGH_DATA};var h=t.readUint32(),d=t.readString(4),l=d;if(Log.debug("BoxParser","Found box of type '"+d+"' and size "+h+" at position "+n),o=8,"uuid"==d){if(t.getEndPosition()-t.getPosition()<16||i-o<16)return t.seek(n),Log.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:BoxParser.ERR_NOT_ENOUGH_DATA};o+=16,l=a=BoxParser.parseUUID(t)}if(1==h){if(t.getEndPosition()-t.getPosition()<8||i&&i-o<8)return t.seek(n),Log.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+d+'" box'),{code:BoxParser.ERR_NOT_ENOUGH_DATA};h=t.readUint64(),o+=8}else if(0===h)if(i)h=i;else if("mdat"!==d)return Log.error("BoxParser","Unlimited box size not supported for type: '"+d+"'"),r=new BoxParser.Box(d,h),{code:BoxParser.OK,box:r,size:r.size};return h<o?(Log.error("BoxParser","Box of type "+d+" has an invalid size "+h+" (too small to be a box)"),{code:BoxParser.ERR_NOT_ENOUGH_DATA,type:d,size:h,hdr_size:o,start:n}):i&&i<h?(Log.error("BoxParser","Box of type '"+d+"' has a size "+h+" greater than its container size "+i),{code:BoxParser.ERR_NOT_ENOUGH_DATA,type:d,size:h,hdr_size:o,start:n}):n+h>t.getEndPosition()?(t.seek(n),Log.info("BoxParser","Not enough data in stream to parse the entire '"+d+"' box"),{code:BoxParser.ERR_NOT_ENOUGH_DATA,type:d,size:h,hdr_size:o,start:n}):e?{code:BoxParser.OK,type:d,size:h,hdr_size:o,start:n}:(BoxParser[d+"Box"]?r=new BoxParser[d+"Box"](h):"uuid"!==d?(Log.warn("BoxParser","Unknown box type: '"+d+"'"),(r=new BoxParser.Box(d,h)).has_unparsed_data=!0):BoxParser.UUIDBoxes[a]?r=new BoxParser.UUIDBoxes[a](h):(Log.warn("BoxParser","Unknown uuid type: '"+a+"'"),(r=new BoxParser.Box(d,h)).uuid=a,r.has_unparsed_data=!0),r.hdr_size=o,r.start=n,r.write===BoxParser.Box.prototype.write&&"mdat"!==r.type&&(Log.info("BoxParser","'"+l+"' box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),(s=t.getPosition()-(r.start+r.size))<0?(Log.warn("BoxParser","Parsing of box '"+l+"' did not read the entire indicated box data size (missing "+-s+" bytes), seeking forward"),t.seek(r.start+r.size)):0<s&&(Log.error("BoxParser","Parsing of box '"+l+"' read "+s+" more bytes than the indicated box data size, seeking backwards"),t.seek(r.start+r.size)),{code:BoxParser.OK,box:r,size:r.size})},BoxParser.Box.prototype.parse=function(t){"mdat"!=this.type?this.data=t.readUint8Array(this.size-this.hdr_size):0===this.size?t.seek(t.getEndPosition()):t.seek(this.start+this.size)},BoxParser.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},BoxParser.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},BoxParser.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},BoxParser.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},BoxParser.ContainerBox.prototype.parse=function(t){for(var e;t.getPosition()<this.start+this.size;){if((e=BoxParser.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==BoxParser.OK)return;var i,r=e.box;this.boxes.push(r),this.subBoxNames&&-1!=this.subBoxNames.indexOf(r.type)?this[this.subBoxNames[this.subBoxNames.indexOf(r.type)]+"s"].push(r):this[i="uuid"!==r.type?r.type:r.uuid]?Log.warn("Box of type "+i+" already stored in field of this type"):this[i]=r}},BoxParser.Box.prototype.parseLanguage=function(t){this.language=t.readUint16();var e=[];e[0]=this.language>>10&31,e[1]=this.language>>5&31,e[2]=31&this.language,this.languageString=String.fromCharCode(e[0]+96,e[1]+96,e[2]+96)},BoxParser.SAMPLE_ENTRY_TYPE_VISUAL="Visual",BoxParser.SAMPLE_ENTRY_TYPE_AUDIO="Audio",BoxParser.SAMPLE_ENTRY_TYPE_HINT="Hint",BoxParser.SAMPLE_ENTRY_TYPE_METADATA="Metadata",BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",BoxParser.SAMPLE_ENTRY_TYPE_SYSTEM="System",BoxParser.SAMPLE_ENTRY_TYPE_TEXT="Text",BoxParser.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8},BoxParser.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},BoxParser.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size},BoxParser.SampleEntry.prototype.parseFooter=function(t){BoxParser.ContainerBox.prototype.parse.call(this,t)},BoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_HINT),BoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_METADATA),BoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE),BoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SYSTEM),BoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_TEXT),BoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL,function(t){var e;this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),e=Math.min(31,t.readUint8()),this.compressorname=t.readString(e),e<31&&t.readString(31-e),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)}),BoxParser.createMediaSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO,function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/65536,this.parseFooter(t)}),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),BoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),BoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),BoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),BoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),BoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_TEXT,"enct"),BoxParser.createEncryptedSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_METADATA,"encm"),BoxParser.createBoxCtor("av1C",function(t){var e=t.readUint8();if(e>>7&!1)Log.error("av1C marker problem");else if(this.version=127&e,1===this.version)if(e=t.readUint8(),this.seq_profile=e>>5&7,this.seq_level_idx_0=31&e,e=t.readUint8(),this.seq_tier_0=e>>7&1,this.high_bitdepth=e>>6&1,this.twelve_bit=e>>5&1,this.monochrome=e>>4&1,this.chroma_subsampling_x=e>>3&1,this.chroma_subsampling_y=e>>2&1,this.chroma_sample_position=3&e,e=t.readUint8(),this.reserved_1=e>>5&7,0===this.reserved_1){if(this.initial_presentation_delay_present=e>>4&1,1===this.initial_presentation_delay_present)this.initial_presentation_delay_minus_one=15&e;else if(this.reserved_2=15&e,0!==this.reserved_2)return void Log.error("av1C reserved_2 parsing problem");var i=this.size-this.hdr_size-4;this.configOBUs=t.readUint8Array(i)}else Log.error("av1C reserved_1 parsing problem");else Log.error("av1C version "+this.version+" not supported")}),BoxParser.createBoxCtor("avcC",function(t){var e,i;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=3&t.readUint8(),this.nb_SPS_nalus=31&t.readUint8(),i=this.size-this.hdr_size-6,this.SPS=[],e=0;e<this.nb_SPS_nalus;e++)this.SPS[e]={},this.SPS[e].length=t.readUint16(),this.SPS[e].nalu=t.readUint8Array(this.SPS[e].length),i-=2+this.SPS[e].length;for(this.nb_PPS_nalus=t.readUint8(),i--,this.PPS=[],e=0;e<this.nb_PPS_nalus;e++)this.PPS[e]={},this.PPS[e].length=t.readUint16(),this.PPS[e].nalu=t.readUint8Array(this.PPS[e].length),i-=2+this.PPS[e].length;0<i&&(this.ext=t.readUint8Array(i))}),BoxParser.createBoxCtor("btrt",function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()}),BoxParser.createBoxCtor("clap",function(t){this.cleanApertureWidthN=t.readUint32(),this.cleanApertureWidthD=t.readUint32(),this.cleanApertureHeightN=t.readUint32(),this.cleanApertureHeightD=t.readUint32(),this.horizOffN=t.readUint32(),this.horizOffD=t.readUint32(),this.vertOffN=t.readUint32(),this.vertOffD=t.readUint32()}),BoxParser.createBoxCtor("clli",function(t){this.max_content_light_level=t.readUint16(),this.max_pic_average_light_level=t.readUint16()}),BoxParser.createFullBoxCtor("co64",function(t){var e,i=t.readUint32();if(this.chunk_offsets=[],0===this.version)for(e=0;e<i;e++)this.chunk_offsets.push(t.readUint64())}),BoxParser.createFullBoxCtor("CoLL",function(t){this.maxCLL=t.readUint16(),this.maxFALL=t.readUint16()}),BoxParser.createBoxCtor("colr",function(t){var e;this.colour_type=t.readString(4),"nclx"===this.colour_type?(this.colour_primaries=t.readUint16(),this.transfer_characteristics=t.readUint16(),this.matrix_coefficients=t.readUint16(),e=t.readUint8(),this.full_range_flag=e>>7):"rICC"!==this.colour_type&&"prof"!==this.colour_type||(this.ICC_profile=t.readUint8Array(this.size-4))}),BoxParser.createFullBoxCtor("cprt",function(t){this.parseLanguage(t),this.notice=t.readCString()}),BoxParser.createFullBoxCtor("cslg",function(t){0===this.version&&(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32())}),BoxParser.createFullBoxCtor("ctts",function(t){var e,i=t.readUint32();if(this.sample_counts=[],this.sample_offsets=[],0===this.version)for(e=0;e<i;e++){this.sample_counts.push(t.readUint32());var r=t.readInt32();r<0&&Log.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(r)}else if(1==this.version)for(e=0;e<i;e++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32())}),BoxParser.createBoxCtor("dac3",function(t){var e=t.readUint8(),i=t.readUint8(),r=t.readUint8();this.fscod=e>>6,this.bsid=e>>1&31,this.bsmod=(1&e)<<2|i>>6&3,this.acmod=i>>3&7,this.lfeon=i>>2&1,this.bit_rate_code=3&i|r>>5&7}),BoxParser.createBoxCtor("dec3",function(t){var e=t.readUint16();this.data_rate=e>>3,this.num_ind_sub=7&e,this.ind_subs=[];for(var i=0;i<this.num_ind_sub+1;i++){var r={};this.ind_subs.push(r);var s=t.readUint8(),a=t.readUint8(),n=t.readUint8();r.fscod=s>>6,r.bsid=s>>1&31,r.bsmod=(1&s)<<4|a>>4&15,r.acmod=a>>1&7,r.lfeon=1&a,r.num_dep_sub=n>>1&15,0<r.num_dep_sub&&(r.chan_loc=(1&n)<<8|t.readUint8())}}),BoxParser.createFullBoxCtor("dfLa",function(t){var e=[],i=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];for(this.parseFullHeader(t);;){var r=t.readUint8(),s=Math.min(127&r,i.length-1);if(s?t.readUint8Array(t.readUint24()):(t.readUint8Array(13),this.samplerate=t.readUint32()>>12,t.readUint8Array(20)),e.push(i[s]),128&r)break}this.numMetadataBlocks=e.length+" ("+e.join(", ")+")"}),BoxParser.createBoxCtor("dimm",function(t){this.bytessent=t.readUint64()}),BoxParser.createBoxCtor("dmax",function(t){this.time=t.readUint32()}),BoxParser.createBoxCtor("dmed",function(t){this.bytessent=t.readUint64()}),BoxParser.createFullBoxCtor("dref",function(t){var e,i;this.entries=[];for(var r=t.readUint32(),s=0;s<r;s++){if((e=BoxParser.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==BoxParser.OK)return;i=e.box,this.entries.push(i)}}),BoxParser.createBoxCtor("drep",function(t){this.bytessent=t.readUint64()}),BoxParser.createFullBoxCtor("elng",function(t){this.extended_language=t.readString(this.size-this.hdr_size)}),BoxParser.createFullBoxCtor("elst",function(t){this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var r={};this.entries.push(r),1===this.version?(r.segment_duration=t.readUint64(),r.media_time=t.readInt64()):(r.segment_duration=t.readUint32(),r.media_time=t.readInt32()),r.media_rate_integer=t.readInt16(),r.media_rate_fraction=t.readInt16()}}),BoxParser.createFullBoxCtor("emsg",function(t){1==this.version?(this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint64(),this.event_duration=t.readUint32(),this.id=t.readUint32(),this.scheme_id_uri=t.readCString(),this.value=t.readCString()):(this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32());var e=this.size-this.hdr_size-(16+(this.scheme_id_uri.length+1)+(this.value.length+1));1==this.version&&(e-=4),this.message_data=t.readUint8Array(e)}),BoxParser.createFullBoxCtor("esds",function(t){var e,i=t.readUint8Array(this.size-this.hdr_size);void 0!==MPEG4DescriptorParser&&(e=new MPEG4DescriptorParser,this.esd=e.parseOneDescriptor(new DataStream(i.buffer,0,DataStream.BIG_ENDIAN)))}),BoxParser.createBoxCtor("fiel",function(t){this.fieldCount=t.readUint8(),this.fieldOrdering=t.readUint8()}),BoxParser.createBoxCtor("frma",function(t){this.data_format=t.readString(4)}),BoxParser.createBoxCtor("ftyp",function(t){var e=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),e-=8,this.compatible_brands=[];for(var i=0;4<=e;)this.compatible_brands[i]=t.readString(4),e-=4,i++}),BoxParser.createFullBoxCtor("hdlr",function(t){0===this.version&&(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),"\0"===this.name[this.name.length-1]&&(this.name=this.name.slice(0,-1)))}),BoxParser.createBoxCtor("hvcC",function(t){var e,i;this.configurationVersion=t.readUint8(),i=t.readUint8(),this.general_profile_space=i>>6,this.general_tier_flag=(32&i)>>5,this.general_profile_idc=31&i,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=4095&t.readUint16(),this.parallelismType=3&t.readUint8(),this.chroma_format_idc=3&t.readUint8(),this.bit_depth_luma_minus8=7&t.readUint8(),this.bit_depth_chroma_minus8=7&t.readUint8(),this.avgFrameRate=t.readUint16(),i=t.readUint8(),this.constantFrameRate=i>>6,this.numTemporalLayers=(13&i)>>3,this.temporalIdNested=(4&i)>>2,this.lengthSizeMinusOne=3&i,this.nalu_arrays=[];for(var r=t.readUint8(),s=0;s<r;s++){var a=[];this.nalu_arrays.push(a),i=t.readUint8(),a.completeness=(128&i)>>7,a.nalu_type=63&i;for(var n=t.readUint16(),o=0;o<n;o++){var h={};a.push(h),e=t.readUint16(),h.data=t.readUint8Array(e)}}}),BoxParser.createFullBoxCtor("iinf",function(t){var e;0===this.version?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var i=0;i<this.entry_count;i++){if((e=BoxParser.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==BoxParser.OK)return;"infe"!==e.box.type&&Log.error("BoxParser","Expected 'infe' box, got "+e.box.type),this.item_infos[i]=e.box}}),BoxParser.createFullBoxCtor("iloc",function(t){var e=t.readUint8();this.offset_size=e>>4&15,this.length_size=15&e,e=t.readUint8(),this.base_offset_size=e>>4&15,1===this.version||2===this.version?this.index_size=15&e:this.index_size=0,this.items=[];var i=0;if(this.version<2)i=t.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";i=t.readUint32()}for(var r=0;r<i;r++){var s={};if(this.items.push(s),this.version<2)s.item_ID=t.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";s.item_ID=t.readUint16()}switch(1===this.version||2===this.version?s.construction_method=15&t.readUint16():s.construction_method=0,s.data_reference_index=t.readUint16(),this.base_offset_size){case 0:s.base_offset=0;break;case 4:s.base_offset=t.readUint32();break;case 8:s.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var a=t.readUint16();s.extents=[];for(var n=0;n<a;n++){var o={};if(s.extents.push(o),1===this.version||2===this.version)switch(this.index_size){case 0:o.extent_index=0;break;case 4:o.extent_index=t.readUint32();break;case 8:o.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:o.extent_offset=0;break;case 4:o.extent_offset=t.readUint32();break;case 8:o.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:o.extent_length=0;break;case 4:o.extent_length=t.readUint32();break;case 8:o.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}}),BoxParser.createFullBoxCtor("infe",function(t){return 0!==this.version&&1!==this.version||(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),1===this.version?(this.extension_type=t.readString(4),Log.warn("BoxParser","Cannot parse extension type"),void t.seek(this.start+this.size)):void(2<=this.version&&(2===this.version?this.item_ID=t.readUint16():3===this.version&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.item_name=t.readCString(),"mime"===this.item_type?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):"uri "===this.item_type&&(this.item_uri_type=t.readCString())))}),BoxParser.createFullBoxCtor("ipma",function(t){var e,i;for(entry_count=t.readUint32(),this.associations=[],e=0;e<entry_count;e++){var r={};this.associations.push(r),this.version<1?r.id=t.readUint16():r.id=t.readUint32();var s=t.readUint8();for(r.props=[],i=0;i<s;i++){var a=t.readUint8(),n={};r.props.push(n),n.essential=(128&a)>>7==1,1&this.flags?n.property_index=(127&a)<<8|t.readUint8():n.property_index=127&a}}}),BoxParser.createFullBoxCtor("iref",function(t){var e,i;for(this.references=[];t.getPosition()<this.start+this.size;){if((e=BoxParser.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==BoxParser.OK)return;(i=0===this.version?new BoxParser.SingleItemTypeReferenceBox(e.type,e.size,e.hdr_size,e.start):new BoxParser.SingleItemTypeReferenceBoxLarge(e.type,e.size,e.hdr_size,e.start)).write===BoxParser.Box.prototype.write&&"mdat"!==i.type&&(Log.warn("BoxParser",i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(t)),i.parse(t),this.references.push(i)}}),BoxParser.createBoxCtor("irot",function(t){this.angle=3&t.readUint8()}),BoxParser.createFullBoxCtor("ispe",function(t){this.image_width=t.readUint32(),this.image_height=t.readUint32()}),BoxParser.createFullBoxCtor("kind",function(t){this.schemeURI=t.readCString(),this.value=t.readCString()}),BoxParser.createFullBoxCtor("leva",function(t){var e=t.readUint8();this.levels=[];for(var i=0;i<e;i++){var r={};(this.levels[i]=r).track_ID=t.readUint32();var s=t.readUint8();switch(r.padding_flag=s>>7,r.assignment_type=127&s,r.assignment_type){case 0:r.grouping_type=t.readString(4);break;case 1:r.grouping_type=t.readString(4),r.grouping_type_parameter=t.readUint32();break;case 2:case 3:break;case 4:r.sub_track_id=t.readUint32();break;default:Log.warn("BoxParser","Unknown leva assignement type")}}}),BoxParser.createBoxCtor("maxr",function(t){this.period=t.readUint32(),this.bytes=t.readUint32()}),BoxParser.createBoxCtor("mdcv",function(t){this.display_primaries=[],this.display_primaries[0]={},this.display_primaries[0].x=t.readUint16(),this.display_primaries[0].y=t.readUint16(),this.display_primaries[1]={},this.display_primaries[1].x=t.readUint16(),this.display_primaries[1].y=t.readUint16(),this.display_primaries[2]={},this.display_primaries[2].x=t.readUint16(),this.display_primaries[2].y=t.readUint16(),this.white_point={},this.white_point.x=t.readUint16(),this.white_point.y=t.readUint16(),this.max_display_mastering_luminance=t.readUint32(),this.min_display_mastering_luminance=t.readUint32()}),BoxParser.createFullBoxCtor("mdhd",function(t){1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()}),BoxParser.createFullBoxCtor("mehd",function(t){1&this.flags&&(Log.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),1==this.version?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()}),BoxParser.createFullBoxCtor("meta",function(t){this.boxes=[],BoxParser.ContainerBox.prototype.parse.call(this,t)}),BoxParser.createFullBoxCtor("mfhd",function(t){this.sequence_number=t.readUint32()}),BoxParser.createFullBoxCtor("mfro",function(t){this._size=t.readUint32()}),BoxParser.createFullBoxCtor("mvhd",function(t){1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()}),BoxParser.createBoxCtor("npck",function(t){this.packetssent=t.readUint32()}),BoxParser.createBoxCtor("nump",function(t){this.packetssent=t.readUint64()}),BoxParser.createFullBoxCtor("padb",function(t){var e=t.readUint32();this.padbits=[];for(var i=0;i<Math.floor((e+1)/2);i++)this.padbits=t.readUint8()}),BoxParser.createBoxCtor("pasp",function(t){this.hSpacing=t.readUint32(),this.vSpacing=t.readUint32()}),BoxParser.createBoxCtor("payl",function(t){this.text=t.readString(this.size-this.hdr_size)}),BoxParser.createBoxCtor("payt",function(t){this.payloadID=t.readUint32();var e=t.readUint8();this.rtpmap_string=t.readString(e)}),BoxParser.createFullBoxCtor("pdin",function(t){var e=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var i=0;i<e;i++)this.rate[i]=t.readUint32(),this.initial_delay[i]=t.readUint32()}),BoxParser.createFullBoxCtor("pitm",function(t){0===this.version?this.item_id=t.readUint16():this.item_id=t.readUint32()}),BoxParser.createFullBoxCtor("pixi",function(t){var e;for(this.num_channels=t.readUint8(),this.bits_per_channels=[],e=0;e<this.num_channels;e++)this.bits_per_channels[e]=t.readUint8()}),BoxParser.createBoxCtor("pmax",function(t){this.bytes=t.readUint32()}),BoxParser.createFullBoxCtor("prft",function(t){this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),0===this.version?this.media_time=t.readUint32():this.media_time=t.readUint64()}),BoxParser.createFullBoxCtor("pssh",function(t){if(this.system_id=BoxParser.parseHex16(t),0<this.version){var e=t.readUint32();this.kid=[];for(var i=0;i<e;i++)this.kid[i]=BoxParser.parseHex16(t)}var r=t.readUint32();0<r&&(this.data=t.readUint8Array(r))}),BoxParser.createFullBoxCtor("clef",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),BoxParser.createFullBoxCtor("enof",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),BoxParser.createFullBoxCtor("prof",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),BoxParser.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),BoxParser.createBoxCtor("rtp ",function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)}),BoxParser.createFullBoxCtor("saio",function(t){1&this.flags&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32());var e=t.readUint32();this.offset=[];for(var i=0;i<e;i++)0===this.version?this.offset[i]=t.readUint32():this.offset[i]=t.readUint64()}),BoxParser.createFullBoxCtor("saiz",function(t){1&this.flags&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8();var e=t.readUint32();if(this.sample_info_size=[],0===this.default_sample_info_size)for(var i=0;i<e;i++)this.sample_info_size[i]=t.readUint8()}),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)}),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)}),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)}),BoxParser.createSampleEntryCtor(BoxParser.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(t){this.parseHeader(t),this.parseFooter(t)}),BoxParser.createSampleGroupCtor("alst",function(t){var e,i=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],e=0;e<i;e++)this.sample_offset[e]=t.readUint32();var r=this.description_length-4-4*i;for(this.num_output_samples=[],this.num_total_samples=[],e=0;e<r/4;e++)this.num_output_samples[e]=t.readUint16(),this.num_total_samples[e]=t.readUint16()}),BoxParser.createSampleGroupCtor("avll",function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()}),BoxParser.createSampleGroupCtor("avss",function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var e=t.readUint8();this.durationFlag=e>>7,this.avgRateFlag=e>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var i=t.readUint8(),r=0;r<i;r++){var s={};this.dependency.push(s),s.subSeqDirectionFlag=t.readUint8(),s.layerNumber=t.readUint8(),s.subSequenceIdentifier=t.readUint16()}}),BoxParser.createSampleGroupCtor("dtrt",function(t){Log.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),BoxParser.createSampleGroupCtor("mvif",function(t){Log.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),BoxParser.createSampleGroupCtor("prol",function(t){this.roll_distance=t.readInt16()}),BoxParser.createSampleGroupCtor("rap ",function(t){var e=t.readUint8();this.num_leading_samples_known=e>>7,this.num_leading_samples=127&e}),BoxParser.createSampleGroupCtor("rash",function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(1===this.operation_point_count?2:6*this.operation_point_count)+9)Log.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(1===this.operation_point_count)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var e=0;e<this.operation_point_count;e++)this.available_bitrate[e]=t.readUint32(),this.target_rate_share[e]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}}),BoxParser.createSampleGroupCtor("roll",function(t){this.roll_distance=t.readInt16()}),BoxParser.SampleGroupEntry.prototype.parse=function(t){Log.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)},BoxParser.createSampleGroupCtor("scif",function(t){Log.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),BoxParser.createSampleGroupCtor("scnm",function(t){Log.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),BoxParser.createSampleGroupCtor("seig",function(t){this.reserved=t.readUint8();var e=t.readUint8();this.crypt_byte_block=e>>4,this.skip_byte_block=15&e,this.isProtected=t.readUint8(),this.Per_Sample_IV_Size=t.readUint8(),this.KID=BoxParser.parseHex16(t),this.constant_IV_size=0,this.constant_IV=0,1===this.isProtected&&0===this.Per_Sample_IV_Size&&(this.constant_IV_size=t.readUint8(),this.constant_IV=t.readUint8Array(this.constant_IV_size))}),BoxParser.createSampleGroupCtor("stsa",function(t){Log.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),BoxParser.createSampleGroupCtor("sync",function(t){var e=t.readUint8();this.NAL_unit_type=63&e}),BoxParser.createSampleGroupCtor("tele",function(t){var e=t.readUint8();this.level_independently_decodable=e>>7}),BoxParser.createSampleGroupCtor("tsas",function(t){Log.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),BoxParser.createSampleGroupCtor("tscl",function(t){Log.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),BoxParser.createSampleGroupCtor("vipr",function(t){Log.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),BoxParser.createFullBoxCtor("sbgp",function(t){this.grouping_type=t.readString(4),1===this.version?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var r={};this.entries.push(r),r.sample_count=t.readInt32(),r.group_description_index=t.readInt32()}}),BoxParser.createFullBoxCtor("schm",function(t){this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),1&this.flags&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))}),BoxParser.createBoxCtor("sdp ",function(t){this.sdptext=t.readString(this.size-this.hdr_size)}),BoxParser.createFullBoxCtor("sdtp",function(t){var e,i=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var r=0;r<i;r++)e=t.readUint8(),this.is_leading[r]=e>>6,this.sample_depends_on[r]=e>>4&3,this.sample_is_depended_on[r]=e>>2&3,this.sample_has_redundancy[r]=3&e}),BoxParser.createFullBoxCtor("senc"),BoxParser.createFullBoxCtor("sgpd",function(t){this.grouping_type=t.readString(4),Log.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),1===this.version?this.default_length=t.readUint32():this.default_length=0,2<=this.version&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var r=BoxParser[this.grouping_type+"SampleGroupEntry"]?new BoxParser[this.grouping_type+"SampleGroupEntry"](this.grouping_type):new BoxParser.SampleGroupEntry(this.grouping_type);this.entries.push(r),1===this.version&&0===this.default_length?r.description_length=t.readUint32():r.description_length=this.default_length,r.write===BoxParser.SampleGroupEntry.prototype.write&&(Log.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),r.data=t.readUint8Array(r.description_length),t.position-=r.description_length),r.parse(t)}}),BoxParser.createFullBoxCtor("sidx",function(t){this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),0===this.version?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var e=t.readUint16(),i=0;i<e;i++){var r={};this.references.push(r);var s=t.readUint32();r.reference_type=s>>31&1,r.referenced_size=2147483647&s,r.subsegment_duration=t.readUint32(),s=t.readUint32(),r.starts_with_SAP=s>>31&1,r.SAP_type=s>>28&7,r.SAP_delta_time=268435455&s}}),BoxParser.SingleItemTypeReferenceBox=function(t,e,i,r){BoxParser.Box.call(this,t,e),this.hdr_size=i,this.start=r},BoxParser.SingleItemTypeReferenceBox.prototype=new BoxParser.Box,BoxParser.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var e=t.readUint16();this.references=[];for(var i=0;i<e;i++)this.references[i]=t.readUint16()},BoxParser.SingleItemTypeReferenceBoxLarge=function(t,e,i,r){BoxParser.Box.call(this,t,e),this.hdr_size=i,this.start=r},BoxParser.SingleItemTypeReferenceBoxLarge.prototype=new BoxParser.Box,BoxParser.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var e=t.readUint16();this.references=[];for(var i=0;i<e;i++)this.references[i]=t.readUint32()},BoxParser.createFullBoxCtor("SmDm",function(t){this.primaryRChromaticity_x=t.readUint16(),this.primaryRChromaticity_y=t.readUint16(),this.primaryGChromaticity_x=t.readUint16(),this.primaryGChromaticity_y=t.readUint16(),this.primaryBChromaticity_x=t.readUint16(),this.primaryBChromaticity_y=t.readUint16(),this.whitePointChromaticity_x=t.readUint16(),this.whitePointChromaticity_y=t.readUint16(),this.luminanceMax=t.readUint32(),this.luminanceMin=t.readUint32()}),BoxParser.createFullBoxCtor("smhd",function(t){this.balance=t.readUint16(),t.readUint16()}),BoxParser.createFullBoxCtor("ssix",function(t){this.subsegments=[];for(var e=t.readUint32(),i=0;i<e;i++){var r={};this.subsegments.push(r),r.ranges=[];for(var s=t.readUint32(),a=0;a<s;a++){var n={};r.ranges.push(n),n.level=t.readUint8(),n.range_size=t.readUint24()}}}),BoxParser.createFullBoxCtor("stco",function(t){var e=t.readUint32();if(this.chunk_offsets=[],0===this.version)for(var i=0;i<e;i++)this.chunk_offsets.push(t.readUint32())}),BoxParser.createFullBoxCtor("stdp",function(t){var e=(this.size-this.hdr_size)/2;this.priority=[];for(var i=0;i<e;i++)this.priority[i]=t.readUint16()}),BoxParser.createFullBoxCtor("sthd"),BoxParser.createFullBoxCtor("stri",function(t){this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var e=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var i=0;i<e;i++)this.attribute_list[i]=t.readUint32()}),BoxParser.createFullBoxCtor("stsc",function(t){var e,i=t.readUint32();if(this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],0===this.version)for(e=0;e<i;e++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32())}),BoxParser.createFullBoxCtor("stsd",function(t){var e,i,r,s;for(this.entries=[],r=t.readUint32(),e=1;e<=r;e++){if((i=BoxParser.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==BoxParser.OK)return;BoxParser[i.type+"SampleEntry"]?((s=new BoxParser[i.type+"SampleEntry"](i.size)).hdr_size=i.hdr_size,s.start=i.start):(Log.warn("BoxParser","Unknown sample entry type: "+i.type),s=new BoxParser.SampleEntry(i.type,i.size,i.hdr_size,i.start)),s.write===BoxParser.SampleEntry.prototype.write&&(Log.info("BoxParser","SampleEntry "+s.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),s.parseDataAndRewind(t)),s.parse(t),this.entries.push(s)}}),BoxParser.createFullBoxCtor("stsg",function(t){this.grouping_type=t.readUint32();var e=t.readUint16();this.group_description_index=[];for(var i=0;i<e;i++)this.group_description_index[i]=t.readUint32()}),BoxParser.createFullBoxCtor("stsh",function(t){var e,i=t.readUint32();if(this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],0===this.version)for(e=0;e<i;e++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32())}),BoxParser.createFullBoxCtor("stss",function(t){var e,i=t.readUint32();if(0===this.version)for(this.sample_numbers=[],e=0;e<i;e++)this.sample_numbers.push(t.readUint32())}),BoxParser.createFullBoxCtor("stsz",function(t){var e;if(this.sample_sizes=[],0===this.version)for(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),e=0;e<this.sample_count;e++)0===this.sample_size?this.sample_sizes.push(t.readUint32()):this.sample_sizes[e]=this.sample_size}),BoxParser.createFullBoxCtor("stts",function(t){var e,i,r=t.readUint32();if(this.sample_counts=[],this.sample_deltas=[],0===this.version)for(e=0;e<r;e++)this.sample_counts.push(t.readUint32()),(i=t.readInt32())<0&&(Log.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),i=1),this.sample_deltas.push(i)}),BoxParser.createFullBoxCtor("stvi",function(t){var e=t.readUint32();this.single_view_allowed=3&e,this.stereo_scheme=t.readUint32();var i,r,s=t.readUint32();for(this.stereo_indication_type=t.readString(s),this.boxes=[];t.getPosition()<this.start+this.size;){if((i=BoxParser.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).code!==BoxParser.OK)return;r=i.box,this.boxes.push(r),this[r.type]=r}}),BoxParser.createBoxCtor("styp",function(t){BoxParser.ftypBox.prototype.parse.call(this,t)}),BoxParser.createFullBoxCtor("stz2",function(t){var e,i;if(this.sample_sizes=[],0===this.version)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),i=t.readUint32(),4===this.field_size)for(e=0;e<i;e+=2){var r=t.readUint8();this.sample_sizes[e]=r>>4&15,this.sample_sizes[e+1]=15&r}else if(8===this.field_size)for(e=0;e<i;e++)this.sample_sizes[e]=t.readUint8();else if(16===this.field_size)for(e=0;e<i;e++)this.sample_sizes[e]=t.readUint16();else Log.error("BoxParser","Error in length field in stz2 box")}),BoxParser.createFullBoxCtor("subs",function(t){var e,i,r,s=t.readUint32();for(this.entries=[],e=0;e<s;e++){var a={};if((this.entries[e]=a).sample_delta=t.readUint32(),a.subsamples=[],0<(r=t.readUint16()))for(i=0;i<r;i++){var n={};a.subsamples.push(n),1==this.version?n.size=t.readUint32():n.size=t.readUint16(),n.priority=t.readUint8(),n.discardable=t.readUint8(),n.codec_specific_parameters=t.readUint32()}}}),BoxParser.createFullBoxCtor("tenc",function(t){var e;t.readUint8(),0===this.version?t.readUint8():(e=t.readUint8(),this.default_crypt_byte_block=e>>4&15,this.default_skip_byte_block=15&e),this.default_isProtected=t.readUint8(),this.default_Per_Sample_IV_Size=t.readUint8(),this.default_KID=BoxParser.parseHex16(t),1===this.default_isProtected&&0===this.default_Per_Sample_IV_Size&&(this.default_constant_IV_size=t.readUint8(),this.default_constant_IV=t.readUint8Array(this.default_constant_IV_size))}),BoxParser.createFullBoxCtor("tfdt",function(t){1==this.version?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()}),BoxParser.createFullBoxCtor("tfhd",function(t){var e=0;this.track_id=t.readUint32(),this.size-this.hdr_size>e&&this.flags&BoxParser.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),e+=8):this.base_data_offset=0,this.size-this.hdr_size>e&&this.flags&BoxParser.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),e+=4):this.default_sample_description_index=0,this.size-this.hdr_size>e&&this.flags&BoxParser.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),e+=4):this.default_sample_duration=0,this.size-this.hdr_size>e&&this.flags&BoxParser.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),e+=4):this.default_sample_size=0,this.size-this.hdr_size>e&&this.flags&BoxParser.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),e+=4):this.default_sample_flags=0}),BoxParser.createFullBoxCtor("tfra",function(t){this.track_ID=t.readUint32(),t.readUint24();var e=t.readUint8();this.length_size_of_traf_num=e>>4&3,this.length_size_of_trun_num=e>>2&3,this.length_size_of_sample_num=3&e,this.entries=[];for(var i=t.readUint32(),r=0;r<i;r++)1===this.version?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()}),BoxParser.createFullBoxCtor("tkhd",function(t){1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()}),BoxParser.createBoxCtor("tmax",function(t){this.time=t.readUint32()}),BoxParser.createBoxCtor("tmin",function(t){this.time=t.readUint32()}),BoxParser.createBoxCtor("totl",function(t){this.bytessent=t.readUint32()}),BoxParser.createBoxCtor("tpay",function(t){this.bytessent=t.readUint32()}),BoxParser.createBoxCtor("tpyl",function(t){this.bytessent=t.readUint64()}),BoxParser.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()},BoxParser.createTrackGroupCtor("msrc"),BoxParser.TrackReferenceTypeBox=function(t,e,i,r){BoxParser.Box.call(this,t,e),this.hdr_size=i,this.start=r},BoxParser.TrackReferenceTypeBox.prototype=new BoxParser.Box,BoxParser.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)},BoxParser.trefBox.prototype.parse=function(t){for(var e,i;t.getPosition()<this.start+this.size;){if((e=BoxParser.parseOneBox(t,!0,this.size-(t.getPosition()-this.start))).code!==BoxParser.OK)return;(i=new BoxParser.TrackReferenceTypeBox(e.type,e.size,e.hdr_size,e.start)).write===BoxParser.Box.prototype.write&&"mdat"!==i.type&&(Log.info("BoxParser","TrackReference "+i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(t)),i.parse(t),this.boxes.push(i)}},BoxParser.createFullBoxCtor("trep",function(t){for(this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;){if(ret=BoxParser.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),ret.code!==BoxParser.OK)return;box=ret.box,this.boxes.push(box)}}),BoxParser.createFullBoxCtor("trex",function(t){this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()}),BoxParser.createBoxCtor("trpy",function(t){this.bytessent=t.readUint64()}),BoxParser.createFullBoxCtor("trun",function(t){var e=0;if(this.sample_count=t.readUint32(),e+=4,this.size-this.hdr_size>e&&this.flags&BoxParser.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),e+=4):this.data_offset=0,this.size-this.hdr_size>e&&this.flags&BoxParser.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),e+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>e)for(var i=0;i<this.sample_count;i++)this.flags&BoxParser.TRUN_FLAGS_DURATION&&(this.sample_duration[i]=t.readUint32()),this.flags&BoxParser.TRUN_FLAGS_SIZE&&(this.sample_size[i]=t.readUint32()),this.flags&BoxParser.TRUN_FLAGS_FLAGS&&(this.sample_flags[i]=t.readUint32()),this.flags&BoxParser.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?this.sample_composition_time_offset[i]=t.readUint32():this.sample_composition_time_offset[i]=t.readInt32())}),BoxParser.createFullBoxCtor("tsel",function(t){this.switch_group=t.readUint32();var e=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var i=0;i<e;i++)this.attribute_list[i]=t.readUint32()}),BoxParser.createFullBoxCtor("txtC",function(t){this.config=t.readCString()}),BoxParser.createFullBoxCtor("url ",function(t){1!==this.flags&&(this.location=t.readCString())}),BoxParser.createFullBoxCtor("urn ",function(t){this.name=t.readCString(),0<this.size-this.hdr_size-this.name.length-1&&(this.location=t.readCString())}),BoxParser.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,function(t){this.LiveServerManifest=t.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),BoxParser.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,function(t){this.system_id=BoxParser.parseHex16(t);var e=t.readUint32();0<e&&(this.data=t.readUint8Array(e))}),BoxParser.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),BoxParser.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,function(t){this.default_AlgorithmID=t.readUint24(),this.default_IV_size=t.readUint8(),this.default_KID=BoxParser.parseHex16(t)}),BoxParser.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,function(t){this.fragment_count=t.readUint8(),this.entries=[];for(var e=0;e<this.fragment_count;e++){var i={},r=0,s=0,s=1===this.version?(r=t.readUint64(),t.readUint64()):(r=t.readUint32(),t.readUint32());i.absolute_time=r,i.absolute_duration=s,this.entries.push(i)}}),BoxParser.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,function(t){1===this.version?(this.absolute_time=t.readUint64(),this.duration=t.readUint64()):(this.absolute_time=t.readUint32(),this.duration=t.readUint32())}),BoxParser.createFullBoxCtor("vmhd",function(t){this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)}),BoxParser.createFullBoxCtor("vpcC",function(t){var e;1===this.version?(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4,this.chromaSubsampling=e>>1&7,this.videoFullRangeFlag=1&e,this.colourPrimaries=t.readUint8(),this.transferCharacteristics=t.readUint8(),this.matrixCoefficients=t.readUint8()):(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4&15,this.colorSpace=15&e,e=t.readUint8(),this.chromaSubsampling=e>>4&15,this.transferFunction=e>>1&7,this.videoFullRangeFlag=1&e),this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize)}),BoxParser.createBoxCtor("vttC",function(t){this.text=t.readString(this.size-this.hdr_size)}),BoxParser.SampleEntry.prototype.isVideo=function(){return!1},BoxParser.SampleEntry.prototype.isAudio=function(){return!1},BoxParser.SampleEntry.prototype.isSubtitle=function(){return!1},BoxParser.SampleEntry.prototype.isMetadata=function(){return!1},BoxParser.SampleEntry.prototype.isHint=function(){return!1},BoxParser.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},BoxParser.SampleEntry.prototype.getWidth=function(){return""},BoxParser.SampleEntry.prototype.getHeight=function(){return""},BoxParser.SampleEntry.prototype.getChannelCount=function(){return""},BoxParser.SampleEntry.prototype.getSampleRate=function(){return""},BoxParser.SampleEntry.prototype.getSampleSize=function(){return""},BoxParser.VisualSampleEntry.prototype.isVideo=function(){return!0},BoxParser.VisualSampleEntry.prototype.getWidth=function(){return this.width},BoxParser.VisualSampleEntry.prototype.getHeight=function(){return this.height},BoxParser.AudioSampleEntry.prototype.isAudio=function(){return!0},BoxParser.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},BoxParser.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},BoxParser.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},BoxParser.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},BoxParser.MetadataSampleEntry.prototype.isMetadata=function(){return!0},BoxParser.decimalToHex=function(t,e){var i=Number(t).toString(16);for(e=null==e?e=2:e;i.length<e;)i="0"+i;return i},BoxParser.avc1SampleEntry.prototype.getCodec=BoxParser.avc2SampleEntry.prototype.getCodec=BoxParser.avc3SampleEntry.prototype.getCodec=BoxParser.avc4SampleEntry.prototype.getCodec=function(){var t=BoxParser.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+BoxParser.decimalToHex(this.avcC.AVCProfileIndication)+BoxParser.decimalToHex(this.avcC.profile_compatibility)+BoxParser.decimalToHex(this.avcC.AVCLevelIndication):t},BoxParser.hev1SampleEntry.prototype.getCodec=BoxParser.hvc1SampleEntry.prototype.getCodec=function(){var t=BoxParser.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(t+=".",this.hvcC.general_profile_space){case 0:t+="";break;case 1:t+="A";break;case 2:t+="B";break;case 3:t+="C"}t+=this.hvcC.general_profile_idc,t+=".";for(var e=this.hvcC.general_profile_compatibility,i=0,r=0;r<32&&(i|=1&e,31!=r);r++)i<<=1,e>>=1;t+=BoxParser.decimalToHex(i,0),t+=".",0===this.hvcC.general_tier_flag?t+="L":t+="H",t+=this.hvcC.general_level_idc;var s=!1,a="";for(r=5;0<=r;r--)(this.hvcC.general_constraint_indicator[r]||s)&&(a="."+BoxParser.decimalToHex(this.hvcC.general_constraint_indicator[r],0)+a,s=!0);t+=a}return t},BoxParser.mp4aSampleEntry.prototype.getCodec=function(){var t=BoxParser.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var e=this.esds.esd.getOTI(),i=this.esds.esd.getAudioConfig();return t+"."+BoxParser.decimalToHex(e)+(i?"."+i:"")}return t},BoxParser.stxtSampleEntry.prototype.getCodec=function(){var t=BoxParser.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t},BoxParser.av01SampleEntry.prototype.getCodec=function(){var t,e=BoxParser.SampleEntry.prototype.getCodec.call(this);return 2===this.av1C.seq_profile&&1===this.av1C.high_bitdepth?t=1===this.av1C.twelve_bit?"12":"10":this.av1C.seq_profile<=2&&(t=1===this.av1C.high_bitdepth?"10":"08"),e+"."+this.av1C.seq_profile+"."+this.av1C.seq_level_idx_0+(this.av1C.seq_tier_0?"H":"M")+"."+t},BoxParser.Box.prototype.writeHeader=function(t,e){this.size+=8,this.size>MAX_SIZE&&(this.size+=8),"uuid"===this.type&&(this.size+=16),Log.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(e||"")),this.size>MAX_SIZE?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),"uuid"===this.type&&t.writeUint8Array(this.uuid),this.size>MAX_SIZE&&t.writeUint64(this.size)},BoxParser.FullBox.prototype.writeHeader=function(t){this.size+=4,BoxParser.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)},BoxParser.Box.prototype.write=function(t){"mdat"===this.type?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(t),this.data&&t.writeUint8Array(this.data))},BoxParser.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&(this.boxes[e].write(t),this.size+=this.boxes[e].size);Log.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},BoxParser.TrackReferenceTypeBox.prototype.write=function(t){this.size=4*this.track_ids.length,this.writeHeader(t),t.writeUint32Array(this.track_ids)},BoxParser.avcCBox.prototype.write=function(t){var e;for(this.size=7,e=0;e<this.SPS.length;e++)this.size+=2+this.SPS[e].length;for(e=0;e<this.PPS.length;e++)this.size+=2+this.PPS[e].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+252),t.writeUint8(this.SPS.length+224),e=0;e<this.SPS.length;e++)t.writeUint16(this.SPS[e].length),t.writeUint8Array(this.SPS[e].nalu);for(t.writeUint8(this.PPS.length),e=0;e<this.PPS.length;e++)t.writeUint16(this.PPS[e].length),t.writeUint8Array(this.PPS[e].nalu);this.ext&&t.writeUint8Array(this.ext)},BoxParser.co64Box.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),e=0;e<this.chunk_offsets.length;e++)t.writeUint64(this.chunk_offsets[e])},BoxParser.cslgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)},BoxParser.cttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),1===this.version?t.writeInt32(this.sample_offsets[e]):t.writeUint32(this.sample_offsets[e])},BoxParser.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;Log.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},BoxParser.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)},BoxParser.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var i=this.entries[e];t.writeUint32(i.segment_duration),t.writeInt32(i.media_time),t.writeInt16(i.media_rate_integer),t.writeInt16(i.media_rate_fraction)}},BoxParser.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=16+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)},BoxParser.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var e=0;e<this.compatible_brands.length;e++)t.writeString(this.compatible_brands[e],null,4)},BoxParser.hdlrBox.prototype.write=function(t){this.size=20+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)},BoxParser.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)},BoxParser.mdhdBox.prototype.write=function(t){this.size=20,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)},BoxParser.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)},BoxParser.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)},BoxParser.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=96,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)},BoxParser.SampleEntry.prototype.writeHeader=function(t){this.size=8,BoxParser.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)},BoxParser.SampleEntry.prototype.writeFooter=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t),this.size+=this.boxes[e].size;Log.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},BoxParser.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,Log.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},BoxParser.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=70,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeUint8(Math.min(31,this.compressorname.length)),t.writeString(this.compressorname,null,31),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)},BoxParser.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=20,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)},BoxParser.stppSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,t.writeCString(this.namespace),t.writeCString(this.schema_location),t.writeCString(this.auxiliary_mime_types),this.writeFooter(t)},BoxParser.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)},BoxParser.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var i=this.entries[e];t.writeInt32(i.sample_count),t.writeInt32(i.group_description_index)}},BoxParser.sgpdBox.prototype.write=function(t){var e,i;for(this.flags=0,this.size=12,e=0;e<this.entries.length;e++)i=this.entries[e],1===this.version&&(0===this.default_length&&(this.size+=4),this.size+=i.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),1===this.version&&t.writeUint32(this.default_length),2<=this.version&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),e=0;e<this.entries.length;e++)i=this.entries[e],1===this.version&&0===this.default_length&&t.writeUint32(i.description_length),i.write(t)},BoxParser.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var e=0;e<this.references.length;e++){var i=this.references[e];t.writeUint32(i.reference_type<<31|i.referenced_size),t.writeUint32(i.subsegment_duration),t.writeUint32(i.starts_with_SAP<<31|i.SAP_type<<28|i.SAP_delta_time)}},BoxParser.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)},BoxParser.stscBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),e=0;e<this.first_chunk.length;e++)t.writeUint32(this.first_chunk[e]),t.writeUint32(this.samples_per_chunk[e]),t.writeUint32(this.sample_description_index[e])},BoxParser.stsdBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;Log.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},BoxParser.stshBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),e=0;e<this.shadowed_sample_numbers.length;e++)t.writeUint32(this.shadowed_sample_numbers[e]),t.writeUint32(this.sync_sample_numbers[e])},BoxParser.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)},BoxParser.stszBox.prototype.write=function(t){var e,i=!0;if(this.version=0,(this.flags=0)<this.sample_sizes.length)for(e=0;e+1<this.sample_sizes.length;){if(this.sample_sizes[e+1]!==this.sample_sizes[0]){i=!1;break}e++}else i=!1;this.size=8,i||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),i?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),i||t.writeUint32Array(this.sample_sizes)},BoxParser.sttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),t.writeUint32(this.sample_deltas[e])};var UINT32_MAX=Math.pow(2,32)-1;BoxParser.tfdtBox.prototype.write=function(t){this.version=this.baseMediaDecodeTime>UINT32_MAX?1:0,this.flags=0,this.size=4,1===this.version&&(this.size+=4),this.writeHeader(t),1===this.version?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)},BoxParser.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&BoxParser.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&BoxParser.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&BoxParser.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&BoxParser.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&BoxParser.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&BoxParser.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&BoxParser.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&BoxParser.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&BoxParser.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&BoxParser.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)},BoxParser.tkhdBox.prototype.write=function(t){this.version=0,this.size=80,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)},BoxParser.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)},BoxParser.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&BoxParser.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&BoxParser.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&BoxParser.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&BoxParser.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&BoxParser.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&BoxParser.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&BoxParser.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&BoxParser.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var e=0;e<this.sample_count;e++)this.flags&BoxParser.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[e]),this.flags&BoxParser.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[e]),this.flags&BoxParser.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[e]),this.flags&BoxParser.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?t.writeUint32(this.sample_composition_time_offset[e]):t.writeInt32(this.sample_composition_time_offset[e]))},BoxParser["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)},BoxParser["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)},BoxParser.vmhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)},BoxParser.cttsBox.prototype.unpack=function(t){for(var e,i=0,r=0;r<this.sample_counts.length;r++)for(e=0;e<this.sample_counts[r];e++)t[i].pts=t[i].dts+this.sample_offsets[r],i++},BoxParser.sttsBox.prototype.unpack=function(t){for(var e,i=0,r=0;r<this.sample_counts.length;r++)for(e=0;e<this.sample_counts[r];e++)t[i].dts=0===i?0:t[i-1].dts+this.sample_deltas[r],i++},BoxParser.stcoBox.prototype.unpack=function(t){for(var e=0;e<this.chunk_offsets.length;e++)t[e].offset=this.chunk_offsets[e]},BoxParser.stscBox.prototype.unpack=function(t){for(var e,i,r=0,s=0,a=0;a<this.first_chunk.length;a++)for(e=0;e<(a+1<this.first_chunk.length?this.first_chunk[a+1]:1/0);e++)for(s++,i=0;i<this.samples_per_chunk[a];i++){if(!t[r])return;t[r].description_index=this.sample_description_index[a],t[r].chunk_index=s,r++}},BoxParser.stszBox.prototype.unpack=function(t){for(var e=0;e<this.sample_sizes.length;e++)t[e].size=this.sample_sizes[e]},BoxParser.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],BoxParser.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],BoxParser.boxEqualFields=function(t,e){if(t&&!e)return!1;var i;for(i in t)if(!(-1<BoxParser.DIFF_BOXES_PROP_NAMES.indexOf(i)||t[i]instanceof BoxParser.Box||e[i]instanceof BoxParser.Box||void 0===t[i]||void 0===e[i]||"function"==typeof t[i]||"function"==typeof e[i]||t.subBoxNames&&-1<t.subBoxNames.indexOf(i.slice(0,4))||e.subBoxNames&&-1<e.subBoxNames.indexOf(i.slice(0,4))||"data"===i||"start"===i||"size"===i||"creation_time"===i||"modification_time"===i||-1<BoxParser.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(i)||t[i]===e[i]))return!1;return!0},BoxParser.boxEqual=function(t,e){if(!BoxParser.boxEqualFields(t,e))return!1;for(var i=0;i<BoxParser.DIFF_BOXES_PROP_NAMES.length;i++){var r=BoxParser.DIFF_BOXES_PROP_NAMES[i];if(t[r]&&e[r]&&!BoxParser.boxEqual(t[r],e[r]))return!1}return!0};var VTTin4Parser=function(){};VTTin4Parser.prototype.parseSample=function(t){for(var e,i=new MP4BoxStream(t.buffer),r=[];!i.isEos();)(e=BoxParser.parseOneBox(i,!1)).code===BoxParser.OK&&"vttc"===e.box.type&&r.push(e.box);return r},VTTin4Parser.prototype.getText=function(t,e,i){function a(t,e,i){return i=i||"0",(t+="").length>=e?t:new Array(e-t.length+1).join(i)+t}function r(t){var e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),r=Math.floor(t-3600*e-60*i),s=Math.floor(1e3*(t-3600*e-60*i-r));return a(e,2)+":"+a(i,2)+":"+a(r,2)+"."+a(s,3)}for(var s=this.parseSample(i),n="",o=0;o<s.length;o++){var h=s[o];n+=r(t)+" --\x3e "+r(e)+"\r\n",n+=h.payl.text}return n};var XMLSubtitlein4Parser=function(){};XMLSubtitlein4Parser.prototype.parseSample=function(t){var e,i={resources:[]},r=new MP4BoxStream(t.data.buffer);if(t.subsamples&&0!==t.subsamples.length){if(i.documentString=r.readString(t.subsamples[0].size),1<t.subsamples.length)for(e=1;e<t.subsamples.length;e++)i.resources[e]=r.readUint8Array(t.subsamples[e].size)}else i.documentString=r.readString(t.data.length);return"undefined"!=typeof DOMParser&&(i.document=(new DOMParser).parseFromString(i.documentString,"application/xml")),i};var Textin4Parser=function(){};Textin4Parser.prototype.parseSample=function(t){return new MP4BoxStream(t.data.buffer).readString(t.data.length)},Textin4Parser.prototype.parseConfig=function(t){var e=new MP4BoxStream(t.buffer);return e.readUint32(),e.readCString()},"undefined"!=typeof exports&&(exports.XMLSubtitlein4Parser=XMLSubtitlein4Parser,exports.Textin4Parser=Textin4Parser);var ISOFile=function(t){this.stream=t||new MultiBufferStream,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};ISOFile.prototype.setSegmentOptions=function(t,e,i){var r,s=this.getTrackById(t);s&&(r={},this.fragmentedTracks.push(r),r.id=t,r.user=e,(r.trak=s).nextSample=0,r.segmentStream=null,r.nb_samples=1e3,r.rapAlignement=!0,i&&(i.nbSamples&&(r.nb_samples=i.nbSamples),i.rapAlignement&&(r.rapAlignement=i.rapAlignement)))},ISOFile.prototype.unsetSegmentOptions=function(t){for(var e=-1,i=0;i<this.fragmentedTracks.length;i++){this.fragmentedTracks[i].id==t&&(e=i)}-1<e&&this.fragmentedTracks.splice(e,1)},ISOFile.prototype.setExtractionOptions=function(t,e,i){var r,s=this.getTrackById(t);s&&(r={},this.extractedTracks.push(r),r.id=t,r.user=e,(r.trak=s).nextSample=0,r.nb_samples=1e3,r.samples=[],i&&i.nbSamples&&(r.nb_samples=i.nbSamples))},ISOFile.prototype.unsetExtractionOptions=function(t){for(var e=-1,i=0;i<this.extractedTracks.length;i++){this.extractedTracks[i].id==t&&(e=i)}-1<e&&this.extractedTracks.splice(e,1)},ISOFile.prototype.parse=function(){var t;if(!this.restoreParsePosition||this.restoreParsePosition())for(;;){if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}if(this.saveParsePosition&&this.saveParsePosition(),(t=BoxParser.parseOneBox(this.stream,!1)).code===BoxParser.ERR_NOT_ENOUGH_DATA){if(this.processIncompleteBox){if(this.processIncompleteBox(t))continue;return}return}var e,i="uuid"!==(e=t.box).type?e.type:e.uuid;switch(this.boxes.push(e),i){case"mdat":this.mdats.push(e);break;case"moof":this.moofs.push(e);break;case"moov":this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0);default:void 0!==this[i]&&Log.warn("ISOFile","Duplicate Box of type: "+i+", overriding previous occurrence"),this[i]=e}this.updateUsedBytes&&this.updateUsedBytes(e,t)}},ISOFile.prototype.checkBuffer=function(t){if(null==t)throw"Buffer must be defined and non empty";if(void 0===t.fileStart)throw"Buffer must have a fileStart property";return 0===t.byteLength?(Log.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(Log.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),!!this.stream.initialized()||(Log.warn("ISOFile","Not ready to start parsing"),!1))},ISOFile.prototype.appendBuffer=function(t,e){var i;if(this.checkBuffer(t))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(e),this.nextSeekPosition?(i=this.nextSeekPosition,this.nextSeekPosition=void 0):i=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(i=this.stream.getEndFilePositionAfter(i))):i=this.nextParsePosition?this.nextParsePosition:0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(Log.info("ISOFile","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+i),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),Log.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),i},ISOFile.prototype.getInfo=function(){var t,e,i,r,s,a={},n=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(a.hasMoov=!0,a.duration=this.moov.mvhd.duration,a.timescale=this.moov.mvhd.timescale,a.isFragmented=null!=this.moov.mvex,a.isFragmented&&this.moov.mvex.mehd&&(a.fragment_duration=this.moov.mvex.mehd.fragment_duration),a.isProgressive=this.isProgressive,a.hasIOD=null!=this.moov.iods,a.brands=[],a.brands.push(this.ftyp.major_brand),a.brands=a.brands.concat(this.ftyp.compatible_brands),a.created=new Date(n+1e3*this.moov.mvhd.creation_time),a.modified=new Date(n+1e3*this.moov.mvhd.modification_time),a.tracks=[],a.audioTracks=[],a.videoTracks=[],a.subtitleTracks=[],a.metadataTracks=[],a.hintTracks=[],a.otherTracks=[],t=0;t<this.moov.traks.length;t++){if(s=(i=this.moov.traks[t]).mdia.minf.stbl.stsd.entries[0],r={},a.tracks.push(r),r.id=i.tkhd.track_id,r.name=i.mdia.hdlr.name,r.references=[],i.tref)for(e=0;e<i.tref.boxes.length;e++)ref={},r.references.push(ref),ref.type=i.tref.boxes[e].type,ref.track_ids=i.tref.boxes[e].track_ids;i.edts&&(r.edits=i.edts.elst.entries),r.created=new Date(n+1e3*i.tkhd.creation_time),r.modified=new Date(n+1e3*i.tkhd.modification_time),r.movie_duration=i.tkhd.duration,r.movie_timescale=a.timescale,r.layer=i.tkhd.layer,r.alternate_group=i.tkhd.alternate_group,r.volume=i.tkhd.volume,r.matrix=i.tkhd.matrix,r.track_width=i.tkhd.width/65536,r.track_height=i.tkhd.height/65536,r.timescale=i.mdia.mdhd.timescale,r.cts_shift=i.mdia.minf.stbl.cslg,r.duration=i.mdia.mdhd.duration,r.samples_duration=i.samples_duration,r.codec=s.getCodec(),r.kind=i.udta&&i.udta.kinds.length?i.udta.kinds[0]:{schemeURI:"",value:""},r.language=i.mdia.elng?i.mdia.elng.extended_language:i.mdia.mdhd.languageString,r.nb_samples=i.samples.length,r.size=i.samples_size,r.bitrate=8*r.size*r.timescale/r.samples_duration,s.isAudio()?(r.type="audio",a.audioTracks.push(r),r.audio={},r.audio.sample_rate=s.getSampleRate(),r.audio.channel_count=s.getChannelCount(),r.audio.sample_size=s.getSampleSize()):s.isVideo()?(r.type="video",a.videoTracks.push(r),r.video={},r.video.width=s.getWidth(),r.video.height=s.getHeight()):s.isSubtitle()?(r.type="subtitles",a.subtitleTracks.push(r)):s.isHint()?(r.type="metadata",a.hintTracks.push(r)):s.isMetadata()?(r.type="metadata",a.metadataTracks.push(r)):(r.type="metadata",a.otherTracks.push(r))}else a.hasMoov=!1;if(a.mime="",a.hasMoov&&a.tracks){for(a.videoTracks&&0<a.videoTracks.length?a.mime+='video/mp4; codecs="':a.audioTracks&&0<a.audioTracks.length?a.mime+='audio/mp4; codecs="':a.mime+='application/mp4; codecs="',t=0;t<a.tracks.length;t++)0!==t&&(a.mime+=","),a.mime+=a.tracks[t].codec;a.mime+='"; profiles="',a.mime+=this.ftyp.compatible_brands.join(),a.mime+='"'}return a},ISOFile.prototype.processSamples=function(t){var e;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&null!==this.onSegment)for(e=0;e<this.fragmentedTracks.length;e++)for(var i=this.fragmentedTracks[e],r=i.trak;r.nextSample<r.samples.length&&this.sampleProcessingStarted;){Log.debug("ISOFile","Creating media fragment on track #"+i.id+" for sample "+r.nextSample);var s=this.createFragment(i.id,r.nextSample,i.segmentStream);if(!s)break;if(i.segmentStream=s,r.nextSample++,(r.nextSample%i.nb_samples==0||t&&r.nextSample>=r.samples.length)&&(Log.info("ISOFile","Sending fragmented data on track #"+i.id+" for samples ["+Math.max(0,r.nextSample-i.nb_samples)+","+(r.nextSample-1)+"]"),Log.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(i.id,i.user,i.segmentStream.buffer,r.nextSample,t&&r.nextSample>=r.samples.length),i.segmentStream=null,i!==this.fragmentedTracks[e]))break}if(null!==this.onSamples)for(e=0;e<this.extractedTracks.length;e++){var a=this.extractedTracks[e];for(r=a.trak;r.nextSample<r.samples.length&&this.sampleProcessingStarted;){Log.debug("ISOFile","Exporting on track #"+a.id+" sample #"+r.nextSample);var n=this.getSample(r,r.nextSample);if(!n)break;if(r.nextSample++,a.samples.push(n),(r.nextSample%a.nb_samples==0||r.nextSample>=r.samples.length)&&(Log.debug("ISOFile","Sending samples on track #"+a.id+" for sample "+r.nextSample),this.onSamples&&this.onSamples(a.id,a.user,a.samples),a.samples=[],a!==this.extractedTracks[e]))break}}}},ISOFile.prototype.getBox=function(t){var e=this.getBoxes(t,!0);return e.length?e[0]:null},ISOFile.prototype.getBoxes=function(t,e){var i=[];return ISOFile._sweep.call(this,t,i,e),i},ISOFile._sweep=function(t,e,i){for(var r in this.type&&this.type==t&&e.push(this),this.boxes){if(e.length&&i)return;ISOFile._sweep.call(this.boxes[r],t,e,i)}},ISOFile.prototype.getTrackSamplesInfo=function(t){var e=this.getTrackById(t);return e?e.samples:void 0},ISOFile.prototype.getTrackSample=function(t,e){var i=this.getTrackById(t);return this.getSample(i,e)},ISOFile.prototype.releaseUsedSamples=function(t,e){var i=0,r=this.getTrackById(t);r.lastValidSample||(r.lastValidSample=0);for(var s=r.lastValidSample;s<e;s++)i+=this.releaseSample(r,s);Log.info("ISOFile","Track #"+t+" released samples up to "+e+" (released size: "+i+", remaining: "+this.samplesDataSize+")"),r.lastValidSample=e},ISOFile.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},ISOFile.prototype.stop=function(){this.sampleProcessingStarted=!1},ISOFile.prototype.flush=function(){Log.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},ISOFile.prototype.seekTrack=function(t,e,i){var r,s,a,n,o=0,h=0;if(0===i.samples.length)return Log.info("ISOFile","No sample in track, cannot seek! Using time "+Log.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(r=0;r<i.samples.length;r++){if(s=i.samples[r],0===r)h=0,n=s.timescale;else if(s.cts>t*s.timescale){h=r-1;break}e&&s.is_sync&&(o=r)}for(e&&(h=o),t=i.samples[h].cts,i.nextSample=h;i.samples[h].alreadyRead===i.samples[h].size&&i.samples[h+1];)h++;return a=i.samples[h].offset+i.samples[h].alreadyRead,Log.info("ISOFile","Seeking to "+(e?"RAP":"")+" sample #"+i.nextSample+" on track "+i.tkhd.track_id+", time "+Log.getDurationString(t,n)+" and offset: "+a),{offset:a,time:t/n}},ISOFile.prototype.seek=function(t,e){var i,r,s,a=this.moov,n={offset:1/0,time:1/0};if(this.moov){for(s=0;s<a.traks.length;s++)i=a.traks[s],(r=this.seekTrack(t,e,i)).offset<n.offset&&(n.offset=r.offset),r.time<n.time&&(n.time=r.time);return Log.info("ISOFile","Seeking at time "+Log.getDurationString(n.time,1)+" needs a buffer with a fileStart position of "+n.offset),n.offset===1/0?n={offset:this.nextParsePosition,time:0}:n.offset=this.stream.getEndFilePositionAfter(n.offset),Log.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+n.offset),n}throw"Cannot seek: moov not received!"},ISOFile.prototype.equal=function(t){for(var e=0;e<this.boxes.length&&e<t.boxes.length;){var i=this.boxes[e],r=t.boxes[e];if(!BoxParser.boxEqual(i,r))return!1;e++}return!0},"undefined"!=typeof exports&&(exports.ISOFile=ISOFile),ISOFile.prototype.lastBoxStartPosition=0,ISOFile.prototype.parsingMdat=null,ISOFile.prototype.nextParsePosition=0,ISOFile.prototype.discardMdatData=!1,ISOFile.prototype.processIncompleteBox=function(t){var e;return"mdat"===t.type?(e=new BoxParser[t.type+"Box"](t.size),this.parsingMdat=e,this.boxes.push(e),this.mdats.push(e),e.start=t.start,e.hdr_size=t.hdr_size,this.stream.addUsedBytes(e.hdr_size),this.lastBoxStartPosition=e.start+e.size,this.stream.seek(e.start+e.size,!1,this.discardMdatData)?!(this.parsingMdat=null):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=e.start+e.size,!1)):("moov"===t.type&&(this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0)),!!this.stream.mergeNextBuffer&&this.stream.mergeNextBuffer()?(this.nextParsePosition=this.stream.getEndPosition(),!0):(!t.type||this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size,!1))},ISOFile.prototype.hasIncompleteMdat=function(){return null!==this.parsingMdat},ISOFile.prototype.processIncompleteMdat=function(){var t=this.parsingMdat;return this.stream.seek(t.start+t.size,!1,this.discardMdatData)?(Log.debug("ISOFile","Found 'mdat' end in buffered data"),!(this.parsingMdat=null)):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},ISOFile.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},ISOFile.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},ISOFile.prototype.updateUsedBytes=function(t,e){this.stream.addUsedBytes&&("mdat"===t.type?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size))},ISOFile.prototype.add=BoxParser.Box.prototype.add,ISOFile.prototype.addBox=BoxParser.Box.prototype.addBox,ISOFile.prototype.init=function(t){var e=t||{},i=(this.add("ftyp").set("major_brand",e.brands&&e.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",e.brands||["iso4"]),this.add("moov"));return i.add("mvhd").set("timescale",e.timescale||600).set("rate",e.rate||1).set("creation_time",0).set("modification_time",0).set("duration",e.duration||0).set("volume",1).set("matrix",[0,0,0,0,0,0,0,0,0]).set("next_track_id",1),i.add("mvex"),this},ISOFile.prototype.addTrack=function(t){this.moov||this.init(t);var e=t||{};e.width=e.width||320,e.height=e.height||320,e.id=e.id||this.moov.mvhd.next_track_id,e.type=e.type||"avc1";var i=this.moov.add("trak");this.moov.mvhd.next_track_id=e.id+1,i.add("tkhd").set("flags",BoxParser.TKHD_FLAG_ENABLED|BoxParser.TKHD_FLAG_IN_MOVIE|BoxParser.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",e.id).set("duration",e.duration||0).set("layer",e.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[0,0,0,0,0,0,0,0,0]).set("width",e.width).set("height",e.height);var r=i.add("mdia");r.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",e.timescale||1).set("duration",e.media_duration||0).set("language",e.language||0),r.add("hdlr").set("handler",e.hdlr||"vide").set("name",e.name||"Track created with MP4Box.js"),r.add("elng").set("extended_language",e.language||"fr-FR");var s=r.add("minf");if(void 0!==BoxParser[e.type+"SampleEntry"]){var a=new BoxParser[e.type+"SampleEntry"];a.data_reference_index=1;var n="";for(var o in BoxParser.sampleEntryCodes)for(var h=BoxParser.sampleEntryCodes[o],d=0;d<h.length;d++)if(-1<h.indexOf(e.type)){n=o;break}switch(n){case"Visual":s.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),a.set("width",e.width).set("height",e.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",e.type+" Compressor").set("depth",24);break;case"Audio":s.add("smhd").set("balance",e.balance||0),a.set("channel_count",e.channel_count||2).set("samplesize",e.samplesize||16).set("samplerate",e.samplerate||65536);break;case"Hint":s.add("hmhd");break;case"Subtitle":switch(s.add("sthd"),e.type){case"stpp":a.set("namespace",e.namespace||"nonamespace").set("schema_location",e.schema_location||"").set("auxiliary_mime_types",e.auxiliary_mime_types||"")}break;case"Metadata":case"System":default:s.add("nmhd")}e.description&&a.addBox(e.description),e.description_boxes&&e.description_boxes.forEach(function(t){a.addBox(t)}),s.add("dinf").add("dref").addEntry((new BoxParser["url Box"]).set("flags",1));var l=s.add("stbl");return l.add("stsd").addEntry(a),l.add("stts").set("sample_counts",[]).set("sample_deltas",[]),l.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),l.add("stco").set("chunk_offsets",[]),l.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",e.id).set("default_sample_description_index",e.default_sample_description_index||1).set("default_sample_duration",e.default_sample_duration||0).set("default_sample_size",e.default_sample_size||0).set("default_sample_flags",e.default_sample_flags||0),this.buildTrakSampleLists(i),e.id}},BoxParser.Box.prototype.computeSize=function(t){var e=t||new DataStream;e.endianness=DataStream.BIG_ENDIAN,this.write(e)},ISOFile.prototype.addSample=function(t,e,i){var r=i||{},s={},a=this.getTrackById(t);if(null!==a){s.number=a.samples.length,s.track_id=a.tkhd.track_id,s.timescale=a.mdia.mdhd.timescale,s.description_index=r.sample_description_index?r.sample_description_index-1:0,s.description=a.mdia.minf.stbl.stsd.entries[s.description_index],s.data=e,s.size=e.length,s.alreadyRead=s.size,s.duration=r.duration||1,s.cts=r.cts||0,s.dts=r.dts||0,s.is_sync=r.is_sync||!1,s.is_leading=r.is_leading||0,s.depends_on=r.depends_on||0,s.is_depended_on=r.is_depended_on||0,s.has_redundancy=r.has_redundancy||0,s.degradation_priority=r.degradation_priority||0,s.offset=0,s.subsamples=r.subsamples,a.samples.push(s),a.samples_size+=s.size,a.samples_duration+=s.duration,this.processSamples();var n=ISOFile.createSingleSampleMoof(s);return this.addBox(n),n.computeSize(),n.trafs[0].truns[0].data_offset=n.size+8,this.add("mdat").data=e,s}},ISOFile.createSingleSampleMoof=function(t){var e=new BoxParser.moofBox;e.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var i=e.add("traf");return i.add("tfhd").set("track_id",t.track_id).set("flags",BoxParser.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),i.add("tfdt").set("baseMediaDecodeTime",t.dts),i.add("trun").set("flags",BoxParser.TRUN_FLAGS_DATA_OFFSET|BoxParser.TRUN_FLAGS_DURATION|BoxParser.TRUN_FLAGS_SIZE|BoxParser.TRUN_FLAGS_FLAGS|BoxParser.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[t.duration]).set("sample_size",[t.size]).set("sample_flags",[0]).set("sample_composition_time_offset",[t.cts-t.dts]),e},ISOFile.prototype.lastMoofIndex=0,ISOFile.prototype.samplesDataSize=0,ISOFile.prototype.resetTables=function(){var t,e,i,r,s,a;for(this.initial_duration=this.moov.mvhd.duration,t=this.moov.mvhd.duration=0;t<this.moov.traks.length;t++){(e=this.moov.traks[t]).tkhd.duration=0,e.mdia.mdhd.duration=0,(e.mdia.minf.stbl.stco||e.mdia.minf.stbl.co64).chunk_offsets=[],(i=e.mdia.minf.stbl.stsc).first_chunk=[],i.samples_per_chunk=[],i.sample_description_index=[],(e.mdia.minf.stbl.stsz||e.mdia.minf.stbl.stz2).sample_sizes=[],(r=e.mdia.minf.stbl.stts).sample_counts=[],r.sample_deltas=[],(s=e.mdia.minf.stbl.ctts)&&(s.sample_counts=[],s.sample_offsets=[]),a=e.mdia.minf.stbl.stss;var n=e.mdia.minf.stbl.boxes.indexOf(a);-1!=n&&(e.mdia.minf.stbl.boxes[n]=null)}},ISOFile.initSampleGroups=function(t,e,i,r,s){var a,n,o,h;function d(t,e,i){this.grouping_type=t,this.grouping_type_parameter=e,this.sbgp=i,this.last_sample_in_run=-1,this.entry_index=-1}for(e&&(e.sample_groups_info=[]),t.sample_groups_info||(t.sample_groups_info=[]),n=0;n<i.length;n++){for(h=i[n].grouping_type+"/"+i[n].grouping_type_parameter,o=new d(i[n].grouping_type,i[n].grouping_type_parameter,i[n]),e&&(e.sample_groups_info[h]=o),t.sample_groups_info[h]||(t.sample_groups_info[h]=o),a=0;a<r.length;a++)r[a].grouping_type===i[n].grouping_type&&(o.description=r[a],o.description.used=!0);if(s)for(a=0;a<s.length;a++)s[a].grouping_type===i[n].grouping_type&&(o.fragment_description=s[a],o.fragment_description.used=!0,o.is_fragment=!0)}if(e){if(s)for(n=0;n<s.length;n++)!s[n].used&&2<=s[n].version&&(h=s[n].grouping_type+"/0",(o=new d(s[n].grouping_type,0)).is_fragment=!0,e.sample_groups_info[h]||(e.sample_groups_info[h]=o))}else for(n=0;n<r.length;n++)!r[n].used&&2<=r[n].version&&(h=r[n].grouping_type+"/0",o=new d(r[n].grouping_type,0),t.sample_groups_info[h]||(t.sample_groups_info[h]=o))},ISOFile.setSampleGroupProperties=function(t,e,i,r){var s,a,n;for(s in e.sample_groups=[],r){e.sample_groups[s]={},e.sample_groups[s].grouping_type=r[s].grouping_type,e.sample_groups[s].grouping_type_parameter=r[s].grouping_type_parameter,i>=r[s].last_sample_in_run&&(r[s].last_sample_in_run<0&&(r[s].last_sample_in_run=0),r[s].entry_index++,r[s].entry_index<=r[s].sbgp.entries.length-1&&(r[s].last_sample_in_run+=r[s].sbgp.entries[r[s].entry_index].sample_count)),r[s].entry_index<=r[s].sbgp.entries.length-1?e.sample_groups[s].group_description_index=r[s].sbgp.entries[r[s].entry_index].group_description_index:e.sample_groups[s].group_description_index=-1,0!==e.sample_groups[s].group_description_index&&(n=r[s].fragment_description?r[s].fragment_description:r[s].description,0<e.sample_groups[s].group_description_index?(a=65535<e.sample_groups[s].group_description_index?(e.sample_groups[s].group_description_index>>16)-1:e.sample_groups[s].group_description_index-1,n&&0<=a&&(e.sample_groups[s].description=n.entries[a])):n&&2<=n.version&&0<n.default_group_description_index&&(e.sample_groups[s].description=n.entries[n.default_group_description_index-1]))}},ISOFile.process_sdtp=function(t,e,i){e&&(t?(e.is_leading=t.is_leading[i],e.depends_on=t.sample_depends_on[i],e.is_depended_on=t.sample_is_depended_on[i],e.has_redundancy=t.sample_has_redundancy[i]):(e.is_leading=0,e.depends_on=0,e.is_depended_on=0,e.has_redundancy=0))},ISOFile.prototype.buildSampleLists=function(){for(var t,e=0;e<this.moov.traks.length;e++)t=this.moov.traks[e],this.buildTrakSampleLists(t)},ISOFile.prototype.buildTrakSampleLists=function(t){var e,i,r,s,a,n,o,h,d,l,p,f,u,c,m,_,g,x,y,B,S,P,U,b;if(t.samples=[],t.samples_duration=0,t.samples_size=0,i=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,r=t.mdia.minf.stbl.stsc,s=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,a=t.mdia.minf.stbl.stts,n=t.mdia.minf.stbl.ctts,o=t.mdia.minf.stbl.stss,h=t.mdia.minf.stbl.stsd,d=t.mdia.minf.stbl.subs,f=t.mdia.minf.stbl.stdp,l=t.mdia.minf.stbl.sbgps,p=t.mdia.minf.stbl.sgpds,S=B=y=x=-1,b=U=P=0,ISOFile.initSampleGroups(t,null,l,p),void 0!==s){for(e=0;e<s.sample_sizes.length;e++){var v={};v.number=e,v.track_id=t.tkhd.track_id,v.timescale=t.mdia.mdhd.timescale,v.alreadyRead=0,(t.samples[e]=v).size=s.sample_sizes[e],t.samples_size+=v.size,0===e?(c=1,u=0,v.chunk_index=c,v.chunk_run_index=u,g=r.samples_per_chunk[u],_=0,m=u+1<r.first_chunk.length?r.first_chunk[u+1]-1:1/0):e<g?(v.chunk_index=c,v.chunk_run_index=u):(c++,_=0,(v.chunk_index=c)<=m||(m=++u+1<r.first_chunk.length?r.first_chunk[u+1]-1:1/0),v.chunk_run_index=u,g+=r.samples_per_chunk[u]),v.description_index=r.sample_description_index[v.chunk_run_index]-1,v.description=h.entries[v.description_index],v.offset=i.chunk_offsets[v.chunk_index-1]+_,_+=v.size,x<e&&(y++,x<0&&(x=0),x+=a.sample_counts[y]),0<e?(t.samples[e-1].duration=a.sample_deltas[y],t.samples_duration+=t.samples[e-1].duration,v.dts=t.samples[e-1].dts+t.samples[e-1].duration):v.dts=0,n?(B<=e&&(S++,B<0&&(B=0),B+=n.sample_counts[S]),v.cts=t.samples[e].dts+n.sample_offsets[S]):v.cts=v.dts,o?(e==o.sample_numbers[P]-1?(v.is_sync=!0,P++):(v.is_sync=!1,v.degradation_priority=0),d&&d.entries[U].sample_delta+b==e+1&&(v.subsamples=d.entries[U].subsamples,b+=d.entries[U].sample_delta,U++)):v.is_sync=!0,ISOFile.process_sdtp(t.mdia.minf.stbl.sdtp,v,v.number),v.degradation_priority=f?f.priority[e]:0,d&&d.entries[U].sample_delta+b==e&&(v.subsamples=d.entries[U].subsamples,b+=d.entries[U].sample_delta),(0<l.length||0<p.length)&&ISOFile.setSampleGroupProperties(t,v,e,t.sample_groups_info)}0<e&&(t.samples[e-1].duration=Math.max(t.mdia.mdhd.duration-t.samples[e-1].dts,0),t.samples_duration+=t.samples[e-1].duration)}},ISOFile.prototype.updateSampleLists=function(){var t,e,i,r,s,a,n,o,h,d,l,p,f;if(void 0!==this.moov)for(;this.lastMoofIndex<this.moofs.length;)if(n=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,"moof"==n.type)for(o=n,t=0;t<o.trafs.length;t++){for(h=o.trafs[t],d=this.getTrackById(h.tfhd.track_id),l=this.getTrexById(h.tfhd.track_id),e=h.tfhd.flags&BoxParser.TFHD_FLAG_SAMPLE_DESC?h.tfhd.default_sample_description_index:l?l.default_sample_description_index:1,i=h.tfhd.flags&BoxParser.TFHD_FLAG_SAMPLE_DUR?h.tfhd.default_sample_duration:l?l.default_sample_duration:0,r=h.tfhd.flags&BoxParser.TFHD_FLAG_SAMPLE_SIZE?h.tfhd.default_sample_size:l?l.default_sample_size:0,s=h.tfhd.flags&BoxParser.TFHD_FLAG_SAMPLE_FLAGS?h.tfhd.default_sample_flags:l?l.default_sample_flags:0,(h.sample_number=0)<h.sbgps.length&&ISOFile.initSampleGroups(d,h,h.sbgps,d.mdia.minf.stbl.sgpds,h.sgpds),B=0;B<h.truns.length;B++)for(var u=h.truns[B],c=0;c<u.sample_count;c++){(p={}).moof_number=this.lastMoofIndex,p.number_in_traf=h.sample_number,h.sample_number++,p.number=d.samples.length,h.first_sample_index=d.samples.length,d.samples.push(p),p.track_id=d.tkhd.track_id,p.timescale=d.mdia.mdhd.timescale,p.description_index=e-1,p.description=d.mdia.minf.stbl.stsd.entries[p.description_index],p.size=r,u.flags&BoxParser.TRUN_FLAGS_SIZE&&(p.size=u.sample_size[c]),d.samples_size+=p.size,p.duration=i,u.flags&BoxParser.TRUN_FLAGS_DURATION&&(p.duration=u.sample_duration[c]),d.samples_duration+=p.duration,d.first_traf_merged||0<c?p.dts=d.samples[d.samples.length-2].dts+d.samples[d.samples.length-2].duration:(h.tfdt?p.dts=h.tfdt.baseMediaDecodeTime:p.dts=0,d.first_traf_merged=!0),p.cts=p.dts,u.flags&BoxParser.TRUN_FLAGS_CTS_OFFSET&&(p.cts=p.dts+u.sample_composition_time_offset[c]),f=s,u.flags&BoxParser.TRUN_FLAGS_FLAGS?f=u.sample_flags[c]:0===c&&u.flags&BoxParser.TRUN_FLAGS_FIRST_FLAG&&(f=u.first_sample_flags),p.is_sync=!(f>>16&1),p.is_leading=f>>26&3,p.depends_on=f>>24&3,p.is_depended_on=f>>22&3,p.has_redundancy=f>>20&3,p.degradation_priority=65535&f;var m=!!(h.tfhd.flags&BoxParser.TFHD_FLAG_BASE_DATA_OFFSET),_=!!(h.tfhd.flags&BoxParser.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),g=!!(u.flags&BoxParser.TRUN_FLAGS_DATA_OFFSET),x=0,x=m?h.tfhd.base_data_offset:_||0===B?o.start:a;p.offset=0===B&&0===c?g?x+u.data_offset:x:a,a=p.offset+p.size,(0<h.sbgps.length||0<h.sgpds.length||0<d.mdia.minf.stbl.sbgps.length||0<d.mdia.minf.stbl.sgpds.length)&&ISOFile.setSampleGroupProperties(d,p,p.number_in_traf,h.sample_groups_info)}if(h.subs){d.has_fragment_subsamples=!0;for(var y=h.first_sample_index,B=0;B<h.subs.entries.length;B++)y+=h.subs.entries[B].sample_delta,(p=d.samples[y-1]).subsamples=h.subs.entries[B].subsamples}}},ISOFile.prototype.getSample=function(t,e){var i,r=t.samples[e];if(!this.moov)return null;if(r.data){if(r.alreadyRead==r.size)return r}else r.data=new Uint8Array(r.size),r.alreadyRead=0,this.samplesDataSize+=r.size,Log.debug("ISOFile","Allocating sample #"+e+" on track #"+t.tkhd.track_id+" of size "+r.size+" (total: "+this.samplesDataSize+")");var s=this.stream.findPosition(!0,r.offset+r.alreadyRead,!1);if(-1<s){var a=(i=this.stream.buffers[s]).byteLength-(r.offset+r.alreadyRead-i.fileStart);return r.size-r.alreadyRead<=a?(Log.debug("ISOFile","Getting sample #"+e+" data (alreadyRead: "+r.alreadyRead+" offset: "+(r.offset+r.alreadyRead-i.fileStart)+" read size: "+(r.size-r.alreadyRead)+" full size: "+r.size+")"),DataStream.memcpy(r.data.buffer,r.alreadyRead,i,r.offset+r.alreadyRead-i.fileStart,r.size-r.alreadyRead),i.usedBytes+=r.size-r.alreadyRead,this.stream.logBufferLevel(),r.alreadyRead=r.size,r):(Log.debug("ISOFile","Getting sample #"+e+" partial data (alreadyRead: "+r.alreadyRead+" offset: "+(r.offset+r.alreadyRead-i.fileStart)+" read size: "+a+" full size: "+r.size+")"),DataStream.memcpy(r.data.buffer,r.alreadyRead,i,r.offset+r.alreadyRead-i.fileStart,a),r.alreadyRead+=a,i.usedBytes+=a,this.stream.logBufferLevel(),null)}return null},ISOFile.prototype.releaseSample=function(t,e){var i=t.samples[e];return i.data?(this.samplesDataSize-=i.size,i.data=null,i.alreadyRead=0,i.size):0},ISOFile.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},ISOFile.prototype.getCodecs=function(){for(var t="",e=0;e<this.moov.traks.length;e++){0<e&&(t+=","),t+=this.moov.traks[e].mdia.minf.stbl.stsd.entries[0].getCodec()}return t},ISOFile.prototype.getTrexById=function(t){var e;if(!this.moov||!this.moov.mvex)return null;for(e=0;e<this.moov.mvex.trexs.length;e++){var i=this.moov.mvex.trexs[e];if(i.track_id==t)return i}return null},ISOFile.prototype.getTrackById=function(t){if(void 0===this.moov)return null;for(var e=0;e<this.moov.traks.length;e++){var i=this.moov.traks[e];if(i.tkhd.track_id==t)return i}return null},ISOFile.prototype.items=[],ISOFile.prototype.itemsDataSize=0,ISOFile.prototype.flattenItemInfo=function(){var t=this.items,e=this.meta;if(null!=e&&void 0!==e.hdlr&&void 0!==e.iinf){for(h=0;h<e.iinf.item_infos.length;h++)(r={}).id=e.iinf.item_infos[h].item_ID,(t[r.id]=r).ref_to=[],r.name=e.iinf.item_infos[h].item_name,0<e.iinf.item_infos[h].protection_index&&(r.protection=e.ipro.protections[e.iinf.item_infos[h].protection_index-1]),e.iinf.item_infos[h].item_type?r.type=e.iinf.item_infos[h].item_type:r.type="mime",r.content_type=e.iinf.item_infos[h].content_type,r.content_encoding=e.iinf.item_infos[h].content_encoding;if(e.iloc)for(h=0;h<e.iloc.items.length;h++){var i=e.iloc.items[h],r=t[i.item_ID];switch(0!==i.data_reference_index&&(Log.warn("Item storage with reference to other files: not supported"),r.source=e.dinf.boxes[i.data_reference_index-1]),i.construction_method){case 0:break;case 1:case 2:Log.warn("Item storage with construction_method : not supported")}for(r.extents=[],a=r.size=0;a<i.extents.length;a++)r.extents[a]={},r.extents[a].offset=i.extents[a].extent_offset+i.base_offset,r.extents[a].length=i.extents[a].extent_length,r.extents[a].alreadyRead=0,r.size+=r.extents[a].length}if(e.pitm&&(t[e.pitm.item_id].primary=!0),e.iref)for(h=0;h<e.iref.references.length;h++)for(var s=e.iref.references[h],a=0;a<s.references.length;a++)t[s.from_item_ID].ref_to.push({type:s.type,id:s.references[a]});if(e.iprp)for(var n=0;n<e.iprp.ipmas.length;n++)for(var o=e.iprp.ipmas[n],h=0;h<o.associations.length;h++){var d=o.associations[h];for(void 0===(r=t[d.id]).properties&&(r.properties={},r.properties.boxes=[]),a=0;a<d.props.length;a++){var l,p=d.props[a];0<p.property_index&&(l=e.iprp.ipco.boxes[p.property_index-1],r.properties[l.type]=l,r.properties.boxes.push(l))}}}},ISOFile.prototype.getItem=function(t){var e,i;if(!this.meta)return null;if(!(i=this.items[t]).data&&i.size)i.data=new Uint8Array(i.size),i.alreadyRead=0,this.itemsDataSize+=i.size,Log.debug("ISOFile","Allocating item #"+t+" of size "+i.size+" (total: "+this.itemsDataSize+")");else if(i.alreadyRead===i.size)return i;for(var r=0;r<i.extents.length;r++){var s=i.extents[r];if(s.alreadyRead!==s.length){var a=this.stream.findPosition(!0,s.offset+s.alreadyRead,!1);if(!(-1<a))return null;var n=(e=this.stream.buffers[a]).byteLength-(s.offset+s.alreadyRead-e.fileStart);if(!(s.length-s.alreadyRead<=n))return Log.debug("ISOFile","Getting item #"+t+" extent #"+r+" partial data (alreadyRead: "+s.alreadyRead+" offset: "+(s.offset+s.alreadyRead-e.fileStart)+" read size: "+n+" full extent size: "+s.length+" full item size: "+i.size+")"),DataStream.memcpy(i.data.buffer,i.alreadyRead,e,s.offset+s.alreadyRead-e.fileStart,n),s.alreadyRead+=n,i.alreadyRead+=n,e.usedBytes+=n,this.stream.logBufferLevel(),null;Log.debug("ISOFile","Getting item #"+t+" extent #"+r+" data (alreadyRead: "+s.alreadyRead+" offset: "+(s.offset+s.alreadyRead-e.fileStart)+" read size: "+(s.length-s.alreadyRead)+" full extent size: "+s.length+" full item size: "+i.size+")"),DataStream.memcpy(i.data.buffer,i.alreadyRead,e,s.offset+s.alreadyRead-e.fileStart,s.length-s.alreadyRead),e.usedBytes+=s.length-s.alreadyRead,this.stream.logBufferLevel(),i.alreadyRead+=s.length-s.alreadyRead,s.alreadyRead=s.length}}return i.alreadyRead===i.size?i:null},ISOFile.prototype.releaseItem=function(t){var e=this.items[t];if(e.data){this.itemsDataSize-=e.size,e.data=null;for(var i=e.alreadyRead=0;i<e.extents.length;i++){e.extents[i].alreadyRead=0}return e.size}return 0},ISOFile.prototype.processItems=function(t){for(var e in this.items){var i=this.items[e];this.getItem(i.id),t&&!i.sent&&(t(i),i.sent=!0,i.data=null)}},ISOFile.prototype.hasItem=function(t){for(var e in this.items){var i=this.items[e];if(i.name===t)return i.id}return-1},ISOFile.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},ISOFile.prototype.getPrimaryItem=function(){return this.meta&&this.meta.pitm?this.getItem(this.meta.pitm.item_id):null},ISOFile.prototype.itemToFragmentedTrackFile=function(t){var e=t||{},i=null;if(null==(i=e.itemId?this.getItem(e.itemId):this.getPrimaryItem()))return null;var r=new ISOFile;r.discardMdatData=!1;var s={type:i.type,description_boxes:i.properties.boxes};i.properties.ispe&&(s.width=i.properties.ispe.image_width,s.height=i.properties.ispe.image_height);var a=r.addTrack(s);return a?(r.addSample(a,i.data),r):null},ISOFile.prototype.write=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t)},ISOFile.prototype.createFragment=function(t,e,i){var r=this.getTrackById(t),s=this.getSample(r,e);if(null==s)return s=r.samples[e],this.nextSeekPosition?this.nextSeekPosition=Math.min(s.offset+s.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=r.samples[e].offset+s.alreadyRead,null;var a=i||new DataStream;a.endianness=DataStream.BIG_ENDIAN;var n=ISOFile.createSingleSampleMoof(s);n.write(a),n.trafs[0].truns[0].data_offset=n.size+8,Log.debug("MP4Box","Adjusting data_offset with new value "+n.trafs[0].truns[0].data_offset),a.adjustUint32(n.trafs[0].truns[0].data_offset_position,n.trafs[0].truns[0].data_offset);var o=new BoxParser.mdatBox;return o.data=s.data,o.write(a),a},ISOFile.writeInitializationSegment=function(t,e,i,r){var s;Log.debug("ISOFile","Generating initialization segment");var a=new DataStream;a.endianness=DataStream.BIG_ENDIAN,t.write(a);var n=e.add("mvex");for(i&&n.add("mehd").set("fragment_duration",i),s=0;s<e.traks.length;s++)n.add("trex").set("track_id",e.traks[s].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",r).set("default_sample_size",0).set("default_sample_flags",65536);return e.write(a),a.buffer},ISOFile.prototype.save=function(t){var e=new DataStream;e.endianness=DataStream.BIG_ENDIAN,this.write(e),e.save(t)},ISOFile.prototype.getBuffer=function(){var t=new DataStream;return t.endianness=DataStream.BIG_ENDIAN,this.write(t),t.buffer},ISOFile.prototype.initializeSegmentation=function(){var t,e,i,r;for(null===this.onSegment&&Log.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),e=[],t=0;t<this.fragmentedTracks.length;t++){var s=new BoxParser.moovBox;s.mvhd=this.moov.mvhd,s.boxes.push(s.mvhd),i=this.getTrackById(this.fragmentedTracks[t].id),s.boxes.push(i),s.traks.push(i),(r={}).id=i.tkhd.track_id,r.user=this.fragmentedTracks[t].user,r.buffer=ISOFile.writeInitializationSegment(this.ftyp,s,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,0<this.moov.traks[t].samples.length?this.moov.traks[t].samples[0].duration:0),e.push(r)}return e},BoxParser.Box.prototype.printHeader=function(t){this.size+=8,this.size>MAX_SIZE&&(this.size+=8),"uuid"===this.type&&(this.size+=16),t.log(t.indent+"size:"+this.size),t.log(t.indent+"type:"+this.type)},BoxParser.FullBox.prototype.printHeader=function(t){this.size+=4,BoxParser.Box.prototype.printHeader.call(this,t),t.log(t.indent+"version:"+this.version),t.log(t.indent+"flags:"+this.flags)},BoxParser.Box.prototype.print=function(t){this.printHeader(t)},BoxParser.ContainerBox.prototype.print=function(t){this.printHeader(t);for(var e,i=0;i<this.boxes.length;i++){this.boxes[i]&&(e=t.indent,t.indent+=" ",this.boxes[i].print(t),t.indent=e)}},ISOFile.prototype.print=function(t){t.indent="";for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&this.boxes[e].print(t)},BoxParser.mvhdBox.prototype.print=function(t){BoxParser.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"timescale: "+this.timescale),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"rate: "+this.rate),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"next_track_id: "+this.next_track_id)},BoxParser.tkhdBox.prototype.print=function(t){BoxParser.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"track_id: "+this.track_id),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"layer: "+this.layer),t.log(t.indent+"alternate_group: "+this.alternate_group),t.log(t.indent+"width: "+this.width),t.log(t.indent+"height: "+this.height)};var MP4Box={createFile:function(t,e){var i=void 0===t||t,r=new ISOFile(e);return r.discardMdatData=!i,r}};"undefined"!=typeof exports&&(exports.createFile=MP4Box.createFile);

(function(){var innerGlobal=typeof window!="undefined"?window:global;var exportTo={};(function(window,global){var p,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,d){b!=Array.prototype&&b!=Object.prototype&&(b[c]=d.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(){ca=function(){};ba.Symbol||(ba.Symbol=da)}var da=function(){var b=0;return function(c){return"jscomp_symbol_"+(c||"")+b++}}();
function ea(){ca();var b=ba.Symbol.iterator;b||(b=ba.Symbol.iterator=ba.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&aa(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return ha(this)}});ea=function(){}}function ha(b){var c=0;return ia(function(){return c<b.length?{done:!1,value:b[c++]}:{done:!0}})}function ia(b){ea();b={next:b};b[ba.Symbol.iterator]=function(){return this};return b}function t(b){ea();var c=b[Symbol.iterator];return c?c.call(b):ha(b)}
function ja(b,c){if(c){for(var d=ba,e=b.split("."),f=0;f<e.length-1;f++){var g=e[f];g in d||(d[g]={});d=d[g]}e=e[e.length-1];f=d[e];g=c(f);g!=f&&null!=g&&aa(d,e,{configurable:!0,writable:!0,value:g})}}
ja("Promise",function(b){function c(b){this.b=0;this.g=void 0;this.a=[];var c=this.c();try{b(c.resolve,c.reject)}catch(l){c.reject(l)}}function d(){this.a=null}function e(b){return b instanceof c?b:new c(function(c){c(b)})}if(b)return b;d.prototype.b=function(b){null==this.a&&(this.a=[],this.f());this.a.push(b)};d.prototype.f=function(){var b=this;this.c(function(){b.h()})};var f=ba.setTimeout;d.prototype.c=function(b){f(b,0)};d.prototype.h=function(){for(;this.a&&this.a.length;){var b=this.a;this.a=
[];for(var c=0;c<b.length;++c){var d=b[c];b[c]=null;try{d()}catch(m){this.g(m)}}}this.a=null};d.prototype.g=function(b){this.c(function(){throw b;})};c.prototype.c=function(){function b(b){return function(e){d||(d=!0,b.call(c,e))}}var c=this,d=!1;return{resolve:b(this.s),reject:b(this.f)}};c.prototype.s=function(b){if(b===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof c)this.v(b);else{a:switch(typeof b){case "object":var d=null!=b;break a;case "function":d=!0;
break a;default:d=!1}d?this.l(b):this.h(b)}};c.prototype.l=function(b){var c=void 0;try{c=b.then}catch(l){this.f(l);return}"function"==typeof c?this.B(c,b):this.h(b)};c.prototype.f=function(b){this.i(2,b)};c.prototype.h=function(b){this.i(1,b)};c.prototype.i=function(b,c){if(0!=this.b)throw Error("Cannot settle("+b+", "+c+"): Promise already settled in state"+this.b);this.b=b;this.g=c;this.j()};c.prototype.j=function(){if(null!=this.a){for(var b=0;b<this.a.length;++b)g.b(this.a[b]);this.a=null}};
var g=new d;c.prototype.v=function(b){var c=this.c();b.Gb(c.resolve,c.reject)};c.prototype.B=function(b,c){var d=this.c();try{b.call(c,d.resolve,d.reject)}catch(m){d.reject(m)}};c.prototype.then=function(b,d){function e(b,c){return"function"==typeof b?function(c){try{f(b(c))}catch(F){g(F)}}:c}var f,g,h=new c(function(b,c){f=b;g=c});this.Gb(e(b,f),e(d,g));return h};c.prototype["catch"]=function(b){return this.then(void 0,b)};c.prototype.Gb=function(b,c){function d(){switch(e.b){case 1:b(e.g);break;
case 2:c(e.g);break;default:throw Error("Unexpected state: "+e.b);}}var e=this;null==this.a?g.b(d):this.a.push(d)};c.resolve=e;c.reject=function(b){return new c(function(c,d){d(b)})};c.race=function(b){return new c(function(c,d){for(var f=t(b),g=f.next();!g.done;g=f.next())e(g.value).Gb(c,d)})};c.all=function(b){var d=t(b),f=d.next();return f.done?e([]):new c(function(b,c){function g(c){return function(d){h[c]=d;k--;0==k&&b(h)}}var h=[],k=0;do h.push(void 0),k++,e(f.value).Gb(g(h.length-1),c),f=d.next();
while(!f.done)})};return c});ja("Promise.prototype.finally",function(b){return b?b:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}});function ka(b){function c(c){return b.next(c)}function d(c){return b["throw"](c)}return new Promise(function(e,f){function g(b){b.done?e(b.value):Promise.resolve(b.value).then(c,d).then(g,f)}g(b.next())})}function u(b){return ka(b())}
function la(b){for(var c,d=[];!(c=b.next()).done;)d.push(c.value);return d}var ma="function"==typeof Object.create?Object.create:function(b){function c(){}c.prototype=b;return new c},na;if("function"==typeof Object.setPrototypeOf)na=Object.setPrototypeOf;else{var oa;a:{var pa={xd:!0},qa={};try{qa.__proto__=pa;oa=qa.xd;break a}catch(b){}oa=!1}na=oa?function(b,c){b.__proto__=c;if(b.__proto__!==c)throw new TypeError(b+" is not extensible");return b}:null}var ra=na;
function ta(b){return b instanceof Array?b:la(t(b))}function ua(){this.c=!1;this.a=null;this.O=void 0;this.m=1;this.g=this.S=0;this.b=null}function va(b){if(b.c)throw new TypeError("Generator is already running");b.c=!0}ua.prototype.f=function(b){this.O=b};function wa(b,c){b.b={Qc:c,fe:!0};b.m=b.S||b.g}ua.prototype["return"]=function(b){this.b={"return":b};this.m=this.g};function v(b,c,d){b.m=d;return{value:c}}function w(b){b.m=0}function xa(b,c){b.m=c;b.S=0}
function ya(b){b.S=0;var c=b.b.Qc;b.b=null;return c}function za(b){this.a=new ua;this.b=b}function Ca(b,c){va(b.a);var d=b.a.a;if(d)return Da(b,"return"in d?d["return"]:function(b){return{value:b,done:!0}},c,b.a["return"]);b.a["return"](c);return Ea(b)}
function Da(b,c,d,e){try{var f=c.call(b.a.a,d);if(!(f instanceof Object))throw new TypeError("Iterator result "+f+" is not an object");if(!f.done)return b.a.c=!1,f;var g=f.value}catch(h){return b.a.a=null,wa(b.a,h),Ea(b)}b.a.a=null;e.call(b.a,g);return Ea(b)}
function Ea(b){for(;b.a.m;)try{var c=b.b(b.a);if(c)return b.a.c=!1,{value:c.value,done:!1}}catch(d){b.a.O=void 0,wa(b.a,d)}b.a.c=!1;if(b.a.b){c=b.a.b;b.a.b=null;if(c.fe)throw c.Qc;return{value:c["return"],done:!0}}return{value:void 0,done:!0}}
function Fa(b){this.next=function(c){va(b.a);b.a.a?c=Da(b,b.a.a.next,c,b.a.f):(b.a.f(c),c=Ea(b));return c};this["throw"]=function(c){va(b.a);b.a.a?c=Da(b,b.a.a["throw"],c,b.a.f):(wa(b.a,c),c=Ea(b));return c};this["return"]=function(c){return Ca(b,c)};ea();this[Symbol.iterator]=function(){return this}}function y(b,c){Fa.prototype=b.prototype;return new Fa(new za(c))}function Ga(b,c){return Object.prototype.hasOwnProperty.call(b,c)}
ja("WeakMap",function(b){function c(b){this.a=(g+=Math.random()+1).toString();if(b){ca();ea();b=t(b);for(var c;!(c=b.next()).done;)c=c.value,this.set(c[0],c[1])}}function d(b){Ga(b,f)||aa(b,f,{value:{}})}function e(b){var c=Object[b];c&&(Object[b]=function(b){d(b);return c(b)})}if(function(){if(!b||!Object.seal)return!1;try{var c=Object.seal({}),d=Object.seal({}),e=new b([[c,2],[d,3]]);if(2!=e.get(c)||3!=e.get(d))return!1;e["delete"](c);e.set(d,4);return!e.has(c)&&4==e.get(d)}catch(m){return!1}}())return b;
var f="$jscomp_hidden_"+Math.random();e("freeze");e("preventExtensions");e("seal");var g=0;c.prototype.set=function(b,c){d(b);if(!Ga(b,f))throw Error("WeakMap key fail: "+b);b[f][this.a]=c;return this};c.prototype.get=function(b){return Ga(b,f)?b[f][this.a]:void 0};c.prototype.has=function(b){return Ga(b,f)&&Ga(b[f],this.a)};c.prototype["delete"]=function(b){return Ga(b,f)&&Ga(b[f],this.a)?delete b[f][this.a]:!1};return c});
ja("Map",function(b){function c(){var b={};return b.va=b.next=b.head=b}function d(b,c){var d=b.a;return ia(function(){if(d){for(;d.head!=b.a;)d=d.va;for(;d.next!=d.head;)return d=d.next,{done:!1,value:c(d)};d=null}return{done:!0,value:void 0}})}function e(b,c){var d=c&&typeof c;"object"==d||"function"==d?g.has(c)?d=g.get(c):(d=""+ ++h,g.set(c,d)):d="p_"+c;var e=b.b[d];if(e&&Ga(b.b,d))for(var f=0;f<e.length;f++){var k=e[f];if(c!==c&&k.key!==k.key||c===k.key)return{id:d,list:e,index:f,P:k}}return{id:d,
list:e,index:-1,P:void 0}}function f(b){this.b={};this.a=c();this.size=0;if(b){b=t(b);for(var d;!(d=b.next()).done;)d=d.value,this.set(d[0],d[1])}}if(function(){if(!b||"function"!=typeof b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),d=new b(t([[c,"s"]]));if("s"!=d.get(c)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var e=d.entries(),f=e.next();if(f.done||f.value[0]!=c||"s"!=f.value[1])return!1;f=e.next();return f.done||4!=f.value[0].x||
"t"!=f.value[1]||!e.next().done?!1:!0}catch(q){return!1}}())return b;ca();ea();var g=new WeakMap;f.prototype.set=function(b,c){var d=e(this,b);d.list||(d.list=this.b[d.id]=[]);d.P?d.P.value=c:(d.P={next:this.a,va:this.a.va,head:this.a,key:b,value:c},d.list.push(d.P),this.a.va.next=d.P,this.a.va=d.P,this.size++);return this};f.prototype["delete"]=function(b){b=e(this,b);return b.P&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.b[b.id],b.P.va.next=b.P.next,b.P.next.va=b.P.va,b.P.head=
null,this.size--,!0):!1};f.prototype.clear=function(){this.b={};this.a=this.a.va=c();this.size=0};f.prototype.has=function(b){return!!e(this,b).P};f.prototype.get=function(b){return(b=e(this,b).P)&&b.value};f.prototype.entries=function(){return d(this,function(b){return[b.key,b.value]})};f.prototype.keys=function(){return d(this,function(b){return b.key})};f.prototype.values=function(){return d(this,function(b){return b.value})};f.prototype.forEach=function(b,c){for(var d=this.entries(),e;!(e=d.next()).done;)e=
e.value,b.call(c,e[1],e[0],this)};f.prototype[Symbol.iterator]=f.prototype.entries;var h=0;return f});
ja("Set",function(b){function c(b){this.a=new Map;if(b){b=t(b);for(var c;!(c=b.next()).done;)this.add(c.value)}this.size=this.a.size}if(function(){if(!b||"function"!=typeof b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),e=new b(t([c]));if(!e.has(c)||1!=e.size||e.add(c)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var f=e.entries(),g=f.next();if(g.done||g.value[0]!=c||g.value[1]!=c)return!1;g=f.next();return g.done||g.value[0]==c||4!=g.value[0].x||
g.value[1]!=g.value[0]?!1:f.next().done}catch(h){return!1}}())return b;ca();ea();c.prototype.add=function(b){this.a.set(b,b);this.size=this.a.size;return this};c.prototype["delete"]=function(b){b=this.a["delete"](b);this.size=this.a.size;return b};c.prototype.clear=function(){this.a.clear();this.size=0};c.prototype.has=function(b){return this.a.has(b)};c.prototype.entries=function(){return this.a.entries()};c.prototype.values=function(){return this.a.values()};c.prototype.keys=c.prototype.values;
c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(b,c){var d=this;this.a.forEach(function(e){return b.call(c,e,e,d)})};return c});function Ha(b,c){ea();b instanceof String&&(b+="");var d=0,e={next:function(){if(d<b.length){var f=d++;return{value:c(f,b[f]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e}ja("Array.prototype.keys",function(b){return b?b:function(){return Ha(this,function(b){return b})}});
ja("Object.is",function(b){return b?b:function(b,d){return b===d?0!==b||1/b===1/d:b!==b&&d!==d}});ja("Array.prototype.includes",function(b){return b?b:function(b,d){var c=this;c instanceof String&&(c=String(c));var f=c.length,g=d||0;for(0>g&&(g=Math.max(g+f,0));g<f;g++){var h=c[g];if(h===b||Object.is(h,b))return!0}return!1}});
function Ia(b,c,d){if(null==b)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return b+""}ja("String.prototype.includes",function(b){return b?b:function(b,d){return-1!==Ia(this,b,"includes").indexOf(b,d||0)}});
ja("Array.from",function(b){return b?b:function(b,d,e){ea();d=null!=d?d:function(b){return b};var c=[],g=b[Symbol.iterator];if("function"==typeof g)for(b=g.call(b);!(g=b.next()).done;)c.push(d.call(e,g.value));else{g=b.length;for(var h=0;h<g;h++)c.push(d.call(e,b[h]))}return c}});ja("String.prototype.startsWith",function(b){return b?b:function(b,d){for(var c=Ia(this,b,"startsWith"),f=c.length,g=b.length,h=Math.max(0,Math.min(d|0,c.length)),k=0;k<g&&h<f;)if(c[h++]!=b[k++])return!1;return k>=g}});
ja("Array.prototype.find",function(b){return b?b:function(b,d){a:{var c=this;c instanceof String&&(c=String(c));for(var f=c.length,g=0;g<f;g++){var h=c[g];if(b.call(d,h,g,c)){c=h;break a}}c=void 0}return c}});var Ja=this;Ja.a=!0;function z(b,c){var d=b.split("."),e=Ja;d[0]in e||!e.execScript||e.execScript("var "+d[0]);for(var f;d.length&&(f=d.shift());)d.length||void 0===c?e[f]?e=e[f]:e=e[f]={}:e[f]=c}
function Ka(b,c){function d(){}d.prototype=c.prototype;b.Ve=c.prototype;b.prototype=new d;b.prototype.constructor=b;b.gf=function(b,d,g){return c.prototype[d].apply(b,Array.prototype.slice.call(arguments,2))}};/*

 Copyright 2016 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function La(b){this.c=Math.exp(Math.log(.5)/b);this.b=this.a=0}function Ma(b,c,d){var e=Math.pow(b.c,c);d=d*(1-e)+e*b.a;isNaN(d)||(b.a=d,b.b+=c)}function Oa(b){return b.a/(1-Math.pow(b.c,b.b))};function Pa(){this.b=new La(2);this.c=new La(5);this.a=0}Pa.prototype.getBandwidthEstimate=function(b){return 128E3>this.a?b:Math.min(Oa(this.b),Oa(this.c))};function Qa(){}function Ra(){}function A(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];(d=window.__unsafeShakaLogger)&&d.apply(null,["error"].concat(ta(c)))}function B(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];(d=window.__unsafeShakaLogger)&&d.apply(null,["warning"].concat(ta(c)))}function C(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];(d=window.__unsafeShakaLogger)&&d.apply(null,["warning"].concat(ta(c)))}
function D(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];(d=window.__unsafeShakaLogger)&&d.apply(null,["debug"].concat(ta(c)))}function G(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];(d=window.__unsafeShakaLogger)&&d.apply(null,["v1"].concat(ta(c)))}function H(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];(d=window.__unsafeShakaLogger)&&d.apply(null,["v2"].concat(ta(c)))}window.console&&window.console.log.bind&&(Ra=console.warn.bind(console),Qa=console.error.bind(console));var Sa=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function Ta(b){var c;b instanceof Ta?(Ua(this,b.pa),this.Sa=b.Sa,this.ma=b.ma,Xa(this,b.nb),this.la=b.la,Ya(this,b.a.clone()),this.La=b.La):b&&(c=String(b).match(Sa))?(Ua(this,c[1]||"",!0),this.Sa=Za(c[2]||""),this.ma=Za(c[3]||"",!0),Xa(this,c[4]),this.la=Za(c[5]||"",!0),Ya(this,c[6]||"",!0),this.La=Za(c[7]||"")):this.a=new $a(null)}p=Ta.prototype;p.pa="";p.Sa="";p.ma="";p.nb=null;p.la="";p.La="";
p.toString=function(){var b=[],c=this.pa;c&&b.push(ab(c,cb,!0),":");if(c=this.ma){b.push("//");var d=this.Sa;d&&b.push(ab(d,cb,!0),"@");b.push(encodeURIComponent(c).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));c=this.nb;null!=c&&b.push(":",String(c))}if(c=this.la)this.ma&&"/"!=c.charAt(0)&&b.push("/"),b.push(ab(c,"/"==c.charAt(0)?db:eb,!0));(c=this.a.toString())&&b.push("?",c);(c=this.La)&&b.push("#",ab(c,fb));return b.join("")};
p.resolve=function(b){var c=this.clone();"data"===c.pa&&(c=new Ta);var d=!!b.pa;d?Ua(c,b.pa):d=!!b.Sa;d?c.Sa=b.Sa:d=!!b.ma;d?c.ma=b.ma:d=null!=b.nb;var e=b.la;if(d)Xa(c,b.nb);else if(d=!!b.la){if("/"!=e.charAt(0))if(this.ma&&!this.la)e="/"+e;else{var f=c.la.lastIndexOf("/");-1!=f&&(e=c.la.substr(0,f+1)+e)}if(".."==e||"."==e)e="";else if(-1!=e.indexOf("./")||-1!=e.indexOf("/.")){f=0==e.lastIndexOf("/",0);e=e.split("/");for(var g=[],h=0;h<e.length;){var k=e[h++];"."==k?f&&h==e.length&&g.push(""):".."==
k?((1<g.length||1==g.length&&""!=g[0])&&g.pop(),f&&h==e.length&&g.push("")):(g.push(k),f=!0)}e=g.join("/")}}d?c.la=e:d=""!==b.a.toString();d?Ya(c,b.a.clone()):d=!!b.La;d&&(c.La=b.La);return c};p.clone=function(){return new Ta(this)};function Ua(b,c,d){b.pa=d?Za(c,!0):c;b.pa&&(b.pa=b.pa.replace(/:$/,""))}function Xa(b,c){if(c){c=Number(c);if(isNaN(c)||0>c)throw Error("Bad port number "+c);b.nb=c}else b.nb=null}function Ya(b,c,d){c instanceof $a?b.a=c:(d||(c=ab(c,gb)),b.a=new $a(c))}
function Za(b,c){return b?c?decodeURI(b):decodeURIComponent(b):""}function ab(b,c,d){return"string"==typeof b?(b=encodeURI(b).replace(c,hb),d&&(b=b.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b):null}function hb(b){b=b.charCodeAt(0);return"%"+(b>>4&15).toString(16)+(b&15).toString(16)}var cb=/[#\/\?@]/g,eb=/[#\?:]/g,db=/[#\?]/g,gb=/[#\?@]/g,fb=/#/g;function $a(b){this.a=b||null}p=$a.prototype;p.da=null;p.Ib=null;
p.add=function(b,c){if(!this.da&&(this.da={},this.Ib=0,this.a))for(var d=this.a.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),g=null;if(0<=f){var h=d[e].substring(0,f);g=d[e].substring(f+1)}else h=d[e];h=decodeURIComponent(h.replace(/\+/g," "));g=g||"";this.add(h,decodeURIComponent(g.replace(/\+/g," ")))}this.a=null;(d=this.da.hasOwnProperty(b)&&this.da[b])||(this.da[b]=d=[]);d.push(c);this.Ib++;return this};
p.toString=function(){if(this.a)return this.a;if(!this.da)return"";var b=[],c;for(c in this.da)for(var d=encodeURIComponent(c),e=this.da[c],f=0;f<e.length;f++){var g=d;""!==e[f]&&(g+="="+encodeURIComponent(e[f]));b.push(g)}return this.a=b.join("&")};p.clone=function(){var b=new $a;b.a=this.a;if(this.da){var c={},d;for(d in this.da)c[d]=this.da[d].concat();b.da=c;b.Ib=this.Ib}return b};function ib(b){this.b=b;this.a=null}ib.prototype.T=function(b){var c=this;this.stop();var d=!0,e=null;this.a=function(){window.clearTimeout(e);d=!1};e=window.setTimeout(function(){d&&c.b()},1E3*b);return this};ib.prototype.stop=function(){this.a&&(this.a(),this.a=null)};function I(b){this.b=b;this.a=null}z("shaka.util.Timer",I);I.prototype.We=function(){this.stop();this.b();return this};I.prototype.tickNow=I.prototype.We;I.prototype.T=function(b){var c=this;this.stop();this.a=(new ib(function(){c.b()})).T(b);return this};I.prototype.tickAfter=I.prototype.T;I.prototype.Ga=function(b){var c=this;this.stop();this.a=(new ib(function(){c.a.T(b);c.b()})).T(b);return this};I.prototype.tickEvery=I.prototype.Ga;I.prototype.stop=function(){this.a&&(this.a.stop(),this.a=null)};
I.prototype.stop=I.prototype.stop;function jb(b,c){var d=kb();this.i=null==b.maxAttempts?d.maxAttempts:b.maxAttempts;this.f=null==b.baseDelay?d.baseDelay:b.baseDelay;this.h=null==b.fuzzFactor?d.fuzzFactor:b.fuzzFactor;this.g=null==b.backoffFactor?d.backoffFactor:b.backoffFactor;this.a=0;this.b=this.f;if(this.c=void 0===c?!1:c)this.a=1}
function lb(b){return u(function d(){var e,f;return y(d,function(d){switch(d.m){case 1:if(b.a>=b.i)if(b.c)b.a=1,b.b=b.f;else return d["return"](Promise.reject());e=b.a;b.a++;if(0==e)return d["return"]();f=b.b*(1+(2*Math.random()-1)*b.h);return v(d,new Promise(function(b){(new I(b)).T(f/1E3)}),2);case 2:b.b*=b.g,w(d)}})})}function kb(){return{maxAttempts:2,baseDelay:1E3,backoffFactor:2,fuzzFactor:.5,timeout:0}};function J(b,c,d,e){for(var f=[],g=3;g<arguments.length;++g)f[g-3]=arguments[g];this.severity=b;this.category=c;this.code=d;this.data=f;this.handled=!1}z("shaka.util.Error",J);J.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")};J.Severity={RECOVERABLE:1,CRITICAL:2};J.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9};
J.Code={UNSUPPORTED_SCHEME:1E3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,INVALID_TEXT_HEADER:2E3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3E3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,
EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,
UNABLE_TO_GUESS_MANIFEST_TYPE:4E3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,
HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,INVALID_STREAMS_CHOSEN:5005,
NO_RECOGNIZED_KEY_SYSTEMS:6E3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,LOAD_INTERRUPTED:7E3,OPERATION_ABORTED:7001,
NO_VIDEO_ELEMENT:7002,CAST_API_UNAVAILABLE:8E3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,CAST_RECEIVER_APP_ID_MISSING:8007,STORAGE_NOT_SUPPORTED:9E3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,
NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013};function mb(){var b,c,d=new Promise(function(d,f){b=d;c=f});d.resolve=b;d.reject=c;return d}mb.prototype.resolve=function(){};mb.prototype.reject=function(){};function K(b,c){this.promise=b;this.$c=c;this.a=!1}z("shaka.util.AbortableOperation",K);function pb(b){return new K(Promise.reject(b),function(){return Promise.resolve()})}K.failed=pb;function qb(){var b=Promise.reject(new J(2,7,7001));b["catch"](function(){});return new K(b,function(){return Promise.resolve()})}K.aborted=qb;function rb(b){return new K(Promise.resolve(b),function(){return Promise.resolve()})}K.completed=rb;
function sb(b){return new K(b,function(){return b["catch"](function(){})})}K.notAbortable=sb;K.prototype.abort=function(){this.a=!0;return this.$c()};K.prototype.abort=K.prototype.abort;function tb(b){return new K(Promise.all(b.map(function(b){return b.promise})),function(){return Promise.all(b.map(function(b){return b.abort()}))})}K.all=tb;K.prototype["finally"]=function(b){this.promise.then(function(){return b(!0)},function(){return b(!1)});return this};K.prototype["finally"]=K.prototype["finally"];
K.prototype.X=function(b,c){function d(){f.reject(new J(2,7,7001));return e.abort()}var e=this,f=new mb;this.promise.then(function(c){e.a?f.reject(new J(2,7,7001)):b?d=ub(b,c,f):f.resolve(c)},function(b){c?d=ub(c,b,f):f.reject(b)});return new K(f,function(){return d()})};K.prototype.chain=K.prototype.X;
function ub(b,c,d){try{var e=b(c);if(e&&e.promise&&e.abort)return d.resolve(e.promise),function(){return e.abort()};d.resolve(e);return function(){return Promise.resolve(e).then(function(){})["catch"](function(){})}}catch(f){return d.reject(f),function(){return Promise.resolve()}}};function M(b,c){c=void 0===c?{}:c;for(var d in c)this[d]=c[d];this.defaultPrevented=this.cancelable=this.bubbles=!1;this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now();this.type=b;this.isTrusted=!1;this.target=this.currentTarget=null;this.a=!1}M.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)};M.prototype.stopImmediatePropagation=function(){this.a=!0};M.prototype.stopPropagation=function(){};function vb(){this.a={}}vb.prototype.push=function(b,c){this.a.hasOwnProperty(b)?this.a[b].push(c):this.a[b]=[c]};vb.prototype.get=function(b){return(b=this.a[b])?b.slice():null};vb.prototype.remove=function(b,c){var d=this.a[b];if(d)for(var e=0;e<d.length;++e)d[e]==c&&(d.splice(e,1),--e)};vb.prototype.forEach=function(b){for(var c in this.a)b(c,this.a[c])};function wb(){this.dc=new vb;this.Uc=this}wb.prototype.addEventListener=function(b,c){this.dc.push(b,c)};wb.prototype.removeEventListener=function(b,c){this.dc.remove(b,c)};wb.prototype.dispatchEvent=function(b){for(var c=this.dc.get(b.type)||[],d=0;d<c.length;++d){b.target=this.Uc;b.currentTarget=this.Uc;var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(this,b)}catch(f){A("Uncaught exception in event handler",f,f?f.message:null,f?f.stack:null)}if(b.a)break}return b.defaultPrevented};function xb(b){function c(b){switch(typeof b){case "undefined":case "boolean":case "number":case "string":case "symbol":case "function":return b;default:if(!b||b.buffer&&b.buffer.constructor==ArrayBuffer)return b;if(d.has(b))return null;var e=b.constructor==Array;if(b.constructor!=Object&&!e)return null;d.add(b);var g=e?[]:{},h;for(h in b)g[h]=c(b[h]);e&&(g.length=b.length);return g}}var d=new Set;return c(b)};function yb(b,c){var d=b.indexOf(c);-1<d&&b.splice(d,1)}function zb(b,c){var d=0;b.forEach(function(b){d+=c(b)?1:0});return d};function Ab(){this.a=[]}function Bb(b,c){b.a.push(c["finally"](function(){yb(b.a,c)}))}Ab.prototype.destroy=function(){var b=[];this.a.forEach(function(c){c.promise["catch"](function(){});b.push(c.abort())});this.a=[];return Promise.all(b)};function N(b){wb.call(this);this.f=!1;this.g=new Ab;this.a=new Set;this.b=new Set;this.c=b||null}Ka(N,wb);z("shaka.net.NetworkingEngine",N);N.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4};N.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3};var Cb={};function Db(b,c,d){d=d||3;var e=Cb[b];if(!e||d>=e.priority)Cb[b]={priority:d,ze:c}}N.registerScheme=Db;N.unregisterScheme=function(b){delete Cb[b]};N.prototype.Ce=function(b){this.a.add(b)};N.prototype.registerRequestFilter=N.prototype.Ce;
N.prototype.Ze=function(b){this.a["delete"](b)};N.prototype.unregisterRequestFilter=N.prototype.Ze;N.prototype.Dd=function(){this.a.clear()};N.prototype.clearAllRequestFilters=N.prototype.Dd;N.prototype.De=function(b){this.b.add(b)};N.prototype.registerResponseFilter=N.prototype.De;N.prototype.$e=function(b){this.b["delete"](b)};N.prototype.unregisterResponseFilter=N.prototype.$e;N.prototype.Ed=function(){this.b.clear()};N.prototype.clearAllResponseFilters=N.prototype.Ed;
function Eb(b,c){return{uris:b,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:c,licenseRequestType:null,sessionId:null,loadedBytes:0}}N.prototype.destroy=function(){this.f=!0;this.a.clear();this.b.clear();return this.g.destroy()};N.prototype.destroy=N.prototype.destroy;
N.prototype.request=function(b,c,d){var e=this,f=new Fb;if(this.f){var g=Promise.reject(new J(2,7,7001));g["catch"](function(){});return new Gb(g,function(){return Promise.resolve()},f)}c.method=c.method||"GET";c.headers=c.headers||{};c.retryParameters=c.retryParameters?xb(c.retryParameters):kb();c.uris=xb(c.uris);g=Hb(this,b,c);var h=g.X(function(){return Ib(e,b,c,new jb(c.retryParameters,!1),0,null,f,d)}),k=h.X(function(c){return Jb(e,b,c)}),l=Date.now(),m=0;g.promise.then(function(){m=Date.now()-
l},function(){});var n=0;h.promise.then(function(){n=Date.now()},function(){});g=k.X(function(c){var f=Date.now()-n,g=c.response;g.timeMs+=m;g.timeMs+=f;c.de||!e.c||g.fromCache||1!=b||(e.c(g.timeMs,g.data.byteLength),d&&d(g.timeMs,g.data.byteLength,0,g.data));return g},function(b){b&&(b.severity=2);throw b;});g=new Gb(g.promise,g.$c,f);Bb(this.g,g);return g};N.prototype.request=N.prototype.request;
function Hb(b,c,d){var e=rb(void 0),f={};b=t(b.a);for(var g=b.next();!g.done;f={Bc:f.Bc},g=b.next())f.Bc=g.value,e=e.X(function(b){return function(){return b.Bc(c,d)}}(f));return e.X(void 0,function(b){if(b&&7001==b.code)throw b;throw new J(2,1,1006,b);})}
function Ib(b,c,d,e,f,g,h,k){var l=new Ta(d.uris[f]),m=l.pa,n=!1;m||(m=location.protocol,m=m.slice(0,-1),Ua(l,m),d.uris[f]=l.toString());var q=(m=Cb[m])?m.ze:null;if(!q)return pb(new J(2,1,1E3,l));var r;return sb(lb(e)).X(function(){if(b.f)return qb();r=Date.now();0<d.loadedBytes&&(d.headers.Range="bytes="+d.loadedBytes+"-");return q(d.uris[f],d,c,function(e,f,g,l){b.c&&1==c&&(b.c(e,f),n=!0,h.a=g,k&&(d.loadedBytes+=f,k(e,f,g,l)))})}).X(function(b){void 0==b.timeMs&&(b.timeMs=Date.now()-r);return{response:b,
de:n}},function(l){if(l&&7001==l.code)throw l;if(b.f)return qb();if(l&&1==l.severity)return b.dispatchEvent(new M("retry",{error:l instanceof J?l:null})),f=(f+1)%d.uris.length,Ib(b,c,d,e,f,l,h,k);throw l||g;})}function Jb(b,c,d){var e=rb(void 0);b=t(b.b);for(var f=b.next();!f.done;f=b.next())e=e.X(f.value.bind(null,c,d.response));return e.X(function(){return d},function(b){if(b&&7001==b.code)throw b;var c=2;b instanceof J&&(c=b.severity);throw new J(c,1,1007,b);})}function Fb(){this.a=0}
N.NumBytesRemainingClass=Fb;function Gb(b,c,d){K.call(this,b,c);this.b=d}var Kb=Gb;Kb.prototype=ma(K.prototype);Kb.prototype.constructor=Kb;if(ra)ra(Kb,K);else for(var Lb in K)if("prototype"!=Lb)if(Object.defineProperties){var Mb=Object.getOwnPropertyDescriptor(K,Lb);Mb&&Object.defineProperty(Kb,Lb,Mb)}else Kb[Lb]=K[Lb];Kb.Ve=K.prototype;N.PendingRequest=Gb;Gb.all=tb;Gb.notAbortable=sb;Gb.completed=rb;Gb.aborted=qb;Gb.failed=pb;function Nb(){}z("shaka.util.IReleasable",Nb);Nb.prototype.release=function(){};function O(){this.a=new vb}z("shaka.util.EventManager",O);O.prototype.release=function(){this.yb();this.a=null};O.prototype.release=O.prototype.release;O.prototype.w=function(b,c,d,e){this.a&&(b=new Rb(b,c,d,e),this.a.push(c,b))};O.prototype.listen=O.prototype.w;O.prototype.ea=function(b,c,d,e){function f(e){g.aa(b,c,f);d(e)}var g=this;this.w(b,c,f,e)};O.prototype.listenOnce=O.prototype.ea;
O.prototype.aa=function(b,c,d){if(this.a){var e=this.a.get(c)||[];e=t(e);for(var f=e.next();!f.done;f=e.next())f=f.value,f.target!=b||d!=f.listener&&d||(f.aa(),this.a.remove(c,f))}};O.prototype.unlisten=O.prototype.aa;O.prototype.yb=function(){if(this.a){var b=this.a,c=[],d;for(d in b.a)c.push.apply(c,b.a[d]);b=t(c);for(c=b.next();!c.done;c=b.next())c.value.aa();this.a.a={}}};O.prototype.removeAll=O.prototype.yb;
function Rb(b,c,d,e){this.target=b;this.type=c;this.listener=d;this.a=Sb(b,e);this.target.addEventListener(c,d,this.a)}Rb.prototype.aa=function(){this.target.removeEventListener(this.type,this.listener,this.a);this.listener=this.target=null;this.a=!1};Rb.prototype.unlisten=Rb.prototype.aa;function Sb(b,c){if(void 0==c)return!1;if("boolean"==typeof c)return c;var d=new Set(["passive","capture"]);Object.keys(c).filter(function(b){return!d.has(b)});return Tb(b)?c:c.capture||!1}
function Tb(b){var c=Ub;if(void 0==c){c=!1;try{var d={},e={get:function(){c=!0;return!1}};Object.defineProperty(d,"passive",e);Object.defineProperty(d,"capture",e);e=function(){};b.addEventListener("test",e,d);b.removeEventListener("test",e,d)}catch(f){c=!1}Ub=c}return c||!1}var Ub=void 0;function Vb(b){b=new Uint8Array(b);if((new DataView(b.buffer,b.byteOffset,b.byteLength)).getUint32(0,!0)+4!=b.byteLength)throw new RangeError("Malformed FairPlay init data");b=Wb(b.subarray(4),!0);return(new Ta(b)).ma}z("shaka.util.FairPlayUtils.defaultGetContentId",Vb);
function Xb(b,c,d){function e(b){(new DataView(g.buffer)).setUint32(h,b.byteLength,!0);h+=4;f(b)}function f(b){g.set(b,h);h+=b.byteLength}if(!d||!d.byteLength)throw new J(2,6,6015);c="string"==typeof c?new Uint8Array(Yb(c,!0)):new Uint8Array(c);var g=new Uint8Array(8+b.byteLength+c.byteLength+d.byteLength),h=0;f(new Uint8Array(b));e(c);e(new Uint8Array(d));return g}z("shaka.util.FairPlayUtils.initDataTransform",Xb);function Zb(b,c){for(var d=t(b),e=d.next();!e.done;e=d.next())if(!c(e.value))return!1;return!0};function $b(b){var c=new Map;Object.keys(b).forEach(function(d){c.set(d,b[d])});return c}function ac(b){var c={};b.forEach(function(b,e){c[e]=b});return c};function bc(b,c){var d=b;c&&(d+='; codecs="'+c+'"');return d}function cc(b){var c=[b.mimeType];dc.forEach(function(d,e){var f=b[e];f&&c.push(d+'="'+f+'"')});return c.join(";")}function ec(b){b=b.split(".");var c=b[0];b.pop();return[c,b.join(".")]}var dc=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels");function fc(){return window.MediaSource&&MediaSource.isTypeSupported?!0:!1}function gc(b){return""!=hc().canPlayType(b)}function ic(b){return(navigator.userAgent||"").includes(b)}function hc(){if(jc)return jc;kc||(kc=new I(function(){jc=null}));(jc=document.querySelector("video")||document.querySelector("audio"))||(jc=document.createElement("video"));kc.T(1);return jc}var kc=null,jc=null;function lc(b){if(!b)return"";b=new Uint8Array(b);239==b[0]&&187==b[1]&&191==b[2]&&(b=b.subarray(3));b=mc(b);b=escape(b);try{return decodeURIComponent(b)}catch(c){throw new J(2,2,2004);}}z("shaka.util.StringUtils.fromUTF8",lc);
function Wb(b,c,d){if(!b)return"";if(!d&&0!=b.byteLength%2)throw A("Data has an incorrect length, must be even."),new J(2,2,2004);if(b instanceof ArrayBuffer)var e=b;else d=new Uint8Array(b.byteLength),d.set(new Uint8Array(b)),e=d.buffer;b=Math.floor(b.byteLength/2);d=new Uint16Array(b);e=new DataView(e);for(var f=0;f<b;f++)d[f]=e.getUint16(2*f,c);return mc(d)}z("shaka.util.StringUtils.fromUTF16",Wb);
function nc(b){var c=new Uint8Array(b);if(239==c[0]&&187==c[1]&&191==c[2])return lc(c);if(254==c[0]&&255==c[1])return Wb(c.subarray(2),!1);if(255==c[0]&&254==c[1])return Wb(c.subarray(2),!0);var d=function(b,c){return b.byteLength<=c||32<=b[c]&&126>=b[c]}.bind(null,c);D("Unable to find byte-order-mark, making an educated guess.");if(0==c[0]&&0==c[2])return Wb(b,!1);if(0==c[1]&&0==c[3])return Wb(b,!0);if(d(0)&&d(1)&&d(2)&&d(3))return lc(b);throw new J(2,2,2003);}
z("shaka.util.StringUtils.fromBytesAutoDetect",nc);function oc(b){b=encodeURIComponent(b);b=unescape(b);for(var c=new Uint8Array(b.length),d=0;d<b.length;++d)c[d]=b.charCodeAt(d);return c.buffer}z("shaka.util.StringUtils.toUTF8",oc);function Yb(b,c){for(var d=new Uint8Array(2*b.length),e=new DataView(d.buffer),f=0;f<b.length;++f)e.setUint16(2*f,b.charCodeAt(f),c);return d.buffer}z("shaka.util.StringUtils.toUTF16",Yb);
function mc(b){if(!pc)for(var c=function(b){try{var c=new Uint8Array(b);ta(c);return!0}catch(g){return!1}},d={size:65536};0<d.size;d={size:d.size},d.size/=2)if(c(d.size)){pc=function(b){return function(c){for(var d="",e=0;e<c.length;e+=b.size)d+=String.fromCharCode.apply(String,ta(c.subarray(e,e+b.size)));return d}}(d);break}return pc(b)}var pc=null;function qc(b,c){var d=mc(b);c=void 0==c?!0:c;d=window.btoa(d).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")}z("shaka.util.Uint8ArrayUtils.toBase64",qc);function rc(b){b=window.atob(b.replace(/-/g,"+").replace(/_/g,"/"));for(var c=new Uint8Array(b.length),d=0;d<b.length;++d)c[d]=b.charCodeAt(d);return c}z("shaka.util.Uint8ArrayUtils.fromBase64",rc);function sc(b){for(var c=new Uint8Array(b.length/2),d=0;d<b.length;d+=2)c[d/2]=window.parseInt(b.substr(d,2),16);return c}
z("shaka.util.Uint8ArrayUtils.fromHex",sc);function tc(b){for(var c="",d=0;d<b.length;++d){var e=b[d].toString(16);1==e.length&&(e="0"+e);c+=e}return c}z("shaka.util.Uint8ArrayUtils.toHex",tc);function uc(b,c){if(!b&&!c)return!0;if(!b||!c||b.length!=c.length)return!1;for(var d=0;d<b.length;++d)if(b[d]!=c[d])return!1;return!0}z("shaka.util.Uint8ArrayUtils.equal",uc);
function vc(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];for(var e=d=0;e<c.length;++e)d+=c[e].length;d=new Uint8Array(d);for(var f=e=0;f<c.length;++f)d.set(c[f],e),e+=c[f].length;return d}z("shaka.util.Uint8ArrayUtils.concat",vc);function wc(b){var c=this;this.B=b;this.s=new Set;this.j=this.h=null;this.V=!1;this.a=null;this.i=new O;this.c=new Map;this.v=[];this.l=new mb;this.b=null;this.g=function(d){c.l.reject(d);b.onError(d)};this.ja=new Map;this.ba=new Map;this.U=new I(function(){return xc(c)});this.f=!1;this.ha=new mb;this.N=!1;this.I=[];this.ia=!1;this.ca=(new I(function(){yc(c)})).Ga(1);this.l["catch"](function(){})}p=wc.prototype;
p.destroy=function(){var b=this;return u(function d(){return y(d,function(d){switch(d.m){case 1:if(b.f)return v(d,b.ha,0);b.f=!0;return v(d,zc(b),4);case 4:b.ha.resolve(),d.m=0}})})};
function zc(b){return u(function d(){var e;return y(d,function(d){switch(d.m){case 1:return b.i.release(),b.i=null,b.l.reject(),b.ca.stop(),b.ca=null,b.U.stop(),b.U=null,e=Array.from(b.c.keys()),b.c.clear(),v(d,Promise.all(e.map(function(b){return Promise.resolve().then(function(){return u(function k(){return y(k,function(d){switch(d.m){case 1:return G("Closing session",b.sessionId),d.S=2,v(d,Ac(b),4);case 4:xa(d,0);break;case 2:ya(d),w(d)}})})})})),2);case 2:if(!b.j){d.m=3;break}d.S=4;return v(d,
b.j.setMediaKeys(null),6);case 6:xa(d,5);break;case 4:ya(d);case 5:b.j=null;case 3:b.a=null,b.s.clear(),b.h=null,b.v=[],b.b=null,b.g=null,b.B=null,w(d)}})})}p.configure=function(b){this.b=b};function Bc(b,c,d){b.v=d;b.N=0<d.length;return Cc(b,c)}
function Cc(b,c){var d=c.some(function(b){return 0<b.drmInfos.length});if(!d){var e=$b(b.b.servers);Dc(c,e)}var f=Ec(b);if(f){var g=t(c);for(e=g.next();!e.done;e=g.next())e.value.drmInfos=[f]}f=t(c);for(e=f.next();!e.done;e=f.next())for(e=t(e.value.drmInfos),g=e.next();!g.done;g=e.next())Ic(g.value,$b(b.b.servers),$b(b.b.advanced||{}));e=Jc(b,c);if(!e.size)return b.V=!0,Promise.resolve();e=Kc(b,e);return d?e:e["catch"](function(){})}
p.qb=function(b){var c=this;if(!this.h)return this.i.ea(b,"encrypted",function(){c.g(new J(2,6,6010))}),Promise.resolve();this.j=b;this.i.ea(this.j,"play",function(){for(var b=0;b<c.I.length;b++)Lc(c,c.I[b]);c.ia=!0;c.I=[]});b=this.j.setMediaKeys(this.h);b=b["catch"](function(b){return Promise.reject(new J(2,6,6003,b.message))});var d=Mc(this);return Promise.all([b,d]).then(function(){if(c.f)return Promise.reject();Nc(c);c.a.initData.length||c.v.length||c.i.w(c.j,"encrypted",function(b){return Oc(c,
b.initDataType,new Uint8Array(b.initData))})})["catch"](function(b){if(!c.f)return Promise.reject(b)})};
function Mc(b){return u(function d(){var e,f;return y(d,function(d){switch(d.m){case 1:if(!(b.h&&b.a&&b.a.serverCertificate&&b.a.serverCertificate.length)){d.m=0;break}d.S=3;return v(d,b.h.setServerCertificate(b.a.serverCertificate),5);case 5:(e=d.O)||B("Server certificates are not supported by the key system.  The server certificate has been ignored.");xa(d,0);break;case 3:return f=ya(d),d["return"](Promise.reject(new J(2,6,6004,f.message)))}})})}
function Nc(b){var c=b.a?b.a.initData:[];c.forEach(function(c){return Pc(b,c.initDataType,c.initData)});b.v.forEach(function(c){return Qc(b,c)});c.length||b.v.length||b.l.resolve()}function Oc(b,c,d){var e=b.c.values();e=t(e);for(var f=e.next();!f.done;f=e.next())if(uc(d,f.value.initData)){D("Ignoring duplicate init data.");return}Pc(b,c,d)}p.keySystem=function(){return this.a?this.a.keySystem:""};function Rc(b,c){return ic("Edge/")?!0:b.s.has(c)}
p.nc=function(){var b=Infinity,c=this.c.keys();c=t(c);for(var d=c.next();!d.done;d=c.next())d=d.value,isNaN(d.expiration)||(b=Math.min(b,d.expiration));return b};
function Jc(b,c){for(var d=new Set,e=t(c),f=e.next();!f.done;f=e.next()){var g=t(f.value.drmInfos);for(f=g.next();!f.done;f=g.next())d.add(f.value)}e=t(d);for(f=e.next();!f.done;f=e.next())Ic(f.value,$b(b.b.servers),$b(b.b.advanced||{}));g=b.N?"required":"optional";var h=b.N?["persistent-license"]:["temporary"];e=new Map;d=t(d);for(f=d.next();!f.done;f=d.next())f=f.value,e.set(f.keySystem,{audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:g,sessionTypes:h,
label:f.keySystem,drmInfos:[]});d=t(c);for(f=d.next();!f.done;f=d.next()){f=f.value;g=f.audio;h=f.video;var k=g?bc(g.mimeType,g.codecs):"",l=h?bc(h.mimeType,h.codecs):"",m=t(f.drmInfos);for(f=m.next();!f.done;f=m.next()){f=f.value;var n=e.get(f.keySystem);n.drmInfos.push(f);f.distinctiveIdentifierRequired&&(n.distinctiveIdentifier="required");f.persistentStateRequired&&(n.persistentState="required");g&&n.audioCapabilities.push({robustness:f.audioRobustness||"",contentType:k});h&&n.videoCapabilities.push({robustness:f.videoRobustness||
"",contentType:l})}}return e}
function Kc(b,c){if(1==c.size&&c.has(""))return Promise.reject(new J(2,6,6E3));for(var d=t(c.values()),e=d.next();!e.done;e=d.next())e=e.value,0==e.audioCapabilities.length&&delete e.audioCapabilities,0==e.videoCapabilities.length&&delete e.videoCapabilities;var f=d=new mb;[!0,!1].forEach(function(b){var d=this;c.forEach(function(c,e){c.drmInfos.some(function(b){return!!b.licenseServerUri})==b&&(f=f["catch"](function(){if(!this.f)return navigator.requestMediaKeySystemAccess(e,[c])}.bind(d)))})}.bind(b));
f=f["catch"](function(){return Promise.reject(new J(2,6,6001))});f=f.then(function(b){if(this.f)return Promise.reject();this.s.clear();var d=b.getConfiguration(),e=d.videoCapabilities||[],f=t(d.audioCapabilities||[]);for(d=f.next();!d.done;d=f.next())this.s.add(d.value.contentType);e=t(e);for(d=e.next();!d.done;d=e.next())this.s.add(d.value.contentType);e=b.keySystem;d=c.get(b.keySystem);f=[];var g=[],n=[],q=[];Sc(d.drmInfos,f,g,n,q);1<g.length&&B("Multiple unique server certificates found! Only the first will be used.");
1<f.length&&B("Multiple unique license server URIs found! Only the first will be used.");this.a={keySystem:e,licenseServerUri:f[0],distinctiveIdentifierRequired:"required"==d.distinctiveIdentifier,persistentStateRequired:"required"==d.persistentState,audioRobustness:d.audioCapabilities?d.audioCapabilities[0].robustness:"",videoRobustness:d.videoCapabilities?d.videoCapabilities[0].robustness:"",serverCertificate:g[0],initData:n,keyIds:q};return this.a.licenseServerUri?b.createMediaKeys():Promise.reject(new J(2,
6,6012,this.a.keySystem))}.bind(b)).then(function(b){if(this.f)return Promise.reject();C("Created MediaKeys object for key system",this.a.keySystem);this.h=b;this.V=!0}.bind(b))["catch"](function(b){if(!this.f)return this.a=null,this.s.clear(),b instanceof J?Promise.reject(b):Promise.reject(new J(2,6,6002,b.message))}.bind(b));d.reject();return f}
function Ec(b){b=$b(b.b.clearKeys);if(0==b.size)return null;var c=[],d=[];b.forEach(function(b,e){var f=sc(e),g=sc(b);f={kty:"oct",kid:qc(f,!1),k:qc(g,!1)};c.push(f);d.push(f.kid)});b=JSON.stringify({keys:c});var e=JSON.stringify({kids:d});e=[{initData:new Uint8Array(oc(e)),initDataType:"keyids"}];return{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+window.btoa(b),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,
initData:e,keyIds:[]}}
function Qc(b,c){try{G("Attempting to load an offline session",c);var d=b.h.createSession("persistent-license")}catch(g){var e=new J(2,6,6005,g.message);b.g(e);return Promise.reject(e)}b.i.w(d,"message",b.ed.bind(b));b.i.w(d,"keystatuseschange",b.dd.bind(b));var f={initData:null,loaded:!1,xc:Infinity,Ha:null};b.c.set(d,f);return d.load(c).then(function(b){if(this.f)return Promise.reject();H("Loaded offline session",c,b);if(b)return f.loaded=!0,Tc(this)&&this.l.resolve(),d;this.c["delete"](d);this.g(new J(2,
6,6013))}.bind(b),function(b){this.f||(this.c["delete"](d),this.g(new J(2,6,6005,b.message)))}.bind(b))}
function Pc(b,c,d){try{if(b.N){G("Creating new persistent session");var e=b.h.createSession("persistent-license")}else G("Creating new temporary session"),e=b.h.createSession()}catch(h){b.g(new J(2,6,6005,h.message));return}b.i.w(e,"message",b.ed.bind(b));b.i.w(e,"keystatuseschange",b.dd.bind(b));b.c.set(e,{initData:d,loaded:!1,xc:Infinity,Ha:null});try{if(b.b.initDataTransform)d=b.b.initDataTransform(d);else if(b.keySystem().startsWith("com.apple.fps")){var f=b.a.serverCertificate,g=Vb(d);d=Xb(d,
g,f)}}catch(h){c=h;h instanceof J||(c=new J(2,6,6016,h));b.g(c);return}e.generateRequest(c,d.buffer)["catch"](function(c){if(!b.f){b.c["delete"](e);if(c.errorCode&&c.errorCode.systemCode){var d=c.errorCode.systemCode;0>d&&(d+=Math.pow(2,32));d="0x"+d.toString(16)}b.g(new J(2,6,6006,c.message,c,d))}})}p.ed=function(b){this.b.delayLicenseRequestUntilPlayed&&this.j.paused&&!this.ia?this.I.push(b):Lc(this,b)};
function Lc(b,c){var d=c.target;H("Sending license request for session",d.sessionId);var e=b.c.get(d),f=b.a.licenseServerUri,g=b.b.advanced[b.a.keySystem];"individualization-request"==c.messageType&&g&&g.individualizationServer&&(f=g.individualizationServer);f=Eb([f],b.b.retryParameters);f.body=c.message;f.method="POST";f.licenseRequestType=c.messageType;f.sessionId=d.sessionId;"com.microsoft.playready"!=b.a.keySystem&&"com.chromecast.playready"!=b.a.keySystem||Uc(f);b.a.keySystem.startsWith("com.apple.fps")&&
b.b.fairPlayTransform&&Vc(f);b.B.Rb.request(2,f).promise.then(function(b){if(this.f)return Promise.reject();this.a.keySystem.startsWith("com.apple.fps")&&this.b.fairPlayTransform&&Wc(b);return d.update(b.data).then(function(){var b=this;this.B.onEvent(new M("drmsessionupdate"));e&&(e.Ha&&e.Ha.resolve(),(new I(function(){e.loaded=!0;Tc(b)&&b.l.resolve()})).T(Xc))}.bind(this))}.bind(b),function(b){this.f||(b=new J(2,6,6007,b),this.g(b),e&&e.Ha&&e.Ha.reject(b))}.bind(b))["catch"](function(b){this.f||
(b=new J(2,6,6008,b.message),this.g(b),e&&e.Ha&&e.Ha.reject(b))}.bind(b))}
function Uc(b){var c=Wb(b.body,!0,!0);if(c.includes("PlayReadyKeyMessage")){D("Unwrapping PlayReady request.");c=(new DOMParser).parseFromString(c,"application/xml");for(var d=c.getElementsByTagName("HttpHeader"),e=0;e<d.length;++e)b.headers[d[e].querySelector("name").textContent]=d[e].querySelector("value").textContent;b.body=rc(c.querySelector("Challenge").textContent).buffer}else D("PlayReady request is already unwrapped."),b.headers["Content-Type"]="text/xml; charset=utf-8"}
function Vc(b){var c=new Uint8Array(b.body);c="spc="+qc(c);b.headers["Content-Type"]="application/x-www-form-urlencoded";b.body=oc(c)}function Wc(b){try{var c=lc(b.data)}catch(d){return}c=c.trim();"<ckc>"===c.substr(0,5)&&"</ckc>"===c.substr(-6)&&(c=c.slice(5,-6));try{c=JSON.parse(c).ckc}catch(d){}b.data=rc(c).buffer}
p.dd=function(b){b=b.target;H("Key status changed for session",b.sessionId);var c=this.c.get(b),d=!1;b.keyStatuses.forEach(function(b,e){if("string"==typeof e){var f=e;e=b;b=f}if("com.microsoft.playready"==this.a.keySystem&&16==e.byteLength&&!ic("Tizen")){f=new DataView(e);var g=f.getUint32(0,!0),l=f.getUint16(4,!0),m=f.getUint16(6,!0);f.setUint32(0,g,!1);f.setUint16(4,l,!1);f.setUint16(6,m,!1)}"com.microsoft.playready"==this.a.keySystem&&"status-pending"==b&&(b="usable");"status-pending"!=b&&(c.loaded=
!0);"expired"==b&&(d=!0);f=tc(new Uint8Array(e));this.ja.set(f,b)}.bind(this));var e=b.expiration-Date.now();(0>e||d&&1E3>e)&&c&&!c.Ha&&(D("Session has expired",b.sessionId),this.c["delete"](b),b.close()["catch"](function(){}));Tc(this)&&(this.l.resolve(),this.U.T(Yc))};function xc(b){var c=b.ja,d=b.ba;d.clear();c.forEach(function(b,c){return d.set(c,b)});c=Array.from(d.values());c.length&&c.every(function(b){return"expired"==b})&&b.g(new J(2,6,6014));b.B.cd(ac(d))}
function Zc(){function b(b){return u(function h(){var c,f,m;return y(h,function(h){switch(h.m){case 1:return h.S=2,v(h,navigator.requestMediaKeySystemAccess(b,d),4);case 4:return c=h.O,m=(f=c.getConfiguration().sessionTypes)?f.includes("persistent-license"):!1,ic("Tizen 3")&&(m=!1),e.set(b,{persistentState:m}),v(h,c.createMediaKeys(),5);case 5:xa(h,0);break;case 2:ya(h),e.set(b,null),w(h)}})})}var c=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],d=[{videoCapabilities:c,
persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:c}],e=new Map;c="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").map(function(c){return b(c)});return Promise.all(c).then(function(){return ac(e)})}
function $c(b,c){var d=c.audio,e=c.video;if(d&&d.encrypted&&!Rc(b,bc(d.mimeType,d.codecs))||e&&e.encrypted&&!Rc(b,bc(e.mimeType,e.codecs)))return!1;var f=b.keySystem();return 0==c.drmInfos.length||c.drmInfos.some(function(b){return b.keySystem==f})}
function ad(b,c){if(!b.length)return c;if(!c.length)return b;for(var d=[],e=0;e<b.length;e++)for(var f=0;f<c.length;f++)if(b[e].keySystem==c[f].keySystem){var g=b[e];f=c[f];var h=[];h=h.concat(g.initData||[]);h=h.concat(f.initData||[]);var k=[];k=k.concat(g.keyIds);k=k.concat(f.keyIds);d.push({keySystem:g.keySystem,licenseServerUri:g.licenseServerUri||f.licenseServerUri,distinctiveIdentifierRequired:g.distinctiveIdentifierRequired||f.distinctiveIdentifierRequired,persistentStateRequired:g.persistentStateRequired||
f.persistentStateRequired,videoRobustness:g.videoRobustness||f.videoRobustness,audioRobustness:g.audioRobustness||f.audioRobustness,serverCertificate:g.serverCertificate||f.serverCertificate,initData:h,keyIds:k});break}return d}function yc(b){b.c.forEach(function(c,d){var e=c.xc,f=d.expiration;isNaN(f)&&(f=Infinity);f!=e&&(b.B.onExpirationUpdated(d.sessionId,f),c.xc=f)})}function Tc(b){b=b.c.values();return Zb(b,function(b){return b.loaded})}
function Dc(b,c){var d=[];c.forEach(function(b,c){d.push({keySystem:c,licenseServerUri:b,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:[]})});for(var e=t(b),f=e.next();!f.done;f=e.next())f.value.drmInfos=d}
function Sc(b,c,d,e,f){b.forEach(function(b){c.includes(b.licenseServerUri)||c.push(b.licenseServerUri);b.serverCertificate&&(d.some(function(c){return uc(c,b.serverCertificate)})||d.push(b.serverCertificate));b.initData&&b.initData.forEach(function(b){e.some(function(c){return c.keyId&&c.keyId==b.keyId?!0:c.initDataType==b.initDataType&&uc(c.initData,b.initData)})||e.push(b)});if(b.keyIds)for(var g=0;g<b.keyIds.length;++g)f.includes(b.keyIds[g])||f.push(b.keyIds[g])})}
function Ic(b,c,d){if(b.keySystem&&("org.w3.clearkey"!=b.keySystem||!b.licenseServerUri)){c.size&&(c=c.get(b.keySystem)||"",b.licenseServerUri=c);b.keyIds||(b.keyIds=[]);if(d=d.get(b.keySystem))b.distinctiveIdentifierRequired||(b.distinctiveIdentifierRequired=d.distinctiveIdentifierRequired),b.persistentStateRequired||(b.persistentStateRequired=d.persistentStateRequired),b.videoRobustness||(b.videoRobustness=d.videoRobustness),b.audioRobustness||(b.audioRobustness=d.audioRobustness),b.serverCertificate||
(b.serverCertificate=d.serverCertificate);window.cast&&window.cast.__platform__&&"com.microsoft.playready"==b.keySystem&&(b.keySystem="com.chromecast.playready")}}function Ac(b){return u(function d(){var e,f;return y(d,function(d){switch(d.m){case 1:return e=new Promise(function(b){(new I(b)).T(bd)}),v(d,Promise.race([b.close().then(function(){return!0}),e.then(function(){return!1})]),2);case 2:(f=d.O)||B("Timeout waiting for session close"),w(d)}})})}var bd=1,Xc=5,Yc=.5;function cd(){this.a=new muxjs.mp4.CaptionParser;this.g=[];this.f={}}cd.prototype.init=function(b){var c=muxjs.mp4.probe;b=new Uint8Array(b);this.g=c.videoTrackIds(b);this.f=c.timescale(b);this.a.init()};cd.prototype.b=function(b,c){var d=new Uint8Array(b);(d=this.a.parse(d,this.g,this.f))&&d.captions&&c(d.captions);this.a.clearParsedCaptions()};cd.prototype.c=function(){this.a.resetCaptionStream()};function dd(){}dd.prototype.init=function(){};dd.prototype.b=function(){};dd.prototype.c=function(){};function ed(b){return!b||1==b.length&&1E-6>b.end(0)-b.start(0)?null:b.length?b.end(b.length-1):null}function fd(b,c,d){d=void 0===d?0:d;return!b||!b.length||1==b.length&&1E-6>b.end(0)-b.start(0)||c>b.end(b.length-1)?!1:c+d>=b.start(0)}function gd(b,c){if(!b||!b.length||1==b.length&&1E-6>b.end(0)-b.start(0))return 0;for(var d=0,e=b.length-1;0<=e&&b.end(e)>c;--e)d+=b.end(e)-Math.max(b.start(e),c);return d}
function hd(b){if(!b)return[];for(var c=[],d=0;d<b.length;d++)c.push({start:b.start(d),end:b.end(d)});return c};var id={Fd:function(b,c){return b.reduce(function(b,c,f){return c["catch"](b.bind(null,f))}.bind(null,c),Promise.reject())},Mc:function(b,c){return b.concat(c)},Sb:function(){},Ba:function(b){return null!=b}};function jd(b,c){if(0==c.length)return b;var d=c.map(function(b){return new Ta(b)});return b.map(function(b){return new Ta(b)}).map(function(b){return d.map(b.resolve.bind(b))}).reduce(id.Mc,[]).map(function(b){return b.toString()})}function kd(b,c){return{keySystem:b,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:c||[],keyIds:[]}}var ld={Kc:"video",wd:"audio",Ja:"text",df:"application"},md=1/15;function nd(){this.a=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0});this.b=null;this.g=[];this.c=[];this.f=!1;this.a.on("data",this.i.bind(this));this.a.on("done",this.h.bind(this))}nd.prototype.destroy=function(){this.a.dispose();this.a=null;return Promise.resolve()};function od(b,c){return window.muxjs&&"mp2t"==b.toLowerCase().split(";")[0].split("/")[1]?c?MediaSource.isTypeSupported(pd(c,b)):MediaSource.isTypeSupported(pd("audio",b))||MediaSource.isTypeSupported(pd("video",b)):!1}
function pd(b,c){var d=c.replace(/mp2t/i,"mp4");"audio"==b&&(d=d.replace("video","audio"));var e=/avc1\.(66|77|100)\.(\d+)/.exec(d);if(e){var f="avc1.",g=e[1],h=Number(e[2]);f=("66"==g?f+"4200":"77"==g?f+"4d00":f+"6400")+(h>>4).toString(16);f+=(h&15).toString(16);d=d.replace(e[0],f)}return d}function qd(b,c){b.f=!0;b.b=new mb;b.g=[];b.c=[];var d=new Uint8Array(c);b.a.push(d);b.a.flush();b.f&&b.b.reject(new J(2,3,3018));return b.b}
nd.prototype.i=function(b){this.c=b.captions;var c=new Uint8Array(b.data.byteLength+b.initSegment.byteLength);c.set(b.initSegment,0);c.set(b.data,b.initSegment.byteLength);this.g.push(c)};nd.prototype.h=function(){var b={data:vc.apply(null,this.g),captions:this.c};this.b.resolve(b);this.f=!1};function rd(b,c,d){this.startTime=b;this.direction=sd;this.endTime=c;this.payload=d;this.region=new td;this.position=null;this.positionAlign=ud;this.size=100;this.textAlign=vd;this.writingMode=wd;this.lineInterpretation=xd;this.line=null;this.lineHeight="";this.lineAlign=yd;this.displayAlign=zd;this.fontSize=this.backgroundImage=this.backgroundColor=this.color="";this.fontWeight=Ad;this.fontStyle=Bd;this.fontFamily="";this.textDecoration=[];this.wrapLine=!0;this.id=""}z("shaka.text.Cue",rd);
var ud="auto";rd.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:ud};var vd="center",Cd={LEFT:"left",RIGHT:"right",CENTER:vd,START:"start",END:"end"};rd.textAlign=Cd;var zd="after",Dd={BEFORE:"before",CENTER:"center",AFTER:zd};rd.displayAlign=Dd;var sd="ltr";rd.direction={HORIZONTAL_LEFT_TO_RIGHT:sd,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var wd="horizontal-tb";rd.writingMode={HORIZONTAL_TOP_TO_BOTTOM:wd,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};
var xd=0;rd.lineInterpretation={LINE_NUMBER:xd,PERCENTAGE:1};var yd="start",Ed={CENTER:"center",START:yd,END:"end"};rd.lineAlign=Ed;var Ad=400;rd.fontWeight={NORMAL:Ad,BOLD:700};var Bd="normal",Fd={NORMAL:Bd,ITALIC:"italic",OBLIQUE:"oblique"};rd.fontStyle=Fd;rd.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"};
function td(){this.id="";this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0;this.height=this.width=100;this.viewportAnchorUnits=this.widthUnits=this.heightUnits=Gd;this.scroll=Hd}z("shaka.text.CueRegion",td);var Gd=1;td.units={PX:0,PERCENTAGE:Gd,LINES:2};var Hd="";td.scrollMode={NONE:Hd,UP:"up"};function Id(b){this.g=null;this.c=b;this.f=this.l=0;this.h=Infinity;this.b=this.a=null;this.j="";this.i=new Map}var Jd={};z("shaka.text.TextEngine.registerParser",function(b,c){Jd[b]=c});z("shaka.text.TextEngine.unregisterParser",function(b){delete Jd[b]});function Kd(b){return Jd[b]||window.muxjs&&"application/cea-608"==b?!0:!1}Id.prototype.destroy=function(){this.c=this.g=null;this.i.clear();return Promise.resolve()};
Id.prototype.Nb=function(b){var c={periodStart:0,segmentStart:null,segmentEnd:0};try{return this.g.parseMedia(new Uint8Array(b),c)[0].startTime}catch(d){throw new J(2,2,2009,d);}};
function Ld(b,c,d,e){return Promise.resolve().then(function(){if(this.g&&this.c)if(null==d||null==e)this.g.parseInit(new Uint8Array(c));else{var b={periodStart:this.l,segmentStart:d,segmentEnd:e};b=this.g.parseMedia(new Uint8Array(c),b).filter(function(b){return b.startTime>=this.f&&b.startTime<this.h}.bind(this));this.c.append(b);null==this.a&&(this.a=Math.max(d,this.f));this.b=Math.min(e,this.h)}}.bind(b))}
Id.prototype.remove=function(b,c){return Promise.resolve().then(function(){!this.c||!this.c.remove(b,c)||null==this.a||c<=this.a||b>=this.b||(b<=this.a&&c>=this.b?this.a=this.b=null:b<=this.a&&c<this.b?this.a=c:b>this.a&&c>=this.b&&(this.b=b))}.bind(this))};Id.prototype.zd=function(b){this.c.append(b)};Id.prototype.appendCues=Id.prototype.zd;
Id.prototype.Zb=function(b,c){this.j=b;var d=this.i.get(b);if(d)for(var e=t(d.keys()),f=e.next();!f.done;f=e.next())if(f=d.get(f.value))f=f.filter(function(b){return b.endTime<=c}),this.c.append(f)};Id.prototype.setSelectedClosedCaptionId=Id.prototype.Zb;
function Md(b,c,d,e,f){var g=d+" "+e,h=new Map;c=t(c);for(var k=c.next();!k.done;k=c.next()){var l=k.value;k=l.stream;h.has(k)||h.set(k,new Map);h.get(k).has(g)||h.get(k).set(g,[]);l.startTime+=f;l.endTime+=f;l.startTime>=b.f&&l.startTime<b.h&&(l=new rd(l.startTime,l.endTime,l.text),h.get(k).get(g).push(l),k==b.j&&b.c.append([l]))}f=t(h.keys());for(g=f.next();!g.done;g=f.next())for(g=g.value,b.i.has(g)||b.i.set(g,new Map),c=t(h.get(g).keys()),k=c.next();!k.done;k=c.next())k=k.value,l=h.get(g).get(k),
b.i.get(g).set(k,l);b.a=null==b.a?Math.max(d,b.f):Math.min(b.a,Math.max(d,b.f));b.b=Math.max(b.b,Math.min(e,b.h))};function Nd(b,c,d){this.f=b;this.g=d;this.b={};this.a=null;this.c={};this.i=new O;this.v=!1;this.j={};this.l=c;b=this.s=new mb;c=new MediaSource;this.i.ea(c,"sourceopen",b.resolve);this.f.src=Od(c);this.h=c}var Od=window.URL.createObjectURL;function Pd(b){var c=bc(b.mimeType,b.codecs),d=cc(b);return Kd(c)||MediaSource.isTypeSupported(d)||od(c,b.type)}p=Nd.prototype;
p.destroy=function(){var b=this;this.v=!0;var c=[],d;for(d in this.c){var e=this.c[d],f=e[0];this.c[d]=e.slice(0,1);f&&c.push(f.p["catch"](id.Sb));for(f=1;f<e.length;++f)e[f].p.reject()}this.a&&c.push(this.a.destroy());this.g&&c.push(this.g.destroy());for(var g in this.j)c.push(this.j[g].destroy());return Promise.all(c).then(function(){b.i&&(b.i.release(),b.i=null);b.f&&(b.f.removeAttribute("src"),b.f.load(),b.f=null);b.h=null;b.a=null;b.g=null;b.b={};b.j={};b.l=null;b.c={}})};
p.init=function(b,c){var d=this;return u(function f(){var g;return y(f,function(f){switch(f.m){case 1:return g=ld,v(f,d.s,2);case 2:b.forEach(function(b,f){var h=bc(b.mimeType,b.codecs);f==g.Ja?Qd(d,h):(!c&&MediaSource.isTypeSupported(h)||!od(h,f)||(d.j[f]=new nd,h=pd(f,h)),h=d.h.addSourceBuffer(h),d.i.w(h,"error",d.Ue.bind(d,f)),d.i.w(h,"updateend",d.kb.bind(d,f)),d.b[f]=h,d.c[f]=[])}),w(f)}})})};function Qd(b,c){b.a||(b.a=new Id(b.g));"application/cea-608"!=c&&(b.a.g=new Jd[c])}
function Rd(b){return b.h?"ended"==b.h.readyState:!0}function Sd(b,c){if("text"==c)var d=b.a.a;else d=Td(b,c),d=!d||1==d.length&&1E-6>d.end(0)-d.start(0)?null:1==d.length&&0>d.start(0)?0:d.length?d.start(0):null;return d}function Ud(b,c){return"text"==c?b.a.b:ed(Td(b,c))}function Vd(b,c,d){if("text"==c)return b=b.a,null==b.b||b.b<d?0:b.b-Math.max(d,b.a);b=Td(b,c);return gd(b,d)}
p.lc=function(b){b.total=hd(this.f.buffered);b.audio=hd(Td(this,"audio"));b.video=hd(Td(this,"video"));b.text=[];if(this.a){var c=this.a.a,d=this.a.b;null!=c&&null!=d&&b.text.push({start:c,end:d})}};function Td(b,c){try{return b.b[c].buffered}catch(d){return c in b.b&&A("failed to get buffered range for "+c,d),null}}
function Wd(b,c,d,e,f,g){if("text"==c)return Ld(b.a,d,e,f);if(b.j[c])return qd(b.j[c],d).then(function(b){this.a||Qd(this,"text/vtt");b.captions&&Md(this.a,b.captions,e,f,this.b.video.timestampOffset);return Xd(this,c,this.td.bind(this,c,b.data.buffer))}.bind(b));g&&window.muxjs&&(b.a||Qd(b,"text/vtt"),null==e&&null==f?b.l.init(d):b.l.b(d,function(c){c.length&&Md(b.a,c,e,f,b.b.video.timestampOffset)}));return Xd(b,c,b.td.bind(b,c,d))}p.Zb=function(b){var c=Ud(this,"video")||0;this.a.Zb(b,c)};
p.remove=function(b,c,d){return"text"==b?this.a.remove(c,d):Xd(this,b,this.md.bind(this,b,c,d))};function Yd(b,c){if("text"==c){if(!b.a)return Promise.resolve();b.l.c();return b.a.remove(0,Infinity)}return Xd(b,c,b.md.bind(b,c,0,b.h.duration))}p.flush=function(b){return"text"==b?Promise.resolve():Xd(this,b,this.Id.bind(this,b))};
function Zd(b,c,d,e,f){return"text"==c?(b.a.l=d,b=b.a,b.f=e,b.h=f,Promise.resolve()):Promise.all([Xd(b,c,b.yd.bind(b,c)),Xd(b,c,b.Te.bind(b,c,d)),Xd(b,c,b.Pe.bind(b,c,e,f))])}p.endOfStream=function(b){return $d(this,function(){Rd(this)||(b?this.h.endOfStream(b):this.h.endOfStream())}.bind(this))};p.Qa=function(b){return $d(this,function(){this.h.duration=b}.bind(this))};p.Y=function(){return this.h.duration};p.td=function(b,c){this.b[b].appendBuffer(c)};
p.md=function(b,c,d){d<=c?this.kb(b):this.b[b].remove(c,d)};p.yd=function(b){var c=this.b[b].appendWindowStart,d=this.b[b].appendWindowEnd;this.b[b].abort();this.b[b].appendWindowStart=c;this.b[b].appendWindowEnd=d;this.kb(b)};p.Id=function(b){this.f.currentTime-=.001;this.kb(b)};p.Te=function(b,c){0>c&&(c+=.001);this.b[b].timestampOffset=c;this.kb(b)};p.Pe=function(b,c,d){this.b[b].appendWindowStart=0;this.b[b].appendWindowEnd=d;this.b[b].appendWindowStart=c;this.kb(b)};
p.Ue=function(b){this.c[b][0].p.reject(new J(2,3,3014,this.f.error?this.f.error.code:0))};p.kb=function(b){var c=this.c[b][0];c&&(c.p.resolve(),ae(this,b))};function Xd(b,c,d){if(b.v)return Promise.reject();d={start:d,p:new mb};b.c[c].push(d);if(1==b.c[c].length)try{d.start()}catch(e){"QuotaExceededError"==e.name?d.p.reject(new J(2,3,3017,c)):d.p.reject(new J(2,3,3015,e)),ae(b,c)}return d.p}
function $d(b,c){if(b.v)return Promise.reject();var d=[],e;for(e in b.b){var f=new mb,g={start:function(b){b.resolve()}.bind(null,f),p:f};b.c[e].push(g);d.push(f);1==b.c[e].length&&g.start()}return Promise.all(d).then(function(){try{c()}catch(l){var b=Promise.reject(new J(2,3,3015,l))}for(var d in this.b)ae(this,d);return b}.bind(b),function(b){throw b;}.bind(b))}function ae(b,c){b.c[c].shift();var d=b.c[c][0];if(d)try{d.start()}catch(e){d.p.reject(new J(2,3,3015,e)),ae(b,c)}};function be(b,c){b=P(b);c=P(c);return b.split("-")[0]==c.split("-")[0]}function ce(b,c){b=P(b);c=P(c);var d=b.split("-"),e=c.split("-");return d[0]==e[0]&&1==d.length&&2==e.length}function P(b){b=b.split("-");b=t(b);var c=b.next().value;c=void 0===c?"":c;var d=b.next().value;d=void 0===d?"":d;b=la(b);c=c.toLowerCase();c=de.get(c)||c;d=d.toUpperCase();return[d?c+"-"+d:c].concat(ta(b)).join("-")}
function ee(b){return b.language?P(b.language):b.audio&&b.audio.language?P(b.audio.language):b.video&&b.video.language?P(b.video.language):"und"}
function fe(b,c){for(var d=P(b),e=new Set,f=t(c),g=f.next();!g.done;g=f.next())e.add(P(g.value));f=t(e);for(g=f.next();!g.done;g=f.next())if(g=g.value,g==d)return g;f=t(e);for(g=f.next();!g.done;g=f.next())if(g=g.value,ce(g,d))return g;f=t(e);for(g=f.next();!g.done;g=f.next()){var h=g=g.value,k=d;h=P(h);k=P(k);h=h.split("-");k=k.split("-");if(2==h.length&&2==k.length&&h[0]==k[0])return g}e=t(e);for(g=e.next();!g.done;g=e.next())if(f=g.value,ce(d,f))return f;return null}
var de=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze",
"cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice",
"is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao",
"mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san",
"sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie",
"vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]);function ge(b,c,d){function e(b,c,d){return b>=c&&b<=d}var f=b.video;return f&&f.width&&f.height&&!(e(f.width,c.minWidth,Math.min(c.maxWidth,d.width))&&e(f.height,c.minHeight,Math.min(c.maxHeight,d.height))&&e(f.width*f.height,c.minPixels,c.maxPixels))||!e(b.bandwidth,c.minBandwidth,c.maxBandwidth)?!1:!0}function he(b,c,d){var e=!1;b.forEach(function(b){var f=b.allowedByApplication;b.allowedByApplication=ge(b,c,d);f!=b.allowedByApplication&&(e=!0)});return e}
function ie(b,c,d,e){e.variants=e.variants.filter(function(e){if(b&&b.V&&!$c(b,e))return D("Dropping variant - not compatible with key system",e),!1;var f=e.audio;e=e.video;return f&&!Pd(f)?(D("Dropping variant - audio not compatible with platform",je(f)),!1):e&&!Pd(e)?(D("Dropping variant - video not compatible with platform",je(e)),!1):f&&c&&!ke(f,c)?(D("Droping variant - not compatible with active audio","active audio",je(c),"variant.audio",je(f)),!1):e&&d&&!ke(e,d)?(D("Droping variant - not compatible with active video",
"active video",je(d),"variant.video",je(e)),!1):!0});e.textStreams=e.textStreams.filter(function(b){var c=Kd(bc(b.mimeType,b.codecs));c||D("Dropping text stream. Is not supported by the platform.",b);return c})}function ke(b,c){return b.mimeType!=c.mimeType||b.codecs.split(".")[0]!=c.codecs.split(".")[0]?!1:!0}
function le(b){var c=b.audio,d=b.video,e=c?c.codecs:null,f=d?d.codecs:null,g=[];f&&g.push(f);e&&g.push(e);var h=[];d&&h.push(d.mimeType);c&&h.push(c.mimeType);h=h[0]||null;var k=[];c&&k.push(c.kind);d&&k.push(d.kind);k=k[0]||null;var l=new Set;c&&c.roles.forEach(function(b){return l.add(b)});d&&d.roles.forEach(function(b){return l.add(b)});b={id:b.id,active:!1,type:"variant",bandwidth:b.bandwidth,language:b.language,label:null,kind:k,width:null,height:null,frameRate:null,mimeType:h,codecs:g.join(", "),
audioCodec:e,videoCodec:f,primary:b.primary,roles:Array.from(l),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null};d&&(b.videoId=d.id,b.originalVideoId=d.originalId,b.width=d.width||null,b.height=d.height||null,b.frameRate=d.frameRate||null,b.videoBandwidth=d.bandwidth||null);c&&(b.audioId=c.id,b.originalAudioId=c.originalId,b.channelsCount=c.channelsCount,b.audioBandwidth=c.bandwidth||
null,b.label=c.label,b.audioRoles=c.roles);return b}function me(b){return{id:b.id,active:!1,type:"text",bandwidth:0,language:b.language,label:b.label,kind:b.kind||null,width:null,height:null,frameRate:null,mimeType:b.mimeType,codecs:b.codecs||null,audioCodec:null,videoCodec:null,primary:b.primary,roles:b.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:b.originalId}}
function ne(b){b.__shaka_id||(b.__shaka_id=oe++);return b.__shaka_id}var oe=0;function pe(b){return{id:ne(b),active:!1,type:"",bandwidth:0,language:P(b.language),label:b.label,kind:b.kind,width:null,height:null,frameRate:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null}}
function qe(b){return b.allowedByApplication&&b.allowedByKeySystem}function re(b,c){var d=b.filter(function(b){return b.audio&&b.audio.channelsCount}),e=new Map;d=t(d);for(var f=d.next();!f.done;f=d.next()){f=f.value;var g=f.audio.channelsCount;e.has(g)||e.set(g,[]);e.get(g).push(f)}d=Array.from(e.keys());if(0==d.length)return b;f=d.filter(function(b){return b<=c});return f.length?e.get(Math.max.apply(null,f)):e.get(Math.min.apply(null,d))}
function se(b,c,d){var e=b,f=b.filter(function(b){return b.primary});f.length&&(e=f);var g=e.length?e[0].language:"";e=e.filter(function(b){return b.language==g});if(c){var h=fe(P(c),b.map(function(b){return b.language}));h&&(e=b.filter(function(b){return P(b.language)==h}))}if(d){b=te(e,d);if(b.length)return b;B("No exact match for the text role could be found.")}else if(b=e.filter(function(b){return 0==b.roles.length}),b.length)return b;b=e.map(function(b){return b.roles}).reduce(id.Mc,[]);return b.length?
te(e,b[0]):e}function te(b,c){return b.filter(function(b){return b.roles.includes(c)})}function ue(b,c,d){for(var e=0;e<d.length;e++)if(d[e].audio==b&&d[e].video==c)return d[e];return null}function ve(b){var c=[];b.audio&&c.push(b.audio);b.video&&c.push(b.video);return c}
function je(b){return"audio"==b.type?"type=audio codecs="+b.codecs+" bandwidth="+b.bandwidth+" channelsCount="+b.channelsCount:"video"==b.type?"type=video codecs="+b.codecs+" bandwidth="+b.bandwidth+" frameRate="+b.frameRate+" width="+b.width+" height="+b.height:"unexpected stream type"};function Q(){this.h=null;this.c=!1;this.b=new Pa;this.g=[];this.i=!1;this.a=this.f=null}z("shaka.abr.SimpleAbrManager",Q);Q.prototype.stop=function(){this.h=null;this.c=!1;this.g=[];this.f=null};Q.prototype.stop=Q.prototype.stop;Q.prototype.init=function(b){this.h=b};Q.prototype.init=Q.prototype.init;
Q.prototype.chooseVariant=function(){var b=we(this.a.restrictions,this.g),c=this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate);this.g.length&&!b.length&&(B("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),b=we(null,this.g),b=[b[0]]);for(var d=b[0]||null,e=0;e<b.length;++e){var f=b[e],g=f.bandwidth/this.a.bandwidthDowngradeTarget,h=(b[e+1]||{bandwidth:Infinity}).bandwidth/this.a.bandwidthUpgradeTarget;H("Bandwidth ranges:",(f.bandwidth/1E6).toFixed(3),(g/1E6).toFixed(3),
(h/1E6).toFixed(3));c>=g&&c<=h&&(d=f)}this.f=Date.now();return d};Q.prototype.chooseVariant=Q.prototype.chooseVariant;Q.prototype.enable=function(){this.c=!0};Q.prototype.enable=Q.prototype.enable;Q.prototype.disable=function(){this.c=!1};Q.prototype.disable=Q.prototype.disable;
Q.prototype.segmentDownloaded=function(b,c){H("Segment downloaded:","deltaTimeMs="+b,"numBytes="+c,"lastTimeChosenMs="+this.f,"enabled="+this.c);var d=this.b;if(!(16E3>c)){var e=8E3*c/b,f=b/1E3;d.a+=c;Ma(d.b,f,e);Ma(d.c,f,e)}if(null!=this.f&&this.c)a:{H("Suggesting Streams...");if(!this.i){if(!(128E3<=this.b.a)){H("Still waiting for a good estimate...");break a}this.i=!0}else if(Date.now()-this.f<1E3*this.a.switchInterval){H("Still within switch interval...");break a}d=this.chooseVariant();e=this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate);
D("Calling switch_(), bandwidth="+Math.round(e/1E3)+" kbps");this.h(d)}};Q.prototype.segmentDownloaded=Q.prototype.segmentDownloaded;Q.prototype.getBandwidthEstimate=function(){return this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate)};Q.prototype.getBandwidthEstimate=Q.prototype.getBandwidthEstimate;Q.prototype.setVariants=function(b){this.g=b};Q.prototype.setVariants=Q.prototype.setVariants;Q.prototype.configure=function(b){this.a=b};Q.prototype.configure=Q.prototype.configure;
function we(b,c){b&&(c=c.filter(function(c){return ge(c,b,{width:Infinity,height:Infinity})}));return c.sort(function(b,c){return b.bandwidth-c.bandwidth})};function R(b,c){this.D=b;this.b=c==xe;this.a=0}z("shaka.util.DataViewReader",R);var xe=1;R.Endianness={ef:0,ff:xe};R.prototype.na=function(){return this.a<this.D.byteLength};R.prototype.hasMoreData=R.prototype.na;R.prototype.Z=function(){return this.a};R.prototype.getPosition=R.prototype.Z;R.prototype.Pd=function(){return this.D.byteLength};R.prototype.getLength=R.prototype.Pd;R.prototype.zc=function(){try{var b=this.D.getUint8(this.a);this.a+=1;return b}catch(c){ye()}};R.prototype.readUint8=R.prototype.zc;
R.prototype.jd=function(){try{var b=this.D.getUint16(this.a,this.b);this.a+=2;return b}catch(c){ye()}};R.prototype.readUint16=R.prototype.jd;R.prototype.F=function(){try{var b=this.D.getUint32(this.a,this.b);this.a+=4;return b}catch(c){ye()}};R.prototype.readUint32=R.prototype.F;R.prototype.hd=function(){try{var b=this.D.getInt32(this.a,this.b);this.a+=4;return b}catch(c){ye()}};R.prototype.readInt32=R.prototype.hd;
R.prototype.xb=function(){try{if(this.b){var b=this.D.getUint32(this.a,!0);var c=this.D.getUint32(this.a+4,!0)}else c=this.D.getUint32(this.a,!1),b=this.D.getUint32(this.a+4,!1)}catch(d){ye()}if(2097151<c)throw new J(2,3,3001);this.a+=8;return c*Math.pow(2,32)+b};R.prototype.readUint64=R.prototype.xb;R.prototype.ob=function(b){this.a+b>this.D.byteLength&&ye();var c=new Uint8Array(this.D.buffer,this.D.byteOffset+this.a,b);this.a+=b;return new Uint8Array(c)};R.prototype.readBytes=R.prototype.ob;
R.prototype.H=function(b){this.a+b>this.D.byteLength&&ye();this.a+=b};R.prototype.skip=R.prototype.H;R.prototype.Je=function(b){this.a<b&&ye();this.a-=b};R.prototype.rewind=R.prototype.Je;R.prototype.seek=function(b){(0>b||b>this.D.byteLength)&&ye();this.a=b};R.prototype.seek=R.prototype.seek;R.prototype.Be=function(){for(var b=this.a;this.na()&&0!=this.D.getUint8(this.a);)this.a+=1;b=new Uint8Array(this.D.buffer,this.D.byteOffset+b,this.a-b);this.a+=1;return lc(b)};
R.prototype.readTerminatedString=R.prototype.Be;function ye(){throw new J(2,3,3E3);};function S(){this.c=[];this.b=[];this.a=!1}z("shaka.util.Mp4Parser",S);S.prototype.K=function(b,c){var d=ze(b);this.c[d]=0;this.b[d]=c;return this};S.prototype.box=S.prototype.K;S.prototype.ra=function(b,c){var d=ze(b);this.c[d]=1;this.b[d]=c;return this};S.prototype.fullBox=S.prototype.ra;S.prototype.stop=function(){this.a=!0};S.prototype.stop=S.prototype.stop;
S.prototype.parse=function(b,c){var d=new Uint8Array(b);d=new R(new DataView(d.buffer,d.byteOffset,d.byteLength),0);for(this.a=!1;d.na()&&!this.a;)this.Wb(0,d,c)};S.prototype.parse=S.prototype.parse;
S.prototype.Wb=function(b,c,d){var e=c.Z(),f=c.F(),g=c.F();H("Parsing MP4 box",Ae(g));switch(f){case 0:f=c.D.byteLength-e;break;case 1:f=c.xb()}var h=this.b[g];if(h){var k=null,l=null;1==this.c[g]&&(l=c.F(),k=l>>>24,l&=16777215);g=e+f;d&&g>c.D.byteLength&&(g=c.D.byteLength);g-=c.Z();c=0<g?c.ob(g):new Uint8Array(0);c=new R(new DataView(c.buffer,c.byteOffset,c.byteLength),0);h({parser:this,partialOkay:d||!1,version:k,flags:l,reader:c,size:f,start:e+b})}else c.H(Math.min(e+f-c.Z(),c.D.byteLength-c.Z()))};
S.prototype.parseNext=S.prototype.Wb;function Be(b){for(;b.reader.na()&&!b.parser.a;)b.parser.Wb(b.start,b.reader,b.partialOkay)}S.children=Be;function Ce(b){for(var c=b.reader.F();0<c&&!b.parser.a;--c)b.parser.Wb(b.start,b.reader,b.partialOkay)}S.sampleDescription=Ce;function De(b){return function(c){b(c.reader.ob(c.reader.D.byteLength-c.reader.Z()))}}S.allData=De;function ze(b){for(var c=0,d=0;d<b.length;d++)c=c<<8|b.charCodeAt(d);return c}
function Ae(b){return String.fromCharCode(b>>24&255,b>>16&255,b>>8&255,b&255)}S.typeToString=Ae;function Ee(b){this.f=[];this.b=[];this.a=[];(new S).ra("pssh",this.c.bind(this)).parse(b.buffer);0==this.a.length&&B("No pssh box found!")}
Ee.prototype.c=function(b){if(1<b.version)B("Unrecognized PSSH version found!");else{var c=tc(b.reader.ob(16)),d=[];if(0<b.version)for(var e=b.reader.F(),f=0;f<e;++f){var g=tc(b.reader.ob(16));d.push(g)}e=b.reader.F();b.reader.H(e);this.b.push.apply(this.b,d);this.f.push(c);this.a.push({start:b.start,end:b.start+b.size-1});b.reader.Z()!=b.reader.D.byteLength&&B("Mismatch between box size and data size!")}};var T={Jb:function(b,c){var d=T.L(b,c);return 1!=d.length?null:d[0]},kc:function(b,c,d){b=T.Sc(b,c,d);return 1!=b.length?null:b[0]},L:function(b,c){return Array.prototype.filter.call(b.childNodes,function(b){return b instanceof Element&&b.tagName==c})},Sc:function(b,c,d){return Array.prototype.filter.call(b.childNodes,function(b){return b instanceof Element&&b.localName==d&&b.namespaceURI==c})},getAttributeNS:function(b,c,d){return b.hasAttributeNS(c,d)?b.getAttributeNS(c,d):null},Kb:function(b){return Array.prototype.every.call(b.childNodes,
function(b){return b.nodeType==Node.TEXT_NODE||b.nodeType==Node.CDATA_SECTION_NODE})?b.textContent.trim():null},C:function(b,c,d,e){e=void 0===e?null:e;var f=null;b=b.getAttribute(c);null!=b&&(f=d(b));return null==f?e:f},we:function(b){if(!b)return null;/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(b)&&(b+="Z");b=Date.parse(b);return isNaN(b)?null:Math.floor(b/1E3)},ua:function(b){if(!b)return null;var c=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(b);
if(!c)return B("Invalid duration string:",b),null;b=31536E3*Number(c[1]||null)+2592E3*Number(c[2]||null)+86400*Number(c[3]||null)+3600*Number(c[4]||null)+60*Number(c[5]||null)+Number(c[6]||null);return isFinite(b)?b:null},Yb:function(b){var c=/([0-9]+)-([0-9]+)/.exec(b);if(!c)return null;b=Number(c[1]);if(!isFinite(b))return null;c=Number(c[2]);return isFinite(c)?{start:b,end:c}:null},parseInt:function(b){b=Number(b);return 0===b%1?b:null},Xb:function(b){b=Number(b);return 0===b%1&&0<b?b:null},lb:function(b){b=
Number(b);return 0===b%1&&0<=b?b:null},parseFloat:function(b){b=Number(b);return isNaN(b)?null:b},Hd:function(b){var c;b=(c=b.match(/^(\d+)\/(\d+)$/))?Number(c[1])/Number(c[2]):Number(b);return isNaN(b)?null:b},gd:function(b,c){var d=new DOMParser;try{var e=d.parseFromString(b,"text/xml")}catch(g){}if(e&&e.documentElement.tagName==c)var f=e.documentElement;return f&&0<f.getElementsByTagName("parsererror").length?null:f},fd:function(b,c){try{var d=lc(b);return T.gd(d,c)}catch(e){}}};var Fe=(new Map).set("urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b","org.w3.clearkey").set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha").set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb","com.adobe.primetime");
function Ge(b,c,d){var e=He(b),f=null;b=[];var g=[],h=new Set(e.map(function(b){return b.keyId}));h["delete"](null);if(1<h.size)throw new J(2,4,4010);d||(g=e.filter(function(b){return"urn:mpeg:dash:mp4protection:2011"==b.od?(f=b.init||f,!1):!0}),g.length&&(b=Ie(f,c,g),0==b.length&&(b=[kd("",f)])));if(e.length&&(d||!g.length))for(b=[],c=t(Fe.values()),d=c.next();!d.done;d=c.next())d=d.value,"org.w3.clearkey"!=d&&b.push(kd(d,f));if(h=Array.from(h)[0]||null)for(c=t(b),d=c.next();!d.done;d=c.next())for(d=
t(d.value.initData),e=d.next();!e.done;e=d.next())e.value.keyId=h;return{Nc:h,hf:f,drmInfos:b,Tc:!0}}function Je(b,c,d,e){var f=Ge(b,c,e);if(d.Tc){b=1==d.drmInfos.length&&!d.drmInfos[0].keySystem;c=0==f.drmInfos.length;if(0==d.drmInfos.length||b&&!c)d.drmInfos=f.drmInfos;d.Tc=!1}else if(0<f.drmInfos.length&&(d.drmInfos=d.drmInfos.filter(function(b){return f.drmInfos.some(function(c){return c.keySystem==b.keySystem})}),0==d.drmInfos.length))throw new J(2,4,4008);return f.Nc||d.Nc}
function Ke(b){var c=0,d=(new DataView(b)).getUint32(c,!0);c+=4;if(d!==b.byteLength)return B("PlayReady Object with invalid length encountered."),[];c+=2;d=[];for(var e=new DataView(b);c<b.byteLength-1;){var f=e.getUint16(c,!0);c+=2;var g=e.getUint16(c,!0);c+=2;var h=new Uint8Array(b,c,g);d.push({type:f,value:h});c+=g}return d}function Le(b){return(b=b.querySelector("DATA > LA_URL"))?b.textContent:""}
function Ie(b,c,d){var e=[];d=t(d);for(var f=d.next();!f.done;f=d.next()){f=f.value;var g=Fe.get(f.od);if(g){var h;if(h=T.kc(f.node,"urn:microsoft:playready","pro")){h=rc(h.textContent);var k=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),l=h.length,m=k.length+16+l,n=new ArrayBuffer(m),q=new Uint8Array(n);n=new DataView(n);var r=0;n.setUint32(r,m);r+=4;n.setUint32(r,1886614376);r+=4;n.setUint32(r,0);r+=4;q.set(k,r);r+=k.length;n.setUint32(r,l);r+=4;q.set(h,r);h=[{initData:q,
initDataType:"cenc",keyId:f.keyId}]}else h=null;h=kd(g,f.init||b||h);if(g=Me.get(g))h.licenseServerUri=g(f);e.push(h)}else for(f=c(f.node)||[],f=t(f),g=f.next();!g.done;g=f.next())e.push(g.value)}return e}
var Me=(new Map).set("com.widevine.alpha",function(b){return(b=T.kc(b.node,"urn:microsoft","laurl"))?b.getAttribute("licenseUrl")||"":""}).set("com.microsoft.playready",function(b){b=T.kc(b.node,"urn:microsoft:playready","pro");if(!b)return"";b=rc(b.textContent);b=Ke(b.buffer).filter(function(b){return 1===b.type})[0];if(!b)return"";b=Wb(b.value,!0);return(b=T.gd(b,"WRMHEADER"))?Le(b):""});function He(b){var c=[];b=t(b);for(var d=b.next();!d.done;d=b.next())(d=Ne(d.value))&&c.push(d);return c}
function Ne(b){var c=b.getAttribute("schemeIdUri"),d=T.getAttributeNS(b,"urn:mpeg:cenc:2013","default_KID"),e=T.Sc(b,"urn:mpeg:cenc:2013","pssh").map(T.Kb);if(!c)return A("Missing required schemeIdUri attribute on","ContentProtection element",b),null;c=c.toLowerCase();if(d&&(d=d.replace(/-/g,"").toLowerCase(),d.includes(" ")))throw new J(2,4,4009);var f=[];try{f=e.map(function(b){return{initDataType:"cenc",initData:rc(b),keyId:null}})}catch(g){throw new J(2,4,4007);}return{node:b,od:c,keyId:d,init:0<
f.length?f:null}};function Oe(b,c,d,e,f){var g={RepresentationID:c,Number:d,Bandwidth:e,Time:f};return b.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(c,d,e,f){if("$$"==c)return"$";var h=g[d];if(null==h)return B("URL template does not have an available substitution for identifier",'"'+d+'":',b),c;"RepresentationID"==d&&e&&(B("URL template should not contain a width specifier for identifier",'"RepresentationID":',b),e=void 0);"Time"==d&&(h=Math.round(h));switch(f){case void 0:case "d":case "i":case "u":c=
h.toString();break;case "o":c=h.toString(8);break;case "x":c=h.toString(16);break;case "X":c=h.toString(16).toUpperCase();break;default:c=h.toString()}e=window.parseInt(e,10)||1;return Array(Math.max(0,e-c.length)+1).join("0")+c})}
function Pe(b,c){var d=Qe(b,c,"timescale"),e=1;d&&(e=T.Xb(d)||1);d=Qe(b,c,"duration");(d=T.Xb(d||""))&&(d/=e);var f=Qe(b,c,"startNumber"),g=Number(Qe(b,c,"presentationTimeOffset"))||0,h=T.lb(f||"");if(null==f||null==h)h=1;var k=Re(b,c,"SegmentTimeline");f=null;if(k){f=e;var l=b.M.duration||Infinity;k=T.L(k,"S");for(var m=[],n=0,q=0;q<k.length;++q){var r=k[q],x=T.C(r,"t",T.lb),E=T.C(r,"d",T.lb),F=T.C(r,"r",T.parseInt);null!=x&&(x-=g);if(!E){B('"S" element must have a duration:','ignoring the remaining "S" elements.',
r);break}x=null!=x?x:n;F=F||0;if(0>F)if(q+1<k.length){F=T.C(k[q+1],"t",T.lb);if(null==F){B('An "S" element cannot have a negative repeat','if the next "S" element does not have a valid start time:','ignoring the remaining "S" elements.',r);break}else if(x>=F){B('An "S" element cannot have a negative repeat','if its start time exceeds the next "S" element\'s start time:','ignoring the remaining "S" elements.',r);break}F=Math.ceil((F-x)/E)-1}else{if(Infinity==l){B('The last "S" element cannot have a negative repeat',
"if the Period has an infinite duration:",'ignoring the last "S" element.',r);break}else if(x/f>=l){B('The last "S" element cannot have a negative repeat',"if its start time exceeds the Period's duration:",'igoring the last "S" element.',r);break}F=Math.ceil((l*f-x)/E)-1}0<m.length&&x!=n&&(Math.abs((x-n)/f)>=md&&B("SegmentTimeline contains a large gap/overlap:","the content may have errors in it.",r),m[m.length-1].end=x/f);for(r=0;r<=F;++r)n=x+E,m.push({start:x/f,end:n/f,af:x}),x=n}f=m}return{timescale:e,
R:d,Ra:h,ga:g/e||0,Jc:g,G:f}}function Qe(b,c,d){return[c(b.u),c(b.W),c(b.fa)].filter(id.Ba).map(function(b){return b.getAttribute(d)}).reduce(function(b,c){return b||c})}function Re(b,c,d){return[c(b.u),c(b.W),c(b.fa)].filter(id.Ba).map(function(b){return T.Jb(b,d)}).reduce(function(b,c){return b||c})}
function Se(b,c,d,e,f,g){for(var h=T.getAttributeNS(b,"http://www.w3.org/1999/xlink","href"),k=T.getAttributeNS(b,"http://www.w3.org/1999/xlink","actuate")||"onRequest",l=0;l<b.attributes.length;l++){var m=b.attributes[l];"http://www.w3.org/1999/xlink"==m.namespaceURI&&(b.removeAttributeNS(m.namespaceURI,m.localName),--l)}if(5<=g)return pb(new J(2,4,4028));if("onLoad"!=k)return pb(new J(2,4,4027));var n=jd([e],[h]);return f.request(0,Eb(n,c)).X(function(e){e=T.fd(e.data,b.tagName);if(!e)return pb(new J(2,
4,4001,h));for(;b.childNodes.length;)b.removeChild(b.childNodes[0]);for(;e.childNodes.length;){var k=e.childNodes[0];e.removeChild(k);b.appendChild(k)}for(k=0;k<e.attributes.length;k++){var l=e.attributes[k].nodeName,m=e.getAttribute(l);b.setAttribute(l,m)}return Te(b,c,d,n[0],f,g+1)})}
function Te(b,c,d,e,f,g){g=void 0===g?0:g;if(T.getAttributeNS(b,"http://www.w3.org/1999/xlink","href")){var h=Se(b,c,d,e,f,g);d&&(h=h.X(void 0,function(){return Te(b,c,d,e,f,g)}));return h}h=[];for(var k=0;k<b.childNodes.length;k++){var l=b.childNodes[k];l instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==T.getAttributeNS(l,"http://www.w3.org/1999/xlink","href")?(b.removeChild(l),--k):"SegmentTimeline"!=l.tagName&&h.push(Te(l,c,d,e,f,g)))}return tb(h).X(function(){return b})};function Ue(b,c,d){this.c=b;this.b=c;this.a=d;this.data=null}z("shaka.media.InitSegmentReference",Ue);Ue.prototype.gc=function(){return this.c()};Ue.prototype.createUris=Ue.prototype.gc;Ue.prototype.oc=function(){return this.b};Ue.prototype.getStartByte=Ue.prototype.oc;Ue.prototype.mc=function(){return this.a};Ue.prototype.getEndByte=Ue.prototype.mc;function U(b,c,d,e,f,g){this.position=b;this.startTime=c;this.endTime=d;this.c=e;this.b=f;this.a=g}z("shaka.media.SegmentReference",U);
U.prototype.Z=function(){return this.position};U.prototype.getPosition=U.prototype.Z;U.prototype.Nb=function(){return this.startTime};U.prototype.getStartTime=U.prototype.Nb;U.prototype.Nd=function(){return this.endTime};U.prototype.getEndTime=U.prototype.Nd;U.prototype.gc=function(){return this.c()};U.prototype.createUris=U.prototype.gc;U.prototype.oc=function(){return this.b};U.prototype.getStartByte=U.prototype.oc;U.prototype.mc=function(){return this.a};U.prototype.getEndByte=U.prototype.mc;function Ve(b,c,d,e){var f,g=(new S).ra("sidx",function(b){f=We(c,e,d,b)});b&&g.parse(b);if(f)return f;A('Invalid box type, expected "sidx".');throw new J(2,3,3004);}
function We(b,c,d,e){var f=[];e.reader.H(4);var g=e.reader.F();if(0==g)throw A("Invalid timescale."),new J(2,3,3005);if(0==e.version){var h=e.reader.F();var k=e.reader.F()}else h=e.reader.xb(),k=e.reader.xb();e.reader.H(2);var l=e.reader.jd();b=b+e.size+k;for(k=0;k<l;k++){var m=e.reader.F(),n=(m&2147483648)>>>31;m&=2147483647;var q=e.reader.F();e.reader.H(4);if(1==n)throw A("Heirarchical SIDXs are not supported."),new J(2,3,3006);f.push(new U(f.length,h/g-c,(h+q)/g-c,function(){return d},b,b+m-1));
h+=q;b+=m}e.parser.stop();return f};function W(b){this.a=b}z("shaka.media.SegmentIndex",W);W.prototype.destroy=function(){this.a=null;return Promise.resolve()};W.prototype.destroy=W.prototype.destroy;W.prototype.find=function(b){for(var c=this.a.length-1;0<=c;--c){var d=this.a[c];if(b>=d.startTime&&b<d.endTime)return d.position}return this.a.length&&b<this.a[0].startTime?this.a[0].position:null};W.prototype.find=W.prototype.find;
W.prototype.get=function(b){if(0==this.a.length)return null;b-=this.a[0].position;return 0>b||b>=this.a.length?null:this.a[b]};W.prototype.get=W.prototype.get;W.prototype.offset=function(b){for(var c=0;c<this.a.length;++c)this.a[c].startTime+=b,this.a[c].endTime+=b};W.prototype.offset=W.prototype.offset;
W.prototype.tc=function(b){for(var c=[],d=0,e=0;d<this.a.length&&e<b.length;){var f=this.a[d],g=b[e];f.startTime<g.startTime?(c.push(f),d++):(f.startTime>g.startTime?0==d?c.push(g):B("Refusing to rewrite original references on update!"):(.1<Math.abs(f.endTime-g.endTime)?c.push(new U(f.position,g.startTime,g.endTime,g.c,g.b,g.a)):c.push(f),d++),e++)}for(;d<this.a.length;)c.push(this.a[d++]);if(c.length)for(d=c[c.length-1].position+1;e<b.length;)f=b[e++],f=new U(d++,f.startTime,f.endTime,f.c,f.b,f.a),
c.push(f);else c=b;this.a=c};W.prototype.merge=W.prototype.tc;W.prototype.ic=function(b){for(var c=0;c<this.a.length;++c)if(this.a[c].endTime>b){this.a.splice(0,c);return}this.a=[]};W.prototype.evict=W.prototype.ic;function Xe(b,c){for(;b.a.length;)if(b.a[b.a.length-1].startTime>=c)b.a.pop();else break;for(;b.a.length;)if(0>=b.a[0].endTime)b.a.shift();else break;if(0!=b.a.length){var d=b.a[b.a.length-1];b.a[b.a.length-1]=new U(d.position,d.startTime,c,d.c,d.b,d.a)}};function Ye(b){this.b=b;this.a=new R(b,0);Ze||(Ze=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var Ze;Ye.prototype.na=function(){return this.a.na()};
function $e(b){var c=af(b);if(7<c.length)throw new J(2,3,3002);for(var d=0,e=0;e<c.length;e++)d=256*d+c[e];c=d;d=af(b);a:{for(e=0;e<Ze.length;e++)if(uc(d,Ze[e])){e=!0;break a}e=!1}if(e)d=b.b.byteLength-b.a.Z();else{if(8==d.length&&d[1]&224)throw new J(2,3,3001);e=d[0]&(1<<8-d.length)-1;for(var f=1;f<d.length;f++)e=256*e+d[f];d=e}d=b.a.Z()+d<=b.b.byteLength?d:b.b.byteLength-b.a.Z();e=new DataView(b.b.buffer,b.b.byteOffset+b.a.Z(),d);b.a.H(d);return new bf(c,e)}
function af(b){var c=b.a.zc(),d;for(d=1;8>=d&&!(c&1<<8-d);d++);if(8<d)throw new J(2,3,3002);var e=new Uint8Array(d);e[0]=c;for(c=1;c<d;c++)e[c]=b.a.zc();return e}function bf(b,c){this.id=b;this.a=c}function cf(b){if(8<b.a.byteLength)throw new J(2,3,3002);if(8==b.a.byteLength&&b.a.getUint8(0)&224)throw new J(2,3,3001);for(var c=0,d=0;d<b.a.byteLength;d++){var e=b.a.getUint8(d);c=256*c+e}return c};function df(){}
df.prototype.parse=function(b,c,d,e){var f;c=new Ye(new DataView(c));if(440786851!=$e(c).id)throw A("Not an EBML element."),new J(2,3,3008);var g=$e(c);if(408125543!=g.id)throw A("Not a Segment element."),new J(2,3,3009);c=g.a.byteOffset;g=new Ye(g.a);for(f=null;g.na();){var h=$e(g);if(357149030==h.id){f=h;break}}if(!f)throw A("Not an Info element."),new J(2,3,3010);g=new Ye(f.a);f=1E6;for(h=null;g.na();){var k=$e(g);if(2807729==k.id)f=cf(k);else if(17545==k.id)if(h=k,4==h.a.byteLength)h=h.a.getFloat32(0);
else if(8==h.a.byteLength)h=h.a.getFloat64(0);else throw new J(2,3,3003);}if(null==h)throw new J(2,3,3011);g=f/1E9;f=h*g;b=$e(new Ye(new DataView(b)));if(475249515!=b.id)throw A("Not a Cues element."),new J(2,3,3007);return ef(b,c,g,f,d,e)};
function ef(b,c,d,e,f,g){function h(){return f}var k=[];b=new Ye(b.a);for(var l=null,m=null;b.na();){var n=$e(b);if(187==n.id){var q=ff(n);q&&(n=d*q.bf,q=c+q.Ee,null!=l&&k.push(new U(k.length,l-g,n-g,h,m,q-1)),l=n,m=q)}}null!=l&&k.push(new U(k.length,l-g,e-g,h,m,null));return k}
function ff(b){var c=new Ye(b.a);b=$e(c);if(179!=b.id)throw B("Not a CueTime element."),new J(2,3,3013);b=cf(b);c=$e(c);if(183!=c.id)throw B("Not a CueTrackPositions element."),new J(2,3,3012);c=new Ye(c.a);for(var d=0;c.na();){var e=$e(c);if(241==e.id){d=cf(e);break}}return{bf:b,Ee:d}};function gf(b,c){var d=Re(b,c,"Initialization");if(!d)return null;var e=jd(b.J.za,b.u.J),f=d.getAttribute("sourceURL");f&&(e=jd(e,[f]));f=0;var g=null;if(d=T.C(d,"range",T.Yb))f=d.start,g=d.end;return new Ue(function(){return e},f,g)}
function hf(b,c){var d=Number(Qe(b,jf,"presentationTimeOffset"))||0,e=Qe(b,jf,"timescale"),f=1;e&&(f=T.Xb(e)||1);d=d/f||0;e=gf(b,jf);var g=b.u.contentType;f=b.u.mimeType.split("/")[1];if("text"!=g&&"mp4"!=f&&"webm"!=f)throw A("SegmentBase specifies an unsupported container type.",b.u),new J(2,4,4006);if("webm"==f&&!e)throw A("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",b.u),new J(2,4,4005);
g=Re(b,jf,"RepresentationIndex");var h=Qe(b,jf,"indexRange"),k=jd(b.J.za,b.u.J);h=T.Yb(h||"");if(g){var l=g.getAttribute("sourceURL");l&&(k=jd(k,[l]));h=T.C(g,"range",T.Yb,h)}if(!h)throw A("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",b.u),new J(2,4,4002);f=kf(b,c,e,k,h.start,h.end,f,d);return{createSegmentIndex:f.createSegmentIndex,findSegmentPosition:f.findSegmentPosition,getSegmentReference:f.getSegmentReference,
initSegmentReference:e,ga:d}}function kf(b,c,d,e,f,g,h,k){var l=b.presentationTimeline,m=!b.cb||!b.M.qc,n=b.M.start,q=b.M.duration,r=c,x=null;return{createSegmentIndex:function(){var b=[r(e,f,g),"webm"==h?r(d.c(),d.b,d.a):null];r=null;return Promise.all(b).then(function(b){var c=b[0];b=b[1]||null;c="mp4"==h?Ve(c,f,e,k):(new df).parse(c,b,e,k);l.Tb(c,n);x=new W(c);m&&Xe(x,q)})},findSegmentPosition:function(b){return x.find(b)},getSegmentReference:function(b){return x.get(b)}}}
function jf(b){return b.zb};function lf(b,c){var d=gf(b,mf);var e=nf(b);var f=Pe(b,mf),g=f.Ra;0==g&&(B("SegmentList@startNumber must be > 0"),g=1);var h=0;f.R?h=f.R*(g-1):f.G&&0<f.G.length&&(h=f.G[0].start);e={R:f.R,startTime:h,Ra:g,ga:f.ga,G:f.G,Oa:e};if(!e.R&&!e.G&&1<e.Oa.length)throw B("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,","but does not specify a segment duration or timeline.",b.u),new J(2,4,4002);if(!e.R&&!b.M.duration&&!e.G&&1==e.Oa.length)throw B("SegmentList does not contain sufficient segment information:",
"the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",b.u),new J(2,4,4002);if(e.G&&0==e.G.length)throw B("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",b.u),new J(2,4,4002);g=f=null;b.fa.id&&b.u.id&&(g=b.fa.id+","+b.u.id,f=c[g]);h=of(b.M.duration,e.Ra,b.u.J,e);f?(f.tc(h),f.ic(b.presentationTimeline.Mb()-b.M.start)):(b.presentationTimeline.Tb(h,b.M.start),f=new W(h),g&&b.cb&&(c[g]=
f));b.cb&&b.M.qc||Xe(f,b.M.duration);return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:f.find.bind(f),getSegmentReference:f.get.bind(f),initSegmentReference:d,ga:e.ga}}function mf(b){return b.Ea}
function of(b,c,d,e){var f=e.Oa.length;e.G&&e.G.length!=e.Oa.length&&(f=Math.min(e.G.length,e.Oa.length),B("The number of items in the segment timeline and the number of segment","URLs do not match, truncating",e.Oa.length,"to",f));for(var g=[],h=e.startTime,k=0;k<f;k++){var l=e.Oa[k],m=jd(d,[l.ge]),n=void 0;n=null!=e.R?h+e.R:e.G?e.G[k].end:h+b;g.push(new U(k+c,h,n,function(b){return b}.bind(null,m),l.start,l.end));h=n}return g}
function nf(b){return[b.u.Ea,b.W.Ea,b.fa.Ea].filter(id.Ba).map(function(b){return T.L(b,"SegmentURL")}).reduce(function(b,d){return 0<b.length?b:d}).map(function(c){c.getAttribute("indexRange")&&!b.Xc&&(b.Xc=!0,B("We do not support the SegmentURL@indexRange attribute on SegmentList.  We only use the SegmentList@duration attribute or SegmentTimeline, which must be accurate."));var d=c.getAttribute("media");c=T.C(c,"mediaRange",T.Yb,{start:0,end:null});return{ge:d,start:c.start,end:c.end}})};function pf(b,c,d,e){var f=qf(b);var g=Pe(b,rf);var h=Qe(b,rf,"media"),k=Qe(b,rf,"index");g={R:g.R,timescale:g.timescale,Ra:g.Ra,ga:g.ga,Jc:g.Jc,G:g.G,sc:h,ub:k};h=g.ub?1:0;h+=g.G?1:0;h+=g.R?1:0;if(0==h)throw A("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",b.u),new J(2,4,4002);1!=h&&(B("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,",
"a SegmentTimeline or a segment duration.",b.u),g.ub?(C("Using the index URL template by default."),g.G=null):C("Using the SegmentTimeline by default."),g.R=null);if(!g.ub&&!g.sc)throw A("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",b.u),new J(2,4,4002);if(g.ub){d=b.u.mimeType.split("/")[1];if("mp4"!=d&&"webm"!=d)throw A("SegmentTemplate specifies an unsupported container type.",b.u),new J(2,4,4006);if("webm"==d&&!f)throw A("SegmentTemplate does not contain sufficient segment information:",
"the SegmentTemplate uses a WebM container,","but does not contain an initialization URL template.",b.u),new J(2,4,4005);e=Oe(g.ub,b.u.id,null,b.bandwidth||null,null);h=jd(b.J.za,b.u.J);e=jd(h,[e]);b=kf(b,c,f,e,0,null,d,g.ga)}else g.R?(e||(b.presentationTimeline.uc(g.R),b.presentationTimeline.vc(b.M.start)),b=sf(b,g)):(e=c=null,b.fa.id&&b.u.id&&(e=b.fa.id+","+b.u.id,c=d[e]),h=tf(b,g),k=!b.cb||!b.M.qc,c?(k&&Xe(new W(h),b.M.duration),c.tc(h),c.ic(b.presentationTimeline.Mb()-b.M.start)):(b.presentationTimeline.Tb(h,
b.M.start),c=new W(h),e&&b.cb&&(d[e]=c)),k&&Xe(c,b.M.duration),b={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:c.find.bind(c),getSegmentReference:c.get.bind(c)});return{createSegmentIndex:b.createSegmentIndex,findSegmentPosition:b.findSegmentPosition,getSegmentReference:b.getSegmentReference,initSegmentReference:f,ga:g.ga}}function rf(b){return b.Ab}
function sf(b,c){var d=b.M.duration,e=c.R,f=c.Ra,g=c.timescale,h=c.sc,k=b.bandwidth||null,l=b.u.id,m=b.u;return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(b){return 0>b||d&&b>=d?null:Math.floor(b/e)},getSegmentReference:function(c){var n=c*e,r=n+e;d&&(r=Math.min(r,d));return 0>r||d&&n>=d?null:new U(c,n,r,function(){var d=jd(b.J.za,m.J),e=Oe(h,l,c+f,k,n*g);return jd(d,[e])},0,null)}}}
function tf(b,c){for(var d=[],e=0;e<c.G.length;e++){var f=e+c.Ra;d.push(new U(f,c.G[e].start,c.G[e].end,function(b,c,d,e,f,n,q){e=jd(e.za,f);b=Oe(b,c,n,d,q);return jd(e,[b]).map(function(b){return b.toString()})}.bind(null,c.sc,b.u.id,b.bandwidth||null,b.J,b.u.J,f,c.G[e].af+c.Jc),0,null))}return d}function qf(b){var c=Qe(b,rf,"initialization");if(!c)return null;var d=b.u.id,e=b.bandwidth||null,f=b.u;return new Ue(function(){var g=Oe(c,d,null,e,null),h=jd(b.J.za,f.J);return jd(h,[g])},0,null)};var X={mb:{},wb:{},kd:function(b,c){X.wb[b]=c}};z("shaka.media.ManifestParser.registerParserByExtension",X.kd);X.ld=function(b,c){X.mb[b]=c};z("shaka.media.ManifestParser.registerParserByMime",X.ld);
X.Ae=function(){var b={};if(fc()){for(var c in X.mb)b[c]=!0;for(var d in X.wb)b[d]=!0}c={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"};d=t(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"]);for(var e=d.next();!e.done;e=d.next())e=e.value,b[e]=fc()?!!X.mb[e]:gc(e);for(var f in c)b[f]=fc()?!!X.wb[f]:gc(c[f]);return b};
X.create=function(b,c,d,e){return u(function g(){var h,k;return y(g,function(g){switch(g.m){case 1:return g.S=2,v(g,X.Od(b,c,d,e),4);case 4:return h=g.O,g["return"](new h);case 2:throw k=ya(g),k.severity=2,k;}})})};
X.Od=function(b,c,d,e){return u(function g(){var h,k,l,m,n;return y(g,function(g){switch(g.m){case 1:h=X;if(e){if(k=h.mb[e.toLowerCase()])return g["return"](k);B("Could not determine manifest type using MIME type ",e)}if(l=h.getExtension(b)){if(m=h.wb[l])return g["return"](m);B("Could not determine manifest type for extension ",l)}else B("Could not find extension for ",b);if(e){g.m=2;break}return v(g,h.Vd(b,c,d),3);case 3:if(e=g.O){if(n=X.mb[e])return g["return"](n);B("Could not determine manifest type using MIME type",
e)}case 2:throw new J(2,4,4E3,b);}})})};X.Vd=function(b,c,d){return u(function f(){var g,h,k;return y(f,function(f){switch(f.m){case 1:return g=Eb([b],d),g.method="HEAD",v(f,c.request(0,g).promise,2);case 2:return h=f.O,k=h.headers["content-type"],f["return"](k?k.toLowerCase():"")}})})};X.getExtension=function(b){b=(new Ta(b)).la.split("/").pop().split(".");return 1==b.length?"":b.pop().toLowerCase()};X.isSupported=function(b,c){return fc()?c in X.mb||X.getExtension(b)in X.wb?!0:!1:!1};function Y(b,c,d){this.f=b;this.l=c;this.h=this.g=Infinity;this.a=1;this.b=this.c=null;this.j=0;this.s=!0;this.i=0;this.v=void 0===d?!0:d}z("shaka.media.PresentationTimeline",Y);Y.prototype.Y=function(){return this.g};Y.prototype.getDuration=Y.prototype.Y;Y.prototype.Qa=function(b){this.g=b};Y.prototype.setDuration=Y.prototype.Qa;Y.prototype.$d=function(){return this.f};Y.prototype.getPresentationStartTime=Y.prototype.$d;Y.prototype.pd=function(b){this.j=b};Y.prototype.setClockOffset=Y.prototype.pd;
Y.prototype.rd=function(b){this.s=b};Y.prototype.setStatic=Y.prototype.rd;Y.prototype.qd=function(b){this.h=b};Y.prototype.setSegmentAvailabilityDuration=Y.prototype.qd;Y.prototype.Qe=function(b){this.l=b};Y.prototype.setDelay=Y.prototype.Qe;Y.prototype.Md=function(){return this.l};Y.prototype.getDelay=Y.prototype.Md;
Y.prototype.Tb=function(b,c){if(0!=b.length){var d=b[b.length-1].endTime+c;this.vc(b[0].startTime+c);this.a=b.reduce(function(b,c){return Math.max(b,c.endTime-c.startTime)},this.a);this.b=Math.max(this.b,d);null!=this.f&&this.v&&(this.f=(Date.now()+this.j)/1E3-this.b-this.a);G("notifySegments:","maxSegmentDuration="+this.a)}};Y.prototype.notifySegments=Y.prototype.Tb;Y.prototype.vc=function(b){this.c=null==this.c?b:Math.min(this.c,b)};Y.prototype.notifyMinSegmentStartTime=Y.prototype.vc;
Y.prototype.uc=function(b){this.a=Math.max(this.a,b);G("notifyNewSegmentDuration:","maxSegmentDuration="+this.a)};Y.prototype.notifyMaxSegmentDuration=Y.prototype.uc;Y.prototype.offset=function(b){null!=this.c&&(this.c+=b);null!=this.b&&(this.b+=b)};Y.prototype.offset=Y.prototype.offset;Y.prototype.$=function(){return Infinity==this.g&&!this.s};Y.prototype.isLive=Y.prototype.$;Y.prototype.hb=function(){return Infinity!=this.g&&!this.s};Y.prototype.isInProgress=Y.prototype.hb;
Y.prototype.Mb=function(){return Infinity==this.h?this.i:Math.max(this.i,this.fb()-this.h)};Y.prototype.getSegmentAvailabilityStart=Y.prototype.Mb;Y.prototype.sd=function(b){this.i=b};Y.prototype.setUserSeekStart=Y.prototype.sd;Y.prototype.fb=function(){return this.$()||this.hb()?Math.min(Math.max(0,(Date.now()+this.j)/1E3-this.a-this.f),this.g):this.g};Y.prototype.getSegmentAvailabilityEnd=Y.prototype.fb;
Y.prototype.sb=function(b){var c=Math.max(this.c,this.i);return Infinity==this.h?c:Math.max(c,Math.min(this.fb()-this.h+b,this.sa()))};Y.prototype.getSafeSeekRangeStart=Y.prototype.sb;Y.prototype.eb=function(){return this.sb(0)};Y.prototype.getSeekRangeStart=Y.prototype.eb;Y.prototype.sa=function(){return Math.max(0,this.fb()-(this.$()||this.hb()?this.l:0))};Y.prototype.getSeekRangeEnd=Y.prototype.sa;Y.prototype.vd=function(){return null==this.f||null!=this.b?!1:!0};
Y.prototype.usingPresentationStartTime=Y.prototype.vd;function uf(b,c,d,e){b=Eb(b,e);if(0!=c||null!=d)b.headers.Range=d?"bytes="+c+"-"+d:"bytes="+c+"-";return b};function vf(){var b=this;this.a=this.b=null;this.f=[];this.c=null;this.j=[];this.h=1;this.l={};this.s=0;this.v=new La(5);this.i=new I(function(){wf(b)});this.g=new Ab}z("shaka.dash.DashParser",vf);p=vf.prototype;p.configure=function(b){this.b=b};p.start=function(b,c){var d=this;return u(function f(){var g;return y(f,function(f){switch(f.m){case 1:return d.f=[b],d.a=c,v(f,xf(d),2);case 2:g=f.O;d.a&&yf(d,g);if(!d.a)throw new J(2,7,7001);return f["return"](d.c)}})})};
p.stop=function(){this.b=this.a=null;this.f=[];this.c=null;this.j=[];this.l={};null!=this.i&&(this.i.stop(),this.i=null);return this.g.destroy()};p.update=function(){xf(this)["catch"](function(b){if(this.a)this.a.onError(b)}.bind(this))};p.onExpirationUpdated=function(){};
function xf(b){var c=Date.now(),d=b.a.networkingEngine.request(0,Eb(b.f,b.b.retryParameters));Bb(b.g,d);return d.promise.then(function(c){if(b.a)return c.uri&&!b.f.includes(c.uri)&&b.f.unshift(c.uri),zf(b,c.data,c.uri)}).then(function(){var d=(Date.now()-c)/1E3;Ma(b.v,1,d);return d})}function Af(b){this.za=b}
function zf(b,c,d){c=T.fd(c,"MPD");if(!c)throw new J(2,4,4001,d);c=Te(c,b.b.retryParameters,b.b.dash.xlinkFailGracefully,d,b.a.networkingEngine);Bb(b.g,c);return c.promise.then(function(c){return Bf(b,c,d)})}
function Bf(b,c,d){return u(function f(){var g,h,k,l,m,n,q,r,x,E,F,L,V,fa,Va,Ob,Fc,sa,lg,mg,bb,ng,og,pg,Gc,qg,rg;return y(f,function(f){switch(f.m){case 1:l=id;m=T;n=[d];q=m.L(c,"Location").map(m.Kb).filter(l.Ba);0<q.length&&(r=jd(n,q),n=b.f=r);x=m.L(c,"BaseURL").map(m.Kb);E=jd(n,x);F=b.b.dash.ignoreMinBufferTime;L=0;F||(L=m.C(c,"minBufferTime",m.ua));b.s=m.C(c,"minimumUpdatePeriod",m.ua,-1);V=m.C(c,"availabilityStartTime",m.we);fa=m.C(c,"timeShiftBufferDepth",m.ua);Va=m.C(c,"suggestedPresentationDelay",
m.ua);Ob=m.C(c,"maxSegmentDuration",m.ua);Fc=c.getAttribute("type")||"static";b.c?sa=b.c.presentationTimeline:(lg=Math.max(b.b.dash.defaultPresentationDelay,1.5*L),mg=null!=Va?Va:lg,sa=new Y(V,mg,b.b.dash.autoCorrectDrift));b.c&&b.c.J?(bb=b.c.J,bb.za=E):bb=new Af(E);ng={cb:"static"!=Fc,presentationTimeline:sa,fa:null,M:null,W:null,u:null,bandwidth:0,Xc:!1,J:bb};for(var sg=ng,hj=[""],Pb=T.C(c,"mediaPresentationDuration",T.ua),Qb=[],Na=0,nb=T.L(c,"Period"),Aa=0;Aa<nb.length;Aa++){var Wa=nb[Aa];Na=T.C(Wa,
"start",T.ua,Na);var ob=T.C(Wa,"duration",T.ua),Ba=null;if(Aa!=nb.length-1){var Hc=T.C(nb[Aa+1],"start",T.ua);null!=Hc&&(Ba=Hc-Na)}else null!=Pb&&(Ba=Pb-Na);Hc=md;Ba&&ob&&Math.abs(Ba-ob)>Hc&&B("There is a gap/overlap between Periods",Wa);null==Ba&&(Ba=ob);Wa=Cf(b,sg,hj,{start:Na,duration:Ba,node:Wa,qc:null==Ba||Aa==nb.length-1});Qb.push(Wa);ob=sg.fa.id;b.j.includes(ob)||(b.j.push(ob),b.c&&(b.a.filterNewPeriod(Wa),b.c.periods.push(Wa)));if(null==Ba){Aa!=nb.length-1&&B("Skipping Period",Aa+1,"and any subsequent Periods:",
"Period",Aa+1,"does not have a valid start time.",Qb[Aa+1]);Na=null;break}Na+=Ba}null==b.c&&b.a.filterAllPeriods(Qb);null!=Pb?(Na!=Pb&&B("@mediaPresentationDuration does not match the total duration of all","Periods."),g=Qb,h=Pb,k=!1):(g=Qb,h=Na,k=!0);og=h;pg=g;sa.rd("static"==Fc);"static"!=Fc&&k||sa.Qa(og||Infinity);(Gc=sa.$())&&!isNaN(b.b.availabilityWindowOverride)&&(fa=b.b.availabilityWindowOverride);null==fa&&(fa=Infinity);sa.qd(fa);sa.uc(Ob||1);if(b.c){f.m=0;break}b.c={J:bb,presentationTimeline:sa,
periods:pg,offlineSessionIds:[],minBufferTime:L||0};if(!sa.vd()){f.m=0;break}qg=m.L(c,"UTCTiming");return v(f,Df(b,E,qg),4);case 4:rg=f.O;if(!b.a)return f["return"]();sa.pd(rg);w(f)}})})}
function Cf(b,c,d,e){c.fa=Ef(e.node,null,d);c.M=e;c.fa.id||(C("No Period ID given for Period with start time "+e.start+",  Assigning a default"),c.fa.id="__shaka_period_"+e.start);T.L(e.node,"EventStream").forEach(b.xe.bind(b,e.start,e.duration));d=T.L(e.node,"AdaptationSet").map(b.ve.bind(b,c)).filter(id.Ba);if(c.cb){c=[];for(var f=t(d),g=f.next();!g.done;g=f.next()){g=t(g.value.Fe);for(var h=g.next();!h.done;h=g.next())c.push(h.value)}if(c.length!=(new Set(c)).size)throw new J(2,4,4018);}var k=
d.filter(function(b){return!b.Ic});d.filter(function(b){return b.Ic}).forEach(function(b){var c=b.streams[0],d=b.Ic;k.forEach(function(b){b.id==d&&b.streams.forEach(function(b){b.trickModeVideo=c})})});c=Ff(k,"video");f=Ff(k,"audio");if(!c.length&&!f.length)throw new J(2,4,4004);f.length||(f=[null]);c.length||(c=[null]);d=[];for(g=0;g<f.length;g++)for(h=0;h<c.length;h++)Gf(b,f[g],c[h],d);b=Ff(k,"text");c=[];for(f=0;f<b.length;f++)c.push.apply(c,b[f].streams);return{startTime:e.start,textStreams:c,
variants:d}}function Ff(b,c){return b.filter(function(b){return b.contentType==c})}
function Gf(b,c,d,e){if(c||d)if(c&&d){var f=c.drmInfos;var g=d.drmInfos;if(f.length&&g.length?0<ad(f,g).length:1){g=ad(c.drmInfos,d.drmInfos);for(var h=0;h<c.streams.length;h++)for(var k=0;k<d.streams.length;k++)f=(d.streams[k].bandwidth||0)+(c.streams[h].bandwidth||0),f={id:b.h++,language:c.language,primary:c.rc||d.rc,audio:c.streams[h],video:d.streams[k],bandwidth:f,drmInfos:g,allowedByApplication:!0,allowedByKeySystem:!0},e.push(f)}}else for(g=c||d,h=0;h<g.streams.length;h++)f=g.streams[h].bandwidth||
0,f={id:b.h++,language:g.language||"und",primary:g.rc,audio:c?g.streams[h]:null,video:d?g.streams[h]:null,bandwidth:f,drmInfos:g.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0},e.push(f)}
p.ve=function(b,c){b.W=Ef(c,b.fa,null);var d=!1,e=T.L(c,"Role"),f=e.map(function(b){return b.getAttribute("value")}).filter(id.Ba),g=void 0,h="text"==b.W.contentType;h&&(g="subtitle");for(var k=0;k<e.length;k++){var l=e[k].getAttribute("schemeIdUri");if(null==l||"urn:mpeg:dash:role:2011"==l)switch(l=e[k].getAttribute("value"),l){case "main":d=!0;break;case "caption":case "subtitle":g=l}}var m=null,n=!1;T.L(c,"EssentialProperty").forEach(function(b){"http://dashif.org/guidelines/trickmode"==b.getAttribute("schemeIdUri")?
m=b.getAttribute("value"):n=!0});k=T.L(c,"Accessibility");var q=new Map;e={};k=t(k);for(l=k.next();!l.done;e={rb:e.rb},l=k.next()){var r=l.value;l=r.getAttribute("schemeIdUri");r=r.getAttribute("value");"urn:scte:dash:cc:cea-608:2015"==l||"urn:scte:dash:cc:cea-708:2015"==l?(e.rb=1,null!=r?r.split(";").forEach(function(b){return function(c){if(c.includes("=")){c=c.split("=");var d=c[0].startsWith("CC")?c[0]:"CC"+c[0];c=c[1].split(",")[0].split(":").pop()}else d="CC"+b.rb,b.rb+=2;q.set(d,P(c))}}(e)):
q.set("CC1","und")):"urn:mpeg:dash:role:2011"==l&&null!=r&&(f.push(r),"captions"==r&&(g="caption"))}if(n)return null;e=T.L(c,"ContentProtection");var x=Ge(e,this.b.dash.customScheme,this.b.dash.ignoreDrmInfo);e=P(c.getAttribute("lang")||"und");l=c.getAttribute("label");k=T.L(c,"Representation");f=k.map(this.ye.bind(this,b,x,g,e,l,d,f,q)).filter(function(b){return!!b});if(0==f.length){if(h)return null;throw new J(2,4,4003);}b.W.contentType&&"application"!=b.W.contentType||(b.W.contentType=Hf(f[0].mimeType,
f[0].codecs),f.forEach(function(c){c.type=b.W.contentType}));f.forEach(function(b){x.drmInfos.forEach(function(c){b.keyId&&c.keyIds.push(b.keyId)})});h=k.map(function(b){return b.getAttribute("id")}).filter(id.Ba);return{id:b.W.id||"__fake__"+this.h++,contentType:b.W.contentType,language:e,rc:d,streams:f,drmInfos:x.drmInfos,Ic:m,Fe:h}};
p.ye=function(b,c,d,e,f,g,h,k,l){b.u=Ef(l,b.W,null);if(!If(b.u))return B("Skipping Representation",b.u),null;b.bandwidth=T.C(l,"bandwidth",T.Xb)||0;var m=b.u.contentType;m="text"==m||"application"==m;try{var n=this.Ge.bind(this);if(b.u.zb)var q=hf(b,n);else if(b.u.Ea)q=lf(b,this.l);else if(b.u.Ab)q=pf(b,n,this.l,!!this.c);else{var r=jd(b.J.za,b.u.J),x=b.M.duration||0;q={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(b){return 0<=b&&b<x?1:null},getSegmentReference:function(b){return 1!=
b?null:new U(1,0,x,function(){return r},0,null)},initSegmentReference:null,ga:0}}}catch(E){if(m&&4002==E.code)return null;throw E;}l=T.L(l,"ContentProtection");l=Je(l,this.b.dash.customScheme,c,this.b.dash.ignoreDrmInfo);return{id:this.h++,originalId:b.u.id,createSegmentIndex:q.createSegmentIndex,findSegmentPosition:q.findSegmentPosition,getSegmentReference:q.getSegmentReference,initSegmentReference:q.initSegmentReference,presentationTimeOffset:q.ga,mimeType:b.u.mimeType,codecs:b.u.codecs,frameRate:b.u.frameRate,
bandwidth:b.bandwidth,width:b.u.width,height:b.u.height,kind:d,encrypted:0<c.drmInfos.length,keyId:l,language:e,label:f,type:b.W.contentType,primary:g,trickModeVideo:null,emsgSchemeIdUris:b.u.emsgSchemeIdUris,roles:h,channelsCount:b.u.wc,closedCaptions:k}};
function wf(b){u(function d(){var e,f;return y(d,function(d){switch(d.m){case 1:return C("Updating manifest..."),e=0,d.S=2,v(d,xf(b),4);case 4:e=d.O;xa(d,3);break;case 2:f=ya(d),b.a&&(f.severity=1,b.a.onError(f));case 3:if(!b.a)return d["return"]();yf(b,e);w(d)}})})}function yf(b,c){0>b.s||b.i.T(Math.max(3,b.s-c,Oa(b.v)))}
function Ef(b,c,d){c=c||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,wc:null};d=d||c.J;var e=T.lb,f=T.Hd,g=T.L(b,"BaseURL").map(T.Kb),h=b.getAttribute("contentType")||c.contentType,k=b.getAttribute("mimeType")||c.mimeType,l=b.getAttribute("codecs")||c.codecs;f=T.C(b,"frameRate",f)||c.frameRate;var m=T.L(b,"InbandEventStream"),n=c.emsgSchemeIdUris.slice();m=t(m);for(var q=m.next();!q.done;q=m.next())q=q.value.getAttribute("schemeIdUri"),n.includes(q)||n.push(q);m=T.L(b,
"AudioChannelConfiguration");m=Jf(m)||c.wc;h||(h=Hf(k,l));return{J:jd(d,g),zb:T.Jb(b,"SegmentBase")||c.zb,Ea:T.Jb(b,"SegmentList")||c.Ea,Ab:T.Jb(b,"SegmentTemplate")||c.Ab,width:T.C(b,"width",e)||c.width,height:T.C(b,"height",e)||c.height,contentType:h,mimeType:k,codecs:l,frameRate:f,emsgSchemeIdUris:n,id:b.getAttribute("id"),wc:m}}
function Jf(b){for(var c=0;c<b.length;++c){var d=b[c],e=d.getAttribute("schemeIdUri");if(e&&(d=d.getAttribute("value")))switch(e){case "urn:mpeg:dash:outputChannelPositionList:2012":return d.trim().split(/ +/).length;case "urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case "urn:dts:dash:audio_channel_configuration:2012":var f=parseInt(d,10);if(!f){B("Channel parsing failure! Ignoring scheme and value",e,d);continue}return f;case "tag:dolby.com,2014:dash:audio_channel_configuration:2011":case "urn:dolby:dash:audio_channel_configuration:2011":f=
parseInt(d,16);if(!f){B("Channel parsing failure! Ignoring scheme and value",e,d);continue}for(b=0;f;)f&1&&++b,f>>=1;return b;default:B("Unrecognized audio channel scheme:",e,d)}}return null}
function If(b){var c=b.zb?1:0;c+=b.Ea?1:0;c+=b.Ab?1:0;if(0==c){if("text"==b.contentType||"application"==b.contentType)return!0;B("Representation does not contain a segment information source:","the Representation must contain one of SegmentBase, SegmentList,",'SegmentTemplate, or explicitly indicate that it is "text".',b);return!1}1!=c&&(B("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,","SegmentList, or SegmentTemplate.",
b),b.zb?(C("Using SegmentBase by default."),b.Ea=null):C("Using SegmentList by default."),b.Ab=null);return!0}
function Kf(b,c,d,e){c=jd(c,[d]);c=Eb(c,b.b.retryParameters);c.method=e;c=b.a.networkingEngine.request(4,c);Bb(b.g,c);return c.promise.then(function(b){if("HEAD"==e){if(!b.headers||!b.headers.date)return B("UTC timing response is missing","expected date header"),0;b=b.headers.date}else b=lc(b.data);b=Date.parse(b);return isNaN(b)?(B("Unable to parse date from UTC timing response"),0):b-Date.now()})}
function Df(b,c,d){d=d.map(function(b){return{scheme:b.getAttribute("schemeIdUri"),value:b.getAttribute("value")}});var e=b.b.dash.clockSyncUri;!d.length&&e&&d.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:e});return id.Fd(d,function(b){var d=b.scheme;b=b.value;switch(d){case "urn:mpeg:dash:utc:http-head:2014":case "urn:mpeg:dash:utc:http-head:2012":return Kf(this,c,b,"HEAD");case "urn:mpeg:dash:utc:http-xsdate:2014":case "urn:mpeg:dash:utc:http-iso:2014":case "urn:mpeg:dash:utc:http-xsdate:2012":case "urn:mpeg:dash:utc:http-iso:2012":return Kf(this,
c,b,"GET");case "urn:mpeg:dash:utc:direct:2014":case "urn:mpeg:dash:utc:direct:2012":return d=Date.parse(b),isNaN(d)?0:d-Date.now();case "urn:mpeg:dash:utc:http-ntp:2014":case "urn:mpeg:dash:utc:ntp:2014":case "urn:mpeg:dash:utc:sntp:2014":return Ra("NTP UTCTiming scheme is not supported"),Promise.reject();default:return Ra("Unrecognized scheme in UTCTiming element",d),Promise.reject()}}.bind(b))["catch"](function(){Ra("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!");
return 0})}p.xe=function(b,c,d){var e=T.lb,f=d.getAttribute("schemeIdUri")||"",g=d.getAttribute("value")||"",h=T.C(d,"timescale",e)||1;T.L(d,"Event").forEach(function(d){var k=T.C(d,"presentationTime",e)||0,m=T.C(d,"duration",e)||0;k=k/h+b;m=k+m/h;null!=c&&(k=Math.min(k,b+c),m=Math.min(m,b+c));d={schemeIdUri:f,value:g,startTime:k,endTime:m,id:d.getAttribute("id")||"",eventElement:d};this.a.onTimelineRegionAdded(d)}.bind(this))};
p.Ge=function(b,c,d){b=uf(b,c,d,this.b.retryParameters);b=this.a.networkingEngine.request(1,b);Bb(this.g,b);return b.promise.then(function(b){return b.data})};function Hf(b,c){return Kd(bc(b,c))?"text":b.split("/")[0]}X.kd("mpd",vf);X.ld("application/dash+xml",vf);function Lf(b,c){this.a=b;this.b=c}Lf.prototype.toString=function(){return"v"+this.a+"."+this.b};function Mf(b,c){var d=new Lf(2,6),e=Nf,f=e.a,g=d.b-f.b;(0<(d.a-f.a||g)?e.c:e.b)(e.a,d,b,c)}function Of(b,c,d,e){Ra([d,"has been deprecated and will be removed in",c,". We are currently at version",b,". Additional information:",e].join(" "))}function Pf(b,c,d,e){Qa([d,"has been deprecated and has been removed in",c,". We are now at version",b,". Additional information:",e].join(""))}var Nf=null;function Qf(){this.a=new Map}function Rf(b,c,d){Sf(b,c).text=d}function Sf(b,c){b.a.has(c)||b.a.set(c,new Tf);return b.a.get(c)}function Tf(){this.text=this.variant=null};function Uf(b,c){this.a=b;this.b=new Set([b]);c=c||[];for(var d=t(c),e=d.next();!e.done;e=d.next())this.add(e.value)}Uf.prototype.add=function(b){if(Vf(this.a,b))return this.b.add(b),!0;B("Rejecting variant - not compatible with root.");return!1};
function Vf(b,c){var d;if(!(d=!!b.audio!=!!c.audio||!!b.video!=!!c.video||b.language!=c.language)&&(d=b.audio&&c.audio)){d=b.audio;var e=c.audio;d=!(d.channelsCount==e.channelsCount&&Wf(d,e)&&Xf(d.roles,e.roles))}!d&&(d=b.video&&c.video)&&(d=b.video,e=c.video,d=!(Wf(d,e)&&Xf(d.roles,e.roles)));return d?!1:!0}Uf.prototype.values=function(){return this.b.values()};
function Wf(b,c){if(b.mimeType!=c.mimeType)return!1;var d=b.codecs.split(",").map(function(b){return ec(b)[0]}),e=c.codecs.split(",").map(function(b){return ec(b)[0]});if(d.length!=e.length)return!1;d.sort();e.sort();for(var f=0;f<d.length;f++)if(d[f]!=e[f])return!1;return!0}function Xf(b,c){var d=new Set(b),e=new Set(c);d["delete"]("main");e["delete"]("main");if(d.size!=e.size)return!1;d=t(d);for(var f=d.next();!f.done;f=d.next())if(!e.has(f.value))return!1;return!0};function Yf(b){this.a=b;this.b=new Zf(b.language,"",b.audio&&b.audio.channelsCount?b.audio.channelsCount:0)}Yf.prototype.create=function(b){var c=this,d=b.filter(function(b){return Vf(c.a,b)});return d.length?new Uf(d[0],d):this.b.create(b)};function Zf(b,c,d){this.c=b;this.b=c;this.a=d}
Zf.prototype.create=function(b){var c=[];c=$f(b,this.c);var d=b.filter(function(b){return b.primary});c=c.length?c:d.length?d:b;this.b&&(b=ag(c,this.b),b.length?c=b:B("No exact match for variant role could be found."));this.a&&(b=re(c,this.a),b.length?c=b:B("No exact match for the channel count could be found."));b=new Uf(c[0]);c=t(c);for(d=c.next();!d.done;d=c.next())d=d.value,Vf(b.a,d)&&b.add(d);return b};
function $f(b,c){var d=P(c),e=fe(d,b.map(function(b){return ee(b)}));return e?b.filter(function(b){return e==ee(b)}):[]}function ag(b,c){return b.filter(function(b){var d=b.audio;b=b.video;return d&&0<=d.roles.indexOf(c)||b&&0<=b.roles.indexOf(c)})};function bg(b,c){this.a=cg;this.b=(new Map).set(cg,c).set(dg,b)}var dg=0,cg=1;function eg(b,c){this.f=b;this.g=fg(b);this.b=b.a.currentTime;this.c=Date.now()/1E3;this.h=c;this.a=function(){}}eg.prototype.release=function(){this.f=null;this.a=function(){}};function gg(b,c){b.a=c}function hg(b){this.a=b}function fg(b){if(b.a.paused||0==b.a.playbackRate||null==b.a.buffered)var c=!1;else a:{c=b.a.buffered;b=b.a.currentTime;for(var d=0;d<c.length;d++){var e=c.start(d),f=c.end(d);if(!(b<e||b>f-.5)){c=!0;break a}}c=!1}return c};function ig(b,c,d,e,f){var g=this;this.a=b;this.v=c;this.s=d;this.j=f;this.f=new O;this.i=!1;this.l=b.readyState;this.c=!1;this.b=e;this.h=!1;this.f.w(b,"waiting",function(){return jg(g)});this.g=(new I(function(){jg(g)})).Ga(.25)}ig.prototype.release=function(){this.f&&(this.f.release(),this.f=null);null!=this.g&&(this.g.stop(),this.g=null);this.b&&(this.b.release(),this.b=null);this.a=this.v=this.j=null};ig.prototype.yc=function(){this.h=!0;jg(this)};
function jg(b){if(0!=b.a.readyState){if(b.a.seeking){if(!b.i)return}else b.i=!1;if(!b.a.paused){b.a.readyState!=b.l&&(b.c=!1,b.l=b.a.readyState);var c=b.s.smallGapLimit,d=b.a.currentTime,e=b.a.buffered;a:{if(e&&e.length&&!(1==e.length&&1E-6>e.end(0)-e.start(0))){var f=ic("Edge/")||ic("Trident/")||ic("Tizen")||ic("CrKey")?.5:.1;for(var g=0;g<e.length;g++)if(e.start(g)>d&&(0==g||e.end(g-1)-d<=f)){f=g;break a}}f=null}if(null==f){if(b.b){b=b.b;e=b.f;d=fg(e);e=e.a.currentTime;f=Date.now()/1E3;if(b.b!=
e||b.g!=d)b.c=f,b.b=e,b.g=d;e=f-b.c;e>=b.h&&d&&b.a(b.b,e)}}else if(0!=f||b.h)if(g=e.start(f),!(g>=b.v.sa())){var h=g-d;c=h<=c;var k=!1;if(!(.001>h)){if(!c&&!b.c){b.c=!0;var l=new M("largegap",{currentTime:d,gapSize:h});l.cancelable=!0;b.j(l);b.s.jumpLargeGaps&&!l.defaultPrevented?k=!0:C("Ignoring large gap at",d,"size",h)}if(c||k)0==f?C("Jumping forward",h,"seconds because of gap before start time of",g):C("Jumping forward",h,"seconds because of gap starting at",e.end(f-1),"and ending at",g),b.a.currentTime=
g}}}}};function kg(b){var c=this;this.c=b;this.a=new Set;this.b=(new I(function(){tg(c,!1)})).Ga(.25)}kg.prototype.release=function(){this.b.stop();for(var b=t(this.a),c=b.next();!c.done;c=b.next())c.value.release();this.a.clear()};function tg(b,c){for(var d=t(b.a),e=d.next();!e.done;e=d.next())e.value.g(b.c.currentTime,c)};function ug(b){var c=[];b=t(b);for(var d=b.next();!d.done;d=b.next()){d=t(d.value.variants);for(var e=d.next();!e.done;e=d.next())c.push(e.value)}return c}function vg(b,c){for(var d=null,e=t(b),f=e.next();!f.done;f=e.next())f=f.value,c>=f.startTime&&(d=f);return d};function wg(b){this.c=b;this.a=null;this.b=function(){}}wg.prototype.release=function(){this.a=this.c=null;this.b=function(){}};wg.prototype.g=function(b){var c=this.a,d=this.c.periods;b=vg(d,b)||d[0];c!=b&&this.b(b);this.a=b};function xg(b,c){b.b=c};function yg(b){var c=this;this.a=b;this.f=!1;this.c=this.a.Lb();this.b=new I(function(){c.a.Zc(.25*c.c)})}yg.prototype.release=function(){this.b&&(this.b.stop(),this.b=null);this.a=null};yg.prototype.set=function(b){this.c=b;zg(this)};function zg(b){b.b.stop();var c=b.f?0:b.c;if(0<=c)try{b.a.Lb()!=c&&b.a.Ec(c);return}catch(d){}b.b.Ga(.25);0!=b.a.Lb()&&b.a.Ec(0)};function Ag(b,c,d){this.a=b;this.f=c;this.g=d;this.h=!1;this.b=new O;this.c=new Bg(b);0<b.readyState?Cg(this,d):Dg(this,d)}Ag.prototype.release=function(){this.b&&(this.b.release(),this.b=null);null!=this.c&&(this.c.release(),this.c=null);this.f=function(){};this.a=null};function Eg(b){return b.h?b.a.currentTime:b.g}function Dg(b,c){b.g=c;b.b.aa(b.a,"loadedmetadata");b.b.ea(b.a,"loadedmetadata",function(){Cg(b,c)})}
function Cg(b,c){.001>Math.abs(b.a.currentTime-c)?Fg(b):(b.b.ea(b.a,"seeking",function(){Fg(b)}),Gg(b.c,0==b.a.currentTime?c:b.a.currentTime))}function Fg(b){b.h=!0;b.b.w(b.a,"seeking",function(){return b.f()})}function Bg(b){var c=this;this.b=b;this.h=10;this.g=this.c=this.f=0;this.a=new I(function(){0>=c.f?(B(["Failed to move playhead from",c.c,"to",c.g].join(" ")),c.a.stop()):c.b.currentTime!=c.c?c.a.stop():(c.b.currentTime=c.g,c.f--)})}
Bg.prototype.release=function(){this.a&&(this.a.stop(),this.a=null);this.b=null};function Gg(b,c){b.c=b.b.currentTime;b.g=c;b.f=b.h;b.b.currentTime=c;b.a.Ga(.1)};function Hg(b){function c(){null==d.c?d.f=!0:(d.b.ea(d.a,"seeking",function(){d.f=!0}),d.a.currentTime=d.c)}var d=this;this.a=b;this.f=!1;this.c=null;this.b=new O;0==this.a.readyState?this.b.ea(this.a,"loadedmetadata",c):c()}Hg.prototype.release=function(){this.b&&(this.b.release(),this.b=null);this.a=null};Hg.prototype.l=function(b){this.c=this.f?this.c:b};Hg.prototype.h=function(){return(this.f?this.a.currentTime:this.c)||0};Hg.prototype.s=function(){};
function Ig(b,c,d,e,f,g){var h=this;this.b=b;this.a=c.presentationTimeline;this.B=c.minBufferTime||0;this.g=d;this.v=f;this.j=null;this.f=new ig(b,c.presentationTimeline,d,Jg(b,d),g);this.c=new Ag(b,function(){a:{var b=h.f;b.i=!0;b.h=!1;b.c=!1;var c=Eg(h.c);b=Kg(h,c);if(.001<Math.abs(b-c)){var d=(new Date).getTime()/1E3;if(!h.j||h.j<d-1){h.j=d;c=h.c;0<c.a.readyState?Gg(c.c,b):Dg(c,b);b=void 0;break a}}G("Seek to "+c);h.v();b=void 0}return b},Lg(this,e));this.i=(new I(function(){if(0!=h.b.readyState&&
!h.b.paused){var b=h.b.currentTime,c=h.a.eb(),d=h.a.sa();3>d-c&&(c=d-3);b<c&&(c=Kg(h,b),C("Jumping forward "+(c-b)+" seconds to catch up with the seek range."),h.b.currentTime=c)}})).Ga(.25)}Ig.prototype.release=function(){this.c&&(this.c.release(),this.c=null);this.f&&(this.f.release(),this.f=null);this.i&&(this.i.stop(),this.i=null);this.b=this.c=this.a=this.g=null;this.v=function(){}};Ig.prototype.l=function(b){var c=this.c;0<c.a.readyState?Gg(c.c,b):Dg(c,b)};
Ig.prototype.h=function(){var b=Eg(this.c);return 0<this.b.readyState&&!this.b.paused?Mg(this,b):b};function Lg(b,c){null==c?c=Infinity>b.a.Y()?b.a.eb():b.a.sa():0>c&&(c=b.a.sa()+c);return Ng(b,Mg(b,c))}Ig.prototype.s=function(){this.f.yc()};function Ng(b,c){var d=b.a.Y();return c>=d?d-b.g.durationBackoff:c}
function Kg(b,c){var d=fd.bind(null,b.b.buffered),e=Math.max(b.B,b.g.rebufferingGoal),f=b.g.safeSeekOffset,g=b.a.eb(),h=b.a.sa(),k=b.a.Y();3>h-g&&(g=h-3);var l=b.a.sb(e),m=b.a.sb(f);e=b.a.sb(e+f);if(c>=k)return G("Playhead past duration."),Ng(b,c);if(c>h)return G("Playhead past end."),h;if(c<g){if(d(m))return G("Playhead before start & start is buffered"),m;G("Playhead before start & start is unbuffered");return e}if(c>=l||d(c))return G("Playhead in safe region or in buffered region."),c;G("Playhead outside safe region & in unbuffered region.");
return e}function Mg(b,c){var d=b.a.eb();if(c<d)return d;d=b.a.sa();return c>d?d:c}function Jg(b,c){if(!c.stallEnabled)return null;var d=c.stallSkip,e=new eg(new hg(b),c.stallThreshold);gg(e,function(c,e){D(["Stall detected at",c,"for",e,"seconds. Seeking forward",d,"seconds."].join(" "));b.currentTime+=d});return e};function Og(){this.b=function(){};this.a=new Set}Og.prototype.release=function(){this.b=function(){};this.a.clear()};function Pg(b,c){b.b=c};function Qg(b){var c=this;this.h=b;this.f=new Map;this.a=function(){};this.b=function(){};this.c=function(){};this.i=[{Ua:null,Ta:Rg,Na:function(b,e){return c.a(b,e)}},{Ua:Sg,Ta:Rg,Na:function(b,e){return c.a(b,e)}},{Ua:Tg,Ta:Rg,Na:function(b,e){return c.a(b,e)}},{Ua:Rg,Ta:Sg,Na:function(b,e){return c.b(b,e)}},{Ua:Rg,Ta:Tg,Na:function(b,e){return c.b(b,e)}},{Ua:Sg,Ta:Tg,Na:function(b,e){return c.c(b,e)}},{Ua:Tg,Ta:Sg,Na:function(b,e){return c.c(b,e)}}]}
Qg.prototype.release=function(){this.h=null;this.f.clear();this.a=function(){};this.b=function(){};this.c=function(){}};Qg.prototype.g=function(b,c){for(var d=t(this.h.a),e=d.next();!e.done;e=d.next()){e=e.value;var f=this.f.get(e),g=b<e.startTime?Sg:b>e.endTime?Tg:Rg;this.f.set(e,g);for(var h=t(this.i),k=h.next();!k.done;k=h.next())k=k.value,k.Ua==f&&k.Ta==g&&k.Na(e,c)}};function Ug(b,c,d,e){b.a=c;b.b=d;b.c=e}var Sg=1,Rg=2,Tg=3;function Vg(b,c){this.a=c;this.c=b;this.g=null;this.j=1;this.v=Promise.resolve();this.h=[];this.i=new Map;this.b=new Map;this.s=!1;this.N=null;this.I=this.f=this.l=!1;this.B=0}Vg.prototype.destroy=function(){for(var b=t(this.b.values()),c=b.next();!c.done;c=b.next())Wg(c.value);this.b.clear();this.i.clear();this.g=this.h=this.v=this.c=this.a=null;this.f=!0;return Promise.resolve()};
Vg.prototype.configure=function(b){this.g=b;this.N=new jb({maxAttempts:Math.max(b.retryParameters.maxAttempts,2),baseDelay:b.retryParameters.baseDelay,backoffFactor:b.retryParameters.backoffFactor,fuzzFactor:b.retryParameters.fuzzFactor,timeout:0},!0)};
Vg.prototype.start=function(){var b=this;return u(function d(){var e,f,g;return y(d,function(d){switch(d.m){case 1:return e=b.a.Aa(),f=Xg(b,e),g=b.a.bd(b.c.periods[f]),g.variant||g.text?v(d,Yg(b,g.variant?g.variant.audio:null,g.variant?g.variant.video:null,g.text,e),2):(A("init: no Streams chosen"),d["return"](new J(2,5,5005)));case 2:if(b.f)return d["return"]();D("init: completed initial Stream setup");b.a&&b.a.je&&(G("init: calling onInitialStreamsSetup()..."),b.a.je());w(d)}})})};
function Zg(b){return $g(b,"audio")}function ah(b){return $g(b,"video")}function $g(b,c){var d=b.b.get(c);return d?d.Da||d.stream:null}
function bh(b,c){return u(function e(){var f,g,h,k,l,m,n,q,r,x;return y(e,function(e){switch(e.m){case 1:return f=ld,v(e,Yd(b.a.A,f.Ja),2);case 2:return b.B++,b.I=!1,g=b.B,h=b.a.A,k=new Map,l=new Set,k.set(f.Ja,c),l.add(c),v(e,h.init(k,!1),3);case 3:return b.f?e["return"]():v(e,ch(b,l),4);case 4:if(b.f)return e["return"]();n=(m=b.a.A.g.isTextVisible())||b.g.alwaysStreamText;b.B!=g||b.b.has(f.Ja)||b.I||!n||(q=b.a.Aa(),r=Xg(b,q),x=dh(c,r,0),b.b.set(f.Ja,x),eh(b,x,0));w(e)}})})}
function fh(b,c){var d=b.b.get("video");if(d){var e=d.stream;if(e)if(D("setTrickPlay",c),c){var f=e.trickModeVideo;f&&!d.Da&&(D("Engaging trick mode stream",f),gh(b,f,!1,0,!1),d.Da=e)}else if(e=d.Da)D("Restoring non-trick-mode stream",e),d.Da=null,gh(b,e,!0,0,!1)}}function hh(b,c,d,e){c.video&&gh(b,c.video,d,e,!1);c.audio&&gh(b,c.audio,d,e,!1)}
function gh(b,c,d,e,f){var g=b.b.get(c.type);if(!g&&"text"==c.type&&b.g.ignoreTextStreamFailures)bh(b,c);else if(g){var h=ih(b,c),k=Array.from(b.b.values()).every(function(b){return b.ka==g.ka});d&&h!=g.ka&&k?(D("switch: switching to stream in another Period; clearing buffer and changing Periods"),b.b.forEach(function(c){jh(b,c)})):(g.Da&&(D("switch during trick play mode",c),c.trickModeVideo?(g.Da=c,c=c.trickModeVideo,D("switch found trick play stream",c)):(g.Da=null,D("switch found no special trick play stream"))),
(k=b.h[h])&&k.pb&&(k=b.i.get(c.id))&&k.pb&&(g.stream!=c||f?("text"==c.type&&Qd(b.a.A,bc(c.mimeType,c.codecs)),g.stream=c,g.Qb=!0,D("switch: switching to Stream "+kh(g)),c=lh(b,g,h),mh(b,g,h)&&(C("Aborting current segment request to switch."),g.vb.abort(),h=b.c.periods[h],c&&b.a.A.remove(g.type,c.startTime+h.startTime,c.endTime+h.startTime)),d&&(g.Ka?g.$b=!0:g.Ca?(g.Ia=!0,g.Hb=e,g.$b=!0):(Wg(g),nh(b,g,!0,e)["catch"](function(c){if(b.a)b.a.onError(c)})))):D("switch: Stream "+kh(g)+" already active")))}}
function lh(b,c,d){if(!c.vb)return null;var e=b.a.Aa(),f=Ud(b.a.A,c.type);return oh(b,c,e,f,d)}
function mh(b,c,d){var e=lh(b,c,d);if(!e)return!1;var f=e?e.a?e.a-e.b:null:null;d=b.c.periods[d];var g=e.Nb()+d.startTime;d=b.a.Aa();if(d>g)return!1;null==f&&(f=(e.endTime-e.Nb())*c.stream.bandwidth/8);if(isNaN(f))return!1;(e=c.stream.initSegmentReference)&&(f+=(e.a?e.a-e.b:null)||0);e=b.a.getBandwidthEstimate();e=8*f/e;d=Ud(b.a.A,c.type)-d;return e<d-Math.max(b.c.minBufferTime||0,b.g.rebufferingGoal)||c.vb.b.a>f?!0:!1}
function ph(b){function c(c){var f=b.a.A;"text"==c?(c=f.a,c=null==c.a||null==c.b?!1:d>=c.a&&d<c.b):(c=Td(f,c),c=fd(c,d,e));return c}var d=b.a.Aa(),e=b.g.smallGapLimit,f=!1,g=Xg(b,d);if(Zb(b.b.values(),function(b){return b.ka==g}))for(var h=t(b.b.keys()),k=h.next();!k.done;k=h.next())k=k.value,c(k)||(jh(b,b.b.get(k)),f=!0);else Zb(b.b.keys(),c)||(D("(all): seeked: unbuffered seek: clearing all buffers"),b.b.forEach(function(c){jh(b,c)}),f=!0);f||D("(all): seeked: buffered seek: presentationTime="+
d)}function jh(b,c){var d=kh(c);c.Ka?D(d,"clear: already clearing the buffer"):c.Ia?D(d,"clear: already waiting"):c.Ca?(D(d,"clear: currently updating"),c.Ia=!0,c.Hb=0):null==Sd(b.a.A,c.type)?(D(d,"clear: nothing buffered"),null==c.wa&&eh(b,c,0)):(D(d,"clear: handling right now"),Wg(c),nh(b,c,!1,0)["catch"](function(c){if(b.a)b.a.onError(c)}))}
function Yg(b,c,d,e,f){return u(function h(){var k,l,m,n,q,r,x;return y(h,function(h){switch(h.m){case 1:return k=b.a.Aa(),l=Xg(b,k),m=ld,n=new Map,q=new Set,c&&(n.set(m.wd,c),q.add(c)),d&&(n.set(m.Kc,d),q.add(d)),e&&(n.set(m.Ja,e),q.add(e)),r=b.a.A,x=b.g.forceTransmuxTS,v(h,r.init(n,x),2);case 2:if(b.f)return h["return"]();qh(b);return v(h,ch(b,q),3);case 3:if(b.f)return h["return"]();n.forEach(function(c,d){if(!b.b.has(d)){var e=dh(c,l,f);b.b.set(d,e);eh(b,e,0)}});w(h)}})})}
function dh(b,c,d){return{stream:b,type:b.type,ib:null,ta:null,Da:null,Qb:!0,ka:c,endOfStream:!1,Ca:!1,wa:null,Ia:!1,Hb:0,$b:!1,Ka:!1,Ac:!1,tb:!1,nd:d||0,vb:null}}
function rh(b,c){var d=b.h[c];if(d)return D("(all) Period "+c+" is being or has been set up"),d.promise;D("(all) setting up Period "+c);d={promise:new mb,pb:!1};b.h[c]=d;for(var e=new Set,f=t(b.c.periods[c].variants),g=f.next();!g.done;g=f.next())g=g.value,g.video&&e.add(g.video),g.video&&g.video.trickModeVideo&&e.add(g.video.trickModeVideo),g.audio&&e.add(g.audio);f=t(b.c.periods[c].textStreams);for(g=f.next();!g.done;g=f.next())e.add(g.value);b.v=b.v.then(function(){if(!this.f)return ch(this,e)}.bind(b)).then(function(){this.f||
(this.h[c].promise.resolve(),this.h[c].pb=!0,G("(all) setup Period "+c))}.bind(b))["catch"](function(b){this.f||(this.h[c].promise["catch"](function(){}),this.h[c].promise.reject(),delete this.h[c],B("(all) failed to setup Period "+c),this.a.onError(b))}.bind(b));return d.promise}
function ch(b,c){return u(function e(){var f,g,h,k,l,m,n;return y(e,function(e){switch(e.m){case 1:f=[];for(var q=t(c),x=q.next();!x.done;x=q.next())g=x.value,(h=b.i.get(g.id))?(D("(all) Stream "+g.id+" is being or has been set up"),f.push(h.promise)):(G("(all) setting up Stream "+g.id),b.i.set(g.id,{promise:new mb,pb:!1}),f.push(g.createSegmentIndex()));e.S=2;return v(e,Promise.all(f),4);case 4:if(b.f)return e["return"]();xa(e,3);break;case 2:k=ya(e);if(b.f)return e["return"]();e=t(c);for(x=e.next();!x.done;x=
e.next())l=x.value,b.i.get(l.id).promise["catch"](function(){}),b.i.get(l.id).promise.reject(),b.i["delete"](l.id);throw k;case 3:q=t(c);for(x=q.next();!x.done;x=q.next())m=x.value,n=b.i.get(m.id),n.pb||(n.promise.resolve(),n.pb=!0,G("(all) setup Stream "+m.id));w(e)}})})}function qh(b){var c=b.c.presentationTimeline.Y();Infinity>c?b.a.A.Qa(c):b.a.A.Qa(Math.pow(2,32))}
function sh(b,c){if(!b.f){var d=kh(c);if(!c.Ca&&null!=c.wa&&!c.Ka)if(c.wa=null,c.Ia)D(d,"skipping update and clearing the buffer"),nh(b,c,c.$b,c.Hb);else{try{var e=th(b,c);null!=e&&(eh(b,c,e),c.tb=!1)}catch(f){uh(b,f);return}e=Array.from(b.b.values());vh(b,c);b.s&&e.every(function(b){return b.endOfStream})&&(G(d,"calling endOfStream()..."),b.a.A.endOfStream().then(function(){if(!this.f){var b=this.a.A.Y();0!=b&&b<this.c.presentationTimeline.Y()&&this.c.presentationTimeline.Qa(b)}}.bind(b)))}}}
function th(b,c){if(wh(c))return b.a.A.Zb(c.stream.originalId||""),null;var d=kh(c),e=b.a.Aa(),f=xh(b,c,e);H(d,"timeNeeded="+f);var g=ih(b,c.stream),h=Xg(b,f),k=Vd(b.a.A,c.type,e);H(d,"update_:","presentationTime="+e,"bufferedAhead="+k);var l=Math.max(b.c.minBufferTime||0,b.g.rebufferingGoal,b.g.bufferingGoal)*b.j;if(f>=b.c.presentationTimeline.Y())return D(d,"buffered to end of presentation"),c.endOfStream=!0,"video"==c.type&&(f=b.b.get("text"))&&"application/cea-608"==f.stream.mimeType&&(f.endOfStream=
!0),null;c.endOfStream=!1;c.ka=h;if(h!=g)return D(d,"need Period "+h,"presentationTime="+e,"timeNeeded="+f,"currentPeriodIndex="+g),null;if(k>=l)return H(d,"buffering goal met"),.5;d=Ud(b.a.A,c.type);d=oh(b,c,e,d,g);if(!d)return 1;var m=Infinity;Array.from(b.b.values()).forEach(function(c){wh(c)||(c=xh(b,c,e),m=Math.min(m,c))});if(f>=m+b.c.presentationTimeline.a)return 1;c.nd=0;yh(b,c,e,g,d);return null}
function xh(b,c,d){if(!c.ib||!c.ta)return Math.max(d,c.nd);d=ih(b,c.ib);return b.c.periods[d].startTime+c.ta.endTime}
function oh(b,c,d,e,f){var g=kh(c);if(c.ta&&c.stream==c.ib)return e=c.ta.position+1,H(g,"next position known:","position="+e),zh(b,c,f,e);c.ta?(G(g,"next position unknown: another Stream buffered"),g=ih(b,c.ib),g=Ah(b,c,b.c.periods[g].startTime+c.ta.endTime,f)):(G(g,"next position unknown: nothing buffered"),g=Ah(b,c,e||d,f));if(null==g)return null;d=null;null==e&&(d=zh(b,c,f,Math.max(0,g-1)));return d||zh(b,c,f,g)}
function Ah(b,c,d,e){var f=kh(c);b=b.c.periods[e];D(f,"looking up segment:","presentationTime="+d,"currentPeriod.startTime="+b.startTime);d=Math.max(0,d-b.startTime);c=c.stream.findSegmentPosition(d);null==c&&B(f,"cannot find segment:","currentPeriod.startTime="+b.startTime,"lookupTime="+d);return c}
function zh(b,c,d,e){var f=kh(c);d=b.c.periods[d];c=c.stream.getSegmentReference(e);if(!c)return G(f,"segment does not exist:","currentPeriod.startTime="+d.startTime,"position="+e),null;e=b.c.presentationTimeline;b=e.Mb();e=e.fb();return d.startTime+c.endTime<b||d.startTime+c.startTime>e?(H(f,"segment is not available:","currentPeriod.startTime="+d.startTime,"reference.startTime="+c.startTime,"reference.endTime="+c.endTime,"availabilityStart="+b,"availabilityEnd="+e),null):c}
function yh(b,c,d,e,f){function g(b,c){b.fileStart=x;x=r.appendBuffer(b,c)}var h=kh(c)+("#"+f.position),k=b.c.periods[e];G(h,"fetchAndAppend_:","presentationTime="+d,"currentPeriod.startTime="+k.startTime,"reference.position="+f.position,"reference.startTime="+f.startTime,"reference.endTime="+f.endTime);var l=c.stream,m=b.c.presentationTimeline.Y(),n=b.c.periods[e+1],q=Bh(b,c,e,Math.max(0,k.startTime-.1),n?n.startTime+.01:m);c.Ca=!0;c.Qb=!1;H(h,"fetching segment");var r=window.MP4Box.createFile(),
x=0,E=0;r.onReady=function(b){r.setSegmentOptions(b.tracks[0].id,null,{nbSamples:1});r.initializeSegmentation();r.start()};r.onError=function(b){throw b;};r.onSegment=function(e,g,h){F=F.then(function(){if(b.f||b.l)return Promise.resolve();var e=l.emsgSchemeIdUris;if(null!=e&&0<e.length)for(var g=r.boxes||[];E<g.length;){var m=g[E];E++;if("emsg"===m.type){var n=b,q=m.scheme_id_uri,x=m.value,L=m.timescale,F=m.presentation_time_delta,V=m.event_duration,fa=m.id;m=m.message_data;var Gc=k.startTime+f.startTime+
F/L;if(e.includes(q))if("urn:mpeg:dash:event:2012"==q)n.a.ke();else n.a.onEvent(new M("emsg",{detail:{startTime:Gc,endTime:Gc+V/L,schemeIdUri:q,value:x,timescale:L,presentationTimeDelta:F,eventDuration:V,id:fa,messageData:m}}))}}return l.encrypted?Promise.resolve():Ch(b,c,d,k,l,f,h)})};var F=q.then(function(){var b=c.stream.initSegmentReference.data;b&&g(b,!1)});Dh(b,c,f,function(c,d,e,k){if(!b.f&&!b.l&&k){H(h,"#"+f.position+" appending "+k.byteLength+" bytes to mp4box, last="+(0===e));var l=k.buffer;
q.then(function(){g(l,0===e)})}}).then(function(c){if(!b.f&&!b.l)return F.then(function(){return c})}).then(function(e){if(l.encrypted)return Ch(b,c,d,k,l,f,e)}).then(function(){this.f||this.l||(c.Ca=!1,c.Ac=!1,c.ib=l,c.ta=f,c.Ia||this.a.yc(),eh(this,c,0),Eh(this,c,l),G(h,"finished fetch and append"))}.bind(b))["catch"](function(b){this.f||this.l||(c.Ca=!1,"text"==c.type&&this.g.ignoreTextStreamFailures?(1001==b.code?B(h,"Text stream failed to download. Proceeding without it."):B(h,"Text stream failed to parse. Proceeding without it."),
this.b["delete"]("text")):7001==b.code?(c.Ca=!1,c.wa=null,eh(this,c,0)):3017==b.code?Fh(this,c,b):(A(h,"failed fetch and append: code="+b.code),c.tb=!0,b.severity=2,uh(this,b)))}.bind(b)).then(function(){r.stop()})}
function Fh(b,c,d){var e=kh(c);if(Array.from(b.b.values()).some(function(b){return b!=c&&b.Ac}))D(e,"MediaSource threw QuotaExceededError:","waiting for another stream to recover...");else{var f=Math.round(100*b.j);if(20<f)b.j-=.2;else if(4<f)b.j-=.04;else{A(e,"MediaSource threw QuotaExceededError too many times");c.tb=!0;b.l=!0;b.a.onError(d);return}B(e,"MediaSource threw QuotaExceededError:","reducing buffering goals by "+(100-Math.round(100*b.j))+"%");c.Ac=!0}eh(b,c,4)}
function Bh(b,c,d,e,f){if(!c.Qb)return Promise.resolve();var g=kh(c);d=b.c.periods[d].startTime-c.stream.presentationTimeOffset;G(g,"setting timestamp offset to "+d);G(g,"setting append window start to "+e);G(g,"setting append window end to "+f);e=Zd(b.a.A,c.type,d,e,f);if(!c.stream.initSegmentReference)return e;G(g,"fetching init segment");b=Dh(b,c,c.stream.initSegmentReference).then(function(b){if(!this.f)return c.stream.initSegmentReference.data=b,G(g,"appending init segment"),Wd(this.a.A,c.type,
b,null,null,c.stream.closedCaptions&&0<c.stream.closedCaptions.size)}.bind(b))["catch"](function(b){c.Qb=!0;return Promise.reject(b)});return Promise.all([e,b])}function Ch(b,c,d,e,f,g,h){var k=kh(c),l=f.closedCaptions&&0<f.closedCaptions.size;return Gh(b,c,d).then(function(){if(!this.f)return G(k,"appending media segment"),Wd(this.a.A,c.type,h,g.startTime+e.startTime,g.endTime+e.startTime,l)}.bind(b)).then(function(){if(!this.f)return H(k,"appended media segment"),Promise.resolve()}.bind(b))}
function Gh(b,c,d){var e=kh(c);H(e,"checking buffer length");var f=Math.max(b.g.bufferBehind,b.c.presentationTimeline.a),g=Sd(b.a.A,c.type);if(null==g)return H(e,"buffer behind okay because nothing buffered:","presentationTime="+d,"bufferBehind="+f),Promise.resolve();var h=d-g,k=h-f;if(0>=k)return H(e,"buffer behind okay:","presentationTime="+d,"bufferedBehind="+h,"bufferBehind="+f,"underflow="+-k),Promise.resolve();G(e,"buffer behind too large:","presentationTime="+d,"bufferedBehind="+h,"bufferBehind="+
f,"overflow="+k);return b.a.A.remove(c.type,g,g+k).then(function(){this.f||G(e,"evicted "+k+" seconds")}.bind(b))}
function Eh(b,c,d){if(!b.s){var e=kh(c);c=Array.from(b.b.values());if(1!=c.length||"text"!=c[0].type)b.s=c.every(function(b){return"text"==b.type?!0:!b.Ia&&!b.Ka&&b.ta});if(b.s){D(e,"startup complete");d=ih(b,d);b.h[d]||rh(b,d).then(function(){this.f||(G(e,"calling onCanSwitch()..."),this.a.ad())}.bind(b))["catch"](id.Sb);for(d=0;d<b.c.periods.length;++d)rh(b,d)["catch"](id.Sb);b.a.qe&&(G(e,"calling onStartupComplete()..."),b.a.qe())}}}
function vh(b,c){var d=kh(c),e=ih(b,c.stream);if(c.ka!=e){var f=c.ka,g=Array.from(b.b.values());g.every(function(b){return b.ka==f||wh(b)})?g.every(Hh)?(D(d,"all need Period "+f),rh(b,f).then(function(){if(!this.f)if(g.every(function(b){var c=Hh(b),d=ih(this,b.stream);return wh(b)?!0:c&&b.ka==f&&d!=f}.bind(this))){var b=this.c.periods[f];G(d,"calling onChooseStreams()...");var c=this.a.bd(b),e=new Map;c.variant&&c.variant.video&&e.set("video",c.variant.video);c.variant&&c.variant.audio&&e.set("audio",
c.variant.audio);c.text&&e.set("text",c.text);var m=t(this.b.keys());for(c=m.next();!c.done;c=m.next())if(c=c.value,!e.has(c)&&"text"!=c){A(d,"invalid Streams chosen: missing "+c+" Stream");this.a.onError(new J(2,5,5005));return}m=t(Array.from(e.keys()));for(c=m.next();!c.done;c=m.next())if(c=c.value,!this.b.has(c))if("text"==c)Yg(this,null,null,e.get("text"),b.startTime),e["delete"](c);else{A(d,"invalid Streams chosen: unusable "+c+" Stream");this.a.onError(new J(2,5,5005));return}b=t(Array.from(this.b.keys()));
for(c=b.next();!c.done;c=b.next())c=c.value,(m=e.get(c))?(gh(this,m,!1,0,!1),eh(this,this.b.get(c),0)):this.b["delete"](c);G(d,"calling onCanSwitch()...");this.a.ad()}else D(d,"ignoring transition to Period",f,"since another is happening")}.bind(b))["catch"](id.Sb)):D(d,"all MediaStates need Period "+f+", but not all MediaStates are idle"):D(d,"not all MediaStates need Period "+f)}}function wh(b){return"text"==b.type&&"application/cea-608"==b.stream.mimeType}
function Hh(b){return!b.Ca&&null==b.wa&&!b.Ia&&!b.Ka}function Xg(b,c){var d=vg(b.c.periods,c+md);return d?b.c.periods.indexOf(d):0}function ih(b,c){for(var d=b.c.periods,e=0;e<d.length;e++){for(var f=d[e],g=new Set,h=t(f.variants),k=h.next();!k.done;k=h.next())k=k.value,k.audio&&g.add(k.audio),k.video&&g.add(k.video),k.video&&k.video.trickModeVideo&&g.add(k.video.trickModeVideo);f=t(f.textStreams);for(h=f.next();!h.done;h=f.next())g.add(h.value);if(g.has(c))return e}return-1}
function Dh(b,c,d,e){var f=uf(d.c(),d.b,d.a,b.g.retryParameters);H("fetching: reference=",d);b=b.a.Rb.request(1,f,e);c.vb=b;return b.promise.then(function(b){c.vb=null;return b.data})}
function nh(b,c,d,e){return u(function g(){var h,k,l,m;return y(g,function(g){switch(g.m){case 1:return h=kh(c),c.Ia=!1,c.$b=!1,c.Hb=0,c.Ka=!0,D(h,"clearing buffer"),e?(l=b.a.Aa(),m=b.a.A.Y(),k=b.a.A.remove(c.type,l+e,m)):k=Yd(b.a.A,c.type).then(function(){if(!this.f&&d)return this.a.A.flush(c.type)}.bind(b)),v(g,k,2);case 2:if(b.f)return g["return"]();D(h,"cleared buffer");c.ib=null;c.ta=null;c.Ka=!1;c.endOfStream=!1;eh(b,c,0);w(g)}})})}
function eh(b,c,d){H(kh(c),"updating in "+d+" seconds");c.wa=(new ib(function(){return u(function f(){var d;return y(f,function(f){switch(f.m){case 1:return f.S=2,v(f,sh(b,c),4);case 4:xa(f,0);break;case 2:d=ya(f);if(b.a)b.a.onError(d);w(f)}})})})).T(d)}function Wg(b){null!=b.wa&&(b.wa.stop(),b.wa=null)}function uh(b,c){lb(b.N).then(function(){this.f||(this.a.onError(c),c.handled||this.g.failureCallback(c))}.bind(b))}function kh(b){return"("+b.type+":"+b.stream.id+")"};function Ih(b,c,d,e,f,g){if(200<=d&&299>=d&&202!=d)return{uri:f||e,lf:e,data:c,headers:b,fromCache:!!b["x-shaka-from-cache"]};f=null;try{f=nc(c)}catch(h){}D("HTTP error text:",f);throw new J(401==d||403==d?2:1,1,1001,e,d,f,b,g);};function Jh(b,c,d,e){var f=new Jh.b;$b(c.headers).forEach(function(b,c){f.append(c,b)});var g=new Jh.a,h={Lc:!1,ud:!1};b=Jh.h(b,d,{body:c.body||void 0,headers:f,method:c.method,signal:g.signal,credentials:c.allowCrossSiteCredentials?"include":void 0},h,e);b=new K(b,function(){h.Lc=!0;g.abort();return Promise.resolve()});if(c=c.retryParameters.timeout){var k=new I(function(){h.ud=!0;g.abort()});k.T(c/1E3);b["finally"](function(){k.stop()})}return b}z("shaka.net.HttpFetchPlugin",Jh);
Jh.h=function(b,c,d,e,f){return u(function h(){var k,l,m,n,q,r,x,E,F,L,V,fa,Va,Ob;return y(h,function(h){switch(h.m){case 1:return k=Jh.g,l=Jh.c,r=q=0,x=Date.now(),h.S=2,v(h,k(b,d),4);case 4:return m=h.O,E=m.clone().body.getReader(),L=(F=m.headers.get("Content-Length"))?parseInt(F,10):0,V=function(b){function c(){return u(function bb(){var d,e,h,k,l,m;return y(bb,function(n){switch(n.m){case 1:return n.S=2,v(n,E.read(),4);case 4:d=n.O;xa(n,3);break;case 2:return e=ya(n),G("error reading from stream",
e.message),n["return"]();case 3:d.done||(q+=d.value.byteLength),h=Date.now(),k=q-r,l=h-x,m=L-q,f(l,k,m,d.value),r=q,x=h,d.done?b.close():(b.enqueue(d.value),c()),w(n)}})})}c()},new l({start:V}),v(h,m.arrayBuffer(),5);case 5:n=h.O;xa(h,3);break;case 2:fa=ya(h);if(e.Lc)throw new J(1,1,7001,b,c);if(e.ud)throw new J(1,1,1003,b,c);throw new J(1,1,1002,b,fa,c);case 3:return Va={},Ob=m.headers,Ob.forEach(function(b,c){Va[c.trim()]=b}),h["return"](Ih(Va,n,m.status,b,m.url,c))}})})};
Jh.isSupported=function(){if(window.ReadableStream)try{new ReadableStream({})}catch(b){return!1}else return!1;return!(!window.fetch||!window.AbortController)};Jh.isSupported=Jh.isSupported;Jh.g=window.fetch;Jh.a=window.AbortController;Jh.c=window.ReadableStream;Jh.b=window.Headers;Jh.isSupported()&&(Db("http",Jh,2),Db("https",Jh,2));function Kh(b,c,d,e){var f=new Kh.f,g=Date.now(),h=0,k=new Promise(function(k,m){f.open(c.method,b,!0);f.responseType="arraybuffer";f.timeout=c.retryParameters.timeout;f.withCredentials=c.allowCrossSiteCredentials;f.onabort=function(){m(new J(1,1,7001,b,d))};f.onload=function(c){c=c.target;var e=c.getAllResponseHeaders().trim().split("\r\n"),f={};e=t(e);for(var g=e.next();!g.done;g=e.next())g=g.value.split(": "),f[g[0].toLowerCase()]=g.slice(1).join(": ");try{var h=Ih(f,c.response,c.status,b,c.responseURL,
d);k(h)}catch(L){m(L)}};f.onerror=function(c){m(new J(1,1,1002,b,c,d))};f.ontimeout=function(){m(new J(1,1,1003,b,d))};f.onprogress=function(b){var c=Date.now();if(100<c-g||b.lengthComputable&&b.loaded==b.total)e(c-g,b.loaded-h,b.total-b.loaded),h=b.loaded,g=c};for(var l in c.headers)f.setRequestHeader(l.toLowerCase(),c.headers[l]);f.send(c.body)});return new K(k,function(){f.abort();return Promise.resolve()})}z("shaka.net.HttpXHRPlugin",Kh);Kh.f=window.XMLHttpRequest;Db("http",Kh,1);
Db("https",Kh,1);function Lh(b,c){var d=Mh(),e=this;this.g=c;this.c=b;this.i=d;this.h=null;this.f=[];this.b=this.a=null;this.j=!0;this.l=Promise.resolve().then(function(){return Nh(e)})}Lh.prototype.destroy=function(){var b=this;return u(function d(){var e;return y(d,function(d){switch(d.m){case 1:return b.j=!1,b.b&&b.b.abort(),Oh(b),v(d,b.l,2);case 2:b.a&&b.a.oa.Pa();for(var f=t(b.f),h=f.next();!h.done;h=f.next())e=h.value,e.oa.Pa();b.a=null;b.f=[];b.g=null;w(d)}})})};
function Ph(b,c){var d={jb:function(){},Ub:function(){},Pa:function(){},onError:function(){},Vb:function(){},kf:function(){}};b.f.push({create:c,oa:d});b.b&&b.b.abort();Oh(b);return d}
function Nh(b){return u(function d(){return y(d,function(d){switch(d.m){case 1:if(b.j){if(0==b.f.length||b.a&&!b.a.Ma)var e=!1;else{b.a&&(b.a.oa.Pa(),b.a=null);e=b.f.shift();var g=e.create(b.i);g?(e.oa.jb(),b.a={node:g.node,payload:g.payload,Ma:g.Ma,oa:e.oa}):e.oa.Vb();e=!0}e?e=Promise.resolve():b.a?e=Qh(b):(b.g.ie(b.c),b.h=new mb,e=b.h);return v(d,e,1)}d.m=0}})})}
function Qh(b){return u(function d(){var e,f;return y(d,function(d){switch(d.m){case 1:return b.c=b.g.Xd(b.c,b.i,b.a.node,b.a.payload),d.S=2,b.b=b.g.Gd(b.c,b.i,b.a.payload),v(d,b.b.promise,4);case 4:b.b=null;b.c==b.a.node&&(b.a.oa.Ub(),b.a=null);xa(d,0);break;case 2:e=ya(d);if(7001==e.code)b.a.oa.Pa();else b.a.oa.onError(e);b.a=null;b.b=null;f=b;return v(d,b.g.handleError(b.i,e),5);case 5:f.c=d.O,w(d)}})})}function Oh(b){b.h&&(b.h.resolve(),b.h=null)};function Rh(b){this.a=null;for(var c=0;c<b.textTracks.length;++c){var d=b.textTracks[c];d.mode="disabled";"Shaka Player TextTrack"==d.label&&(this.a=d)}this.a||(this.a=b.addTextTrack("subtitles","Shaka Player TextTrack"));this.a.mode="hidden"}z("shaka.text.SimpleTextDisplayer",Rh);Rh.prototype.remove=function(b,c){if(!this.a)return!1;Sh(this.a,function(d){return d.startTime<c&&d.endTime>b});return!0};Rh.prototype.remove=Rh.prototype.remove;
Rh.prototype.append=function(b){for(var c=Th,d=[],e=0;e<b.length;e++){var f=c(b[e]);f&&d.push(f)}d.slice().sort(function(b,c){return b.startTime!=c.startTime?b.startTime-c.startTime:b.endTime!=c.endTime?b.endTime-c.startTime:d.indexOf(c)-d.indexOf(b)}).forEach(function(b){this.a.addCue(b)}.bind(this))};Rh.prototype.append=Rh.prototype.append;Rh.prototype.destroy=function(){this.a&&Sh(this.a,function(){return!0});this.a=null;return Promise.resolve()};Rh.prototype.destroy=Rh.prototype.destroy;
Rh.prototype.isTextVisible=function(){return"showing"==this.a.mode};Rh.prototype.isTextVisible=Rh.prototype.isTextVisible;Rh.prototype.setTextVisibility=function(b){this.a.mode=b?"showing":"hidden"};Rh.prototype.setTextVisibility=Rh.prototype.setTextVisibility;
function Th(b){if(b.startTime>=b.endTime)return B("Invalid cue times: "+b.startTime+" - "+b.endTime),null;var c=new VTTCue(b.startTime,b.endTime,b.payload);c.lineAlign=b.lineAlign;c.positionAlign=b.positionAlign;c.size=b.size;try{c.align=b.textAlign}catch(d){}"center"==b.textAlign&&"center"!=c.align&&(c.align="middle");"vertical-lr"==b.writingMode?c.vertical="lr":"vertical-rl"==b.writingMode&&(c.vertical="rl");1==b.lineInterpretation&&(c.snapToLines=!1);null!=b.line&&(c.line=b.line);null!=b.position&&
(c.position=b.position);return c}function Sh(b,c){var d=b.mode;b.mode="showing"==d?"showing":"hidden";for(var e=b.cues,f=e.length-1;0<=f;f--){var g=e[f];g&&c(g)&&b.removeCue(g)}b.mode=d};function Uh(b,c,d,e,f){var g=f in e,h=!0,k;for(k in c){var l=f+"."+k,m=g?e[f]:d[k];g||k in d?void 0===c[k]?void 0===m||g?delete b[k]:b[k]=xb(m):m.constructor==Object&&c[k]&&c[k].constructor==Object?(b[k]||(b[k]=xb(m)),l=Uh(b[k],c[k],m,e,l),h=h&&l):typeof c[k]!=typeof m||null==c[k]||c[k].constructor!=m.constructor?(A("Invalid config, wrong type for "+l),h=!1):("function"==typeof d[k]&&d[k].length!=c[k].length&&B("Invalid config, wrong number of arguments for "+l),b[k]=c[k]):(A("Invalid config, unrecognized key "+
l),h=!1)}return h}z("shaka.util.ConfigUtils.mergeConfigObjects",Uh);function Vh(b,c){for(var d={},e=d,f=0,g=0;;){f=b.indexOf(".",f);if(0>f)break;if(0==f||"\\"!=b[f-1])g=b.substring(g,f).replace(/\\\./g,"."),e[g]={},e=e[g],g=f+1;f+=1}e[b.substring(g).replace(/\\\./g,".")]=c;return d}z("shaka.util.ConfigUtils.convertToConfigObject",Vh);function Wh(){}z("shaka.util.PlayerConfiguration",Wh);
function Xh(){var b=5E5,c=Infinity;navigator.connection&&(b=1E6*navigator.connection.downlink,navigator.connection.saveData&&(c=360));var d={retryParameters:kb(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:function(b){return b},fairPlayTransform:!0},e={retryParameters:kb(),availabilityWindowOverride:NaN,dash:{customScheme:function(b){if(b)return null},clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10,ignoreMinBufferTime:!1,
autoCorrectDrift:!0},hls:{ignoreTextStreamFailures:!1}},f={retryParameters:kb(),failureCallback:function(b){A("Unhandled streaming error",b)},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1};ic("Web0S")&&(f.stallEnabled=!1);var g={trackSelectionCallback:function(b){return b},progressCallback:function(b,
c){H("Offline operation on",b.originalManifestUri,"progress at",c)},usePersistentLicense:!0},h={drm:d,manifest:e,streaming:f,offline:g,abrFactory:Q,abr:{enabled:!0,defaultBandwidthEstimate:b,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:Infinity,minHeight:0,maxHeight:c,minPixels:0,maxPixels:Infinity,minBandwidth:0,maxBandwidth:Infinity}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,
restrictions:{minWidth:0,maxWidth:Infinity,minHeight:0,maxHeight:Infinity,minPixels:0,maxPixels:Infinity,minBandwidth:0,maxBandwidth:Infinity},playRangeStart:0,playRangeEnd:Infinity,textDisplayFactory:function(){return null}};g.trackSelectionCallback=function(b){return Yh(b,h.preferredAudioLanguage)};return h}
function Zh(b,c,d){var e={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0),individualizationServer:""}};return Uh(b,c,d||Xh(),e,"")}Wh.mergeConfigObjects=Zh;
function Yh(b,c){var d=b.filter(function(b){return"variant"==b.type}),e=[],f=fe(c,d.map(function(b){return b.language}));f&&(e=d.filter(function(b){return P(b.language)==f}));0==e.length&&(e=d.filter(function(b){return b.primary}));0==e.length&&(1<(new Set(d.map(function(b){return b.language}))).size&&B("Could not choose a good audio track based on language preferences or primary tracks.  An arbitrary language will be stored!"),e=d);var g=e.filter(function(b){return b.height&&480>=b.height});g.length&&
(g.sort(function(b,c){return c.height-b.height}),e=g.filter(function(b){return b.height==g[0].height}));d=[];if(e.length){var h=Math.floor(e.length/2);e.sort(function(b,c){return b.bandwidth-c.bandwidth});d.push(e[h])}e=t(b);for(h=e.next();!h.done;h=e.next())h=h.value,"text"==h.type&&d.push(h);return d};function $h(){this.a=null;this.b=[]}function ai(b,c){if(null==b.a)b.a={timestamp:Date.now()/1E3,state:c,duration:0};else{var d=Date.now()/1E3;b.a.duration=d-b.a.timestamp;b.a.state!=c&&(b.b.push(b.a),b.a={timestamp:d,state:c,duration:0})}}function bi(b,c){var d=0;b.a&&b.a.state==c&&(d+=b.a.duration);for(var e=t(b.b),f=e.next();!f.done;f=e.next())f=f.value,d+=f.state==c?f.duration:0;return d}
function ci(b){function c(b){return{timestamp:b.timestamp,state:b.state,duration:b.duration}}for(var d=[],e=t(b.b),f=e.next();!f.done;f=e.next())d.push(c(f.value));b.a&&d.push(c(b.a));return d};function di(){this.b=this.c=null;this.a=[]};function ei(){this.f=this.j=this.b=this.h=this.i=this.g=this.l=NaN;this.a=new $h;this.c=new di};function Z(b,c){var d=this;wb.call(this);this.h=fi;this.a=null;this.Xa=!1;this.i=new O;this.bc=this.j=this.Va=this.c=this.l=this.f=this.Fb=this.V=this.Bb=this.ca=this.Za=this.s=this.I=this.g=this.N=null;this.Vc=1E9;this.Db=new Set;this.ab=!0;this.xa=null;this.Rc=!1;this.Oc=0;this.ja=null;this.ha=new Qf;this.b=gi(this);this.Eb={width:Infinity,height:Infinity};this.v=null;this.Cb=new Zf(this.b.preferredAudioLanguage,this.b.preferredVariantRole,this.b.preferredAudioChannelCount);this.ia=this.b.preferredTextLanguage;
this.Wa=this.b.preferredTextRole;c&&c(this);this.N=hi(this);this.i.w(window,"online",function(){d.Cc()});this.B={name:"detach"};this.U={name:"attach"};this.ya={name:"unload"};this.fc={name:"manifest-parser"};this.ec={name:"manifest"};this.Ya={name:"media-source"};this.cc={name:"drm-engine"};this.ba={name:"load"};this.hc={name:"src-equals-drm-engine"};this.$a={name:"src-equals"};var e=new Map;e.set(this.U,function(b,c){return sb(ii(d,b,c))});e.set(this.B,function(b){b.o&&(d.i.aa(b.o,"error"),b.o=null);
d.a=null;b=Promise.resolve();return sb(b)});e.set(this.ya,function(b){return sb(ji(d,b))});e.set(this.Ya,function(b){b=ki(d,b);return sb(b)});e.set(this.fc,function(b,c){var e=li(d,b,c);return sb(e)});e.set(this.ec,function(b){return mi(d,b)});e.set(this.cc,function(){var b=ni(d);return sb(b)});e.set(this.ba,function(b,c){return sb(oi(d,b,c))});e.set(this.hc,function(b){b=pi(d,b);return sb(b)});e.set(this.$a,function(b,c){return qi(d,b,c)});this.bb=new Lh(this.B,{Xd:function(b,c,e,k){var f=null;b==
d.B&&(f=e==d.B?d.B:d.U);b==d.U&&(f=e==d.B||c.o!=k.o?d.B:e==d.U?d.U:e==d.Ya||e==d.ba?d.Ya:e==d.$a?d.hc:null);b==d.Ya&&(f=e==d.ba&&c.o==k.o?d.fc:d.ya);b==d.fc&&(f=ri(d.ba,d.ec,d.ya,e,c,k));b==d.ec&&(f=ri(d.ba,d.cc,d.ya,e,c,k));b==d.cc&&(f=ri(d.ba,d.ba,d.ya,e,c,k));b==d.hc&&(f=e==d.$a&&c.o==k.o?d.$a:d.ya);if(b==d.ba||b==d.$a)f=d.ya;b==d.ya&&(f=k.o&&c.o==k.o?d.U:d.B);return f},Gd:function(b,c,h){d.dispatchEvent(new M("onstatechange",{state:b.name}));return e.get(b)(c,h)},handleError:function(b,c){return u(function k(){return y(k,
function(e){switch(e.m){case 1:return B("The walker saw an error:"),c instanceof J?B("Error Code:",c.code):(B("Error Message:",c.message),B("Error Stack:",c.stack)),v(e,ji(d,b),2);case 2:return e["return"](b.o?d.U:d.B)}})})},ie:function(b){d.dispatchEvent(new M("onstateidle",{state:b.name}))}});b&&this.qb(b,!0)}Ka(Z,wb);z("shaka.Player",Z);
Z.prototype.destroy=function(){var b=this;return u(function d(){var e;return y(d,function(d){switch(d.m){case 1:if(b.h==si)return d["return"]();b.h=si;e=Ph(b.bb,function(){return{node:b.B,payload:Mh(),Ma:!1}});return v(d,new Promise(function(b){e.jb=function(){C("Preparing to destroy walker...")};e.Ub=function(){b()};e.Pa=function(){b()};e.onError=function(){b()};e.Vb=function(){b()}}),2);case 2:return v(d,b.bb.destroy(),3);case 3:b.i&&(b.i.release(),b.i=null);b.bc=null;b.j=null;b.b=null;if(!b.N){d.m=
0;break}return v(d,b.N.destroy(),5);case 5:b.N=null,w(d)}})})};Z.prototype.destroy=Z.prototype.destroy;Z.version="2.5.5-yandex-patched-custom-build-partial-chunks_4-2-gc12e8370-dirty";var ti=["","5"];Nf=new function(b){this.a=b;this.c=Of;this.b=Pf}(new Lf(Number(ti[0]),Number(ti[1])));var ui=["output-restricted","internal-error"],vi={};Z.registerSupportPlugin=function(b,c){vi[b]=c};
Z.isBrowserSupported=function(){return window.Promise&&window.Uint8Array&&Array.prototype.forEach&&window.MediaKeys&&window.navigator&&window.navigator.requestMediaKeySystemAccess&&window.MediaKeySystemAccess&&window.MediaKeySystemAccess.prototype.getConfiguration?fc()?!0:gc("application/x-mpegurl"):!1};
Z.probeSupport=function(){return Zc().then(function(b){for(var c=X.Ae(),d={},e=t('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),f=
e.next();!f.done;f=e.next()){f=f.value;d[f]=fc()?Kd(f)?!0:MediaSource.isTypeSupported(f)||od(f):gc(f);var g=f.split(";")[0];d[g]=d[g]||d[f]}b={manifest:c,media:d,drm:b};for(var h in vi)b[h]=vi[h]();return b})};Z.prototype.qb=function(b,c){c=void 0===c?!0:c;if(this.h==si)return Promise.reject(wi());var d=Mh();d.o=b;fc()||(c=!1);var e=c?this.Ya:this.U,f=Ph(this.bb,function(){return{node:e,payload:d,Ma:!1}});f.jb=function(){return C("Starting attach...")};return xi(f)};Z.prototype.attach=Z.prototype.qb;
Z.prototype.detach=function(){var b=this;if(this.h==si)return Promise.reject(wi());var c=Ph(this.bb,function(){return{node:b.B,payload:Mh(),Ma:!1}});c.jb=function(){return C("Starting detach...")};return xi(c)};Z.prototype.detach=Z.prototype.detach;
Z.prototype.Ye=function(b){var c=this;b=void 0===b?!0:b;if(this.h==si)return Promise.reject(wi());fc()||(b=!1);var d=Mh(),e=Ph(this.bb,function(e){var f=e.o&&b?c.Ya:e.o?c.U:c.B;d.o=e.o;return{node:f,payload:d,Ma:!1}});e.jb=function(){return C("Starting unload...")};return xi(e)};Z.prototype.unload=Z.prototype.Ye;
Z.prototype.load=function(b,c,d){if(this.h==si)return Promise.reject(wi());this.dispatchEvent(new M("loading"));var e=Mh();e.uri=b;e.Gc=Date.now()/1E3;d&&"string"!=typeof d&&(Mf("Loading with a manifest parser factory","Please register a manifest parser and for the mime-type."),e.qa=function(){return new d});d&&"string"==typeof d&&(e.mimeType=d);void 0!==c&&(e.startTime=c);var f=yi(e)?this.$a:this.ba,g=Ph(this.bb,function(b){if(null==b.o)return null;e.o=b.o;return{node:f,payload:e,Ma:!0}});g.jb=function(){return C("Starting load of "+
b+"...")};return new Promise(function(b,c){g.Vb=function(){return c(new J(2,7,7002))};g.Ub=function(){return b()};g.Pa=function(){return c(wi())};g.onError=function(b){return c(b)}})};Z.prototype.load=Z.prototype.load;
function yi(b){if(b.qa)return!1;if(!fc())return!0;var c=b.mimeType;b=b.uri||"";c||(c={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",ts:"video/mp2t",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac"}[X.getExtension(b)]);return c?gc(c)?X.isSupported(b,c)?!!navigator.vendor&&navigator.vendor.includes("Apple"):!0:!1:!1}function ii(b,c,d){null==c.o&&(c.o=d.o,b.i.w(c.o,"error",function(){var c=zi(b);c&&b.Fa(c)}));b.a=c.o;return Promise.resolve()}
function ji(b,c){return u(function e(){return y(e,function(e){switch(e.m){case 1:b.h!=si&&(b.h=fi);b.dispatchEvent(new M("unloading"));c.qa=null;c.mimeType=null;c.startTime=null;c.uri=null;c.o&&(b.i.aa(c.o,"loadeddata"),b.i.aa(c.o,"playing"),b.i.aa(c.o,"pause"),b.i.aa(c.o,"ended"),b.i.aa(c.o,"ratechange"));b.Za&&(b.Za.release(),b.Za=null);b.Bb&&(b.Bb.stop(),b.Bb=null);if(!b.l){e.m=2;break}return v(e,b.l.stop(),3);case 3:b.l=null;case 2:if(!b.j){e.m=4;break}return v(e,b.j.stop(),4);case 4:if(!b.f){e.m=
6;break}return v(e,b.f.destroy(),7);case 7:b.f=null;case 6:b.s&&(b.s.release(),b.s=null);if(!b.I){e.m=8;break}return v(e,b.I.destroy(),9);case 9:b.I=null;case 8:c.o&&c.o.src&&(c.o.removeAttribute("src"),c.o.load());if(!b.g){e.m=10;break}return v(e,b.g.destroy(),11);case 11:b.g=null;case 10:b.ha.a.clear(),b.Va=null,b.V=null,b.Db.clear(),b.c=null,b.v=null,b.ac=null,b.ab=!0,Ai(b),w(e)}})})}
function ki(b,c){return u(function e(){var f,g,h,k;return y(e,function(e){switch(e.m){case 1:return f=window.muxjs?new cd:new dd,g=b.b.textDisplayFactory,h=new g,b.ac=g,k=new Nd(c.o,f,h),v(e,k.s,2);case 2:b.I=k,w(e)}})})}
function li(b,c,d){return u(function f(){var g,h,k;return y(f,function(f){switch(f.m){case 1:c.qa=d.qa;c.mimeType=d.mimeType;c.uri=d.uri;g=c.uri;h=b.N;b.Va=g;if(c.qa){b.l=c.qa();f.m=2;break}k=b;return v(f,X.create(g,h,b.b.manifest.retryParameters,c.mimeType),3);case 3:k.l=f.O;case 2:b.l.configure(b.b.manifest),w(f)}})})}
function mi(b,c){var d=c.uri,e=b.N;b.Fb=new Og;Pg(b.Fb,function(c){Bi(b,"timelineregionadded",c)});var f={networkingEngine:e,filterNewPeriod:function(c){return b.jc(c)},filterAllPeriods:function(c){return Ci(b,c)},onTimelineRegionAdded:function(c){var d=b.Fb;a:{var e=t(d.a);for(var f=e.next();!f.done;f=e.next())if(f=f.value,f.schemeIdUri==c.schemeIdUri&&f.startTime==c.startTime&&f.endTime==c.endTime){e=f;break a}e=null}null==e&&(d.a.add(c),d.b(c))},onEvent:function(c){return b.dispatchEvent(c)},onError:function(c){return b.Fa(c)}};
return new K(Promise.resolve().then(function(){return u(function h(){var c;return y(h,function(e){switch(e.m){case 1:return c=b,v(e,b.l.start(d,f),2);case 2:c.c=e.O;b.dispatchEvent(new M("manifestparsed"));if(0==b.c.periods.length)throw new J(2,4,4014);Di(b.c.periods);w(e)}})})}),function(){C("Aborting parser step...");return b.l.stop()})}
function ni(b){return u(function d(){return y(d,function(d){switch(d.m){case 1:return b.g=new wc({Rb:b.N,onError:function(d){b.Fa(d)},cd:function(d){Ei(b,d)},onExpirationUpdated:function(d,e){Fi(b,d,e)},onEvent:function(d){b.dispatchEvent(d)}}),b.g.configure(b.b.drm),v(d,Bc(b.g,ug(b.c.periods),b.c.offlineSessionIds),2);case 2:Ci(b,b.c.periods),w(d)}})})}
function oi(b,c,d){return u(function f(){var g,h,k,l,m,n,q,r,x,E;return y(f,function(f){switch(f.m){case 1:return c.startTime=d.startTime,g=c.o,h=c.uri,b.Va=h,b.v=new ei,k=function(){return Gi(b)},l=function(){var c=b.a.playbackRate;0!=c&&b.ca.set(c)},b.i.w(g,"playing",k),b.i.w(g,"pause",k),b.i.w(g,"ended",k),b.i.w(g,"ratechange",l),m=b.b.abrFactory,b.j&&b.bc==m||(b.bc=m,b.j=new m,b.j.configure(b.b.abr)),Hi(b,b.c.periods),b.Cb=new Zf(b.b.preferredAudioLanguage,b.b.preferredVariantRole,b.b.preferredAudioChannelCount),
b.ia=b.b.preferredTextLanguage,Ii(b.c.presentationTimeline,b.b.playRangeStart,b.b.playRangeEnd),v(f,b.g.qb(g),2);case 2:return b.j.init(function(c,d,f){d=void 0===d?!1:d;f=void 0===f?0:f;D("switch_");a:{var g=t(b.c.periods);for(var h=g.next();!h.done;h=g.next())if(h=h.value,h.variants.includes(c)){g=h;break a}g=null}Ji(b,g,c,!0);b.f&&(hh(b.f,c,d,f),Ki(b))}),b.s=Li(b,c.startTime),b.Za=Mi(b),b.ca=new yg({Lb:function(){return c.o.playbackRate},Ec:function(b){c.o.playbackRate=b},Zc:function(b){c.o.currentTime+=
b}}),n=Math.max(b.c.minBufferTime,b.b.streaming.rebufferingGoal),Ni(b,n),b.f=Oi(b),b.f.configure(b.b.streaming),Pi(b),b.h=Qi,b.dispatchEvent(new M("streaming")),v(f,b.f.start(),3);case 3:b.b.streaming.startAtSegmentBoundary&&(q=b.s.h(),r=Ri(b,q),b.s.l(r)),b.c.periods.forEach(b.jc.bind(b)),Si(b),Ki(b),x=Ti(b)||b.c.periods[0],E=x.variants.some(function(b){return b.primary}),b.b.preferredAudioLanguage||E||B("No preferred audio language set.  We will choose an arbitrary language initially"),Ui(b,x.variants),
b.i.ea(g,"loadeddata",function(){b.v.b=Date.now()/1E3-d.Gc}),w(f)}})})}
function pi(b,c){return u(function e(){var f,g;return y(e,function(e){switch(e.m){case 1:return f=ld,b.g=new wc({Rb:b.N,onError:function(c){b.Fa(c)},cd:function(c){Ei(b,c)},onExpirationUpdated:function(c,e){Fi(b,c,e)},onEvent:function(c){b.dispatchEvent(c)}}),b.g.configure(b.b.drm),g={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,
presentationTimeOffset:0,mimeType:"video/mp4",codecs:"",encrypted:!0,keyId:null,language:"und",label:null,type:f.Kc,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null},bandwidth:100,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0},v(e,Bc(b.g,[g],[]),2);case 2:return v(e,b.g.qb(c.o),0)}})})}
function qi(b,c,d){function e(){return Gi(b)}c.uri=d.uri;c.startTime=d.startTime;b.Va=c.uri;b.v=new ei;b.s=new Hg(c.o);null!=c.startTime&&b.s.l(c.startTime);b.ca=new yg({Lb:function(){return c.o.playbackRate},Ec:function(b){c.o.playbackRate=b},Zc:function(b){c.o.currentTime+=b}});Ni(b,b.b.streaming.rebufferingGoal);b.i.w(c.o,"playing",e);b.i.w(c.o,"pause",e);b.i.w(c.o,"ended",e);b.i.ea(c.o,"loadeddata",function(){b.v.b=Date.now()/1E3-d.Gc});b.a.audioTracks&&(b.i.w(b.a.audioTracks,"addtrack",function(){return Si(b)}),
b.i.w(b.a.audioTracks,"removetrack",function(){return Si(b)}));if(b.a.textTracks){var f=b.a.textTracks;b.i.w(f,"addtrack",function(){return Si(b)});b.i.w(f,"removetrack",function(){return Si(b)})}c.o.src=c.uri;b.h=Vi;b.dispatchEvent(new M("streaming"));var g=new mb;b.a.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?g.resolve():b.a.error?g.reject(zi(b)):(b.i.ea(b.a,"loadeddata",function(){g.resolve()}),b.i.ea(b.a,"error",function(){g.reject(zi(b))}));return new K(g,function(){g.reject(new J(2,7,7001));
return Promise.resolve()})}function Di(b){function c(b){return b.video&&b.audio||b.video&&b.video.codecs.includes(",")}b.some(function(b){return b.variants.some(c)})&&(D("Found variant with audio and video content, so filtering out audio-only content in all periods."),b.forEach(function(b){b.variants=b.variants.filter(c)}))}
function Pi(b){function c(b){var c="";b.video&&(c=ec(b.video.codecs)[0]);var d="";b.audio&&(d=ec(b.audio.codecs)[0]);return c+"-"+d}var d=b.c.periods.reduce(function(b,c){return b.concat(c.variants)},[]);d=re(d,b.b.preferredAudioChannelCount);var e=new vb;d.forEach(function(b){var d=c(b);e.push(d,b)});var f=null,g=Infinity;e.forEach(function(b,c){var d=0,e=0;c.forEach(function(b){d+=b.bandwidth||0;++e});var h=d/e;D("codecs",b,"avg bandwidth",h);h<g&&(f=b,g=h)});b.c.periods.forEach(function(b){b.variants=
b.variants.filter(function(b){if(c(b)==f)return!0;D("Dropping Variant (better codec available)",b);return!1})})}function hi(b){return new N(function(c,d){b.j&&b.j.segmentDownloaded(c,d)})}function Li(b,c){return new Ig(b.a,b.c,b.b.streaming,c,function(){b.Za&&tg(b.Za,!0);b.f&&ph(b.f)},function(c){return b.dispatchEvent(c)})}
function Mi(b){var c=new wg(b.c);xg(c,function(){Si(b)});var d=new Qg(b.Fb);Ug(d,function(c){Bi(b,"timelineregionenter",c)},function(c){Bi(b,"timelineregionexit",c)},function(c,d){d||(Bi(b,"timelineregionenter",c),Bi(b,"timelineregionexit",c))});var e=new kg(b.a);e.a.add(c);e.a.add(d);return e}
function Ni(b,c){b.V=new bg(c,Math.min(.5,c/2));b.V.a=dg;Ai(b);b.Bb=(new I(function(){switch(b.h){case Vi:var c=b.a.ended?!0:ed(b.a.buffered)>=b.a.duration-.1;break;case Qi:a:if(b.a.ended||Rd(b.I))c=!0;else{if(b.c.presentationTimeline.$()){var e=b.c.presentationTimeline.fb();if(ed(b.a.buffered)>=e){c=!0;break a}}c=!1}break;default:c=!1}var f=gd(b.a.buffered,b.a.currentTime);e=b.V;var g=c,h=e.b.get(e.a);c=e.a;f=g||f>=h?cg:dg;e.a=f;c!=f&&Ai(b)})).Ga(.25)}
function Oi(b){return new Vg(b.c,{Aa:function(){return b.s.h()},getBandwidthEstimate:function(){return b.j.getBandwidthEstimate()},A:b.I,Rb:b.N,bd:b.he.bind(b),ad:b.Bd.bind(b),onError:b.Fa.bind(b),onEvent:function(c){return b.dispatchEvent(c)},ke:b.le.bind(b),yc:b.pe.bind(b)})}Z.prototype.configure=function(b,c){2==arguments.length&&"string"==typeof b&&(b=Vh(b,c));var d=Zh(this.b,b,gi(this));Wi(this);return d};Z.prototype.configure=Z.prototype.configure;
function Wi(b){b.l&&b.l.configure(b.b.manifest);b.g&&b.g.configure(b.b.drm);if(b.f){b.f.configure(b.b.streaming);try{b.c.periods.forEach(b.jc.bind(b))}catch(g){b.Fa(g)}var c=Zg(b.f),d=ah(b.f),e=Ti(b);c=ue(c,d,e.variants);b.j&&c&&c.allowedByApplication&&c.allowedByKeySystem?Ui(b,e.variants):(D("Choosing new streams after changing configuration"),Xi(b,e))}if(b.I&&(e=b.b.textDisplayFactory,b.ac!=e)){c=new e;d=b.I;var f=d.g;d.g=c;f&&(c.setTextVisibility(f.isTextVisible()),f.destroy());d.a&&(d.a.c=c);
b.ac=e;b.f&&(e=b.f,(c=e.b.get("text"))&&gh(e,c.stream,!0,0,!0))}b.j&&(b.j.configure(b.b.abr),b.b.abr.enabled&&!b.ab?b.j.enable():b.j.disable(),Yi(b))}Z.prototype.getConfiguration=function(){var b=gi(this);Zh(b,this.b,gi(this));return b};Z.prototype.getConfiguration=Z.prototype.getConfiguration;Z.prototype.He=function(){for(var b in this.b)delete this.b[b];Zh(this.b,gi(this),gi(this));Wi(this)};Z.prototype.resetConfiguration=Z.prototype.He;Z.prototype.Qd=function(){return this.h};
Z.prototype.getLoadMode=Z.prototype.Qd;Z.prototype.Ud=function(){return this.a};Z.prototype.getMediaElement=Z.prototype.Ud;Z.prototype.Wd=function(){return this.N};Z.prototype.getNetworkingEngine=Z.prototype.Wd;Z.prototype.Jd=function(){return this.Va};Z.prototype.getAssetUri=Z.prototype.Jd;Z.prototype.Td=function(){Mf("getManifestUri",'Please use "getAssetUri" instead.');return this.Va};Z.prototype.getManifestUri=Z.prototype.Td;
Z.prototype.$=function(){return this.c?this.c.presentationTimeline.$():this.a&&this.a.src?Infinity==this.a.duration:!1};Z.prototype.isLive=Z.prototype.$;Z.prototype.hb=function(){return this.c?this.c.presentationTimeline.hb():!1};Z.prototype.isInProgress=Z.prototype.hb;
Z.prototype.ee=function(){if(this.c){if(!this.c.periods.length)return!1;var b=this.c.periods[0].variants;return b.length?!b[0].video:!1}return this.a&&this.a.src?this.a.videoTracks?0==this.a.videoTracks.length:0==this.a.videoHeight:!1};Z.prototype.isAudioOnly=Z.prototype.ee;Z.prototype.Ke=function(){if(this.c){var b=this.c.presentationTimeline;return{start:b.eb(),end:b.sa()}}return this.a&&this.a.src&&(b=this.a.seekable,b.length)?{start:b.start(0),end:b.end(b.length-1)}:{start:0,end:0}};
Z.prototype.seekRange=Z.prototype.Ke;Z.prototype.keySystem=function(){return this.g?this.g.keySystem():""};Z.prototype.keySystem=Z.prototype.keySystem;Z.prototype.drmInfo=function(){return this.g?this.g.a:null};Z.prototype.drmInfo=Z.prototype.drmInfo;Z.prototype.nc=function(){return this.g?this.g.nc():Infinity};Z.prototype.getExpiration=Z.prototype.nc;Z.prototype.Yc=function(){return this.V?this.V.a==dg:!1};Z.prototype.isBuffering=Z.prototype.Yc;
Z.prototype.Yd=function(){if(this.ca){var b=this.ca;b=b.f?0:b.c}else b=0;return b};Z.prototype.getPlaybackRate=Z.prototype.Yd;Z.prototype.Xe=function(b){0==b?Ra("A trick play rate of 0 is unsupported!"):(this.a.paused&&this.a.play(),this.ca.set(b),this.h==Qi&&fh(this.f,1<Math.abs(b)))};Z.prototype.trickPlay=Z.prototype.Xe;Z.prototype.Cd=function(){this.h==Vi&&this.ca.set(1);this.h==Qi&&(this.ca.set(1),fh(this.f,!1))};Z.prototype.cancelTrickPlay=Z.prototype.Cd;
Z.prototype.pc=function(){if(this.c&&this.s){for(var b=Zi(this),c=[],d=t($i(this)),e=d.next();!e.done;e=d.next()){e=e.value;var f=le(e);f.active=e==b;c.push(f)}return c}return this.a&&this.a.audioTracks?Array.from(this.a.audioTracks).map(function(b){var c=pe(b);c.active=b.enabled;c.type="variant";c.originalAudioId=b.id;"main"==b.kind?(c.primary=!0,c.roles=["main"],c.audioRoles=["main"]):c.audioRoles=[];return c}):[]};Z.prototype.getVariantTracks=Z.prototype.pc;
Z.prototype.gb=function(){if(this.c&&this.s){for(var b=aj(this),c=[],d=t(bj(this)),e=d.next();!e.done;e=d.next()){e=e.value;var f=me(e);f.active=e==b;c.push(f)}return c}return this.a&&this.a.src&&this.a.textTracks?Array.from(this.a.textTracks).map(function(b){var c=pe(b);c.active="disabled"!=b.mode;c.type="text";c.originalTextId=b.id;"captions"==b.kind&&(c.mimeType="application/cea-608");return c}):[]};Z.prototype.getTextTracks=Z.prototype.gb;
Z.prototype.Dc=function(b){if(this.c&&this.f){var c=Ti(this),d=c.textStreams.find(function(c){return c.id==b.id});d?(cj(this,c,d,!1),dj(this,d),this.ia=d.language):A("No stream with id",b.id)}else if(this.a&&this.a.src&&this.a.textTracks){c=Array.from(this.a.textTracks);c=t(c);for(d=c.next();!d.done;d=c.next())d=d.value,ne(d)==b.id?d.mode=this.Xa?"showing":"hidden":d.mode="disabled";ej(this)}};Z.prototype.selectTextTrack=Z.prototype.Dc;
Z.prototype.Me=function(){Mf("selectEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. Please use SelectTextTrack.");var b=this.gb().filter(function(b){return"application/cea-608"==b.mimeType});0<b.length?this.Dc(b[0]):B("Unable to find the text track embedded in the video.")};Z.prototype.selectEmbeddedTextTrack=Z.prototype.Me;
Z.prototype.cf=function(){Mf("usingEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. There should be no reason to know if the player is playing embedded text.");var b=this.gb().filter(function(b){return b.active})[0];return b?"application/cea-608"==b.mimeType:!1};Z.prototype.usingEmbeddedTextTrack=Z.prototype.cf;
Z.prototype.Oe=function(b,c,d){d=void 0===d?0:d;if(this.c&&this.f){var e=Ti(this);this.b.abr.enabled&&Ra("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var f=e.variants.find(function(c){return c.id==b.id});f?qe(f)?(Ji(this,e,f,!1),fj(this,f,c,d),this.Cb=new Yf(f),Ui(this,e.variants)):A("Unable to switch to restricted track",b.id):A("No variant with id",b.id)}else if(this.a&&this.a.audioTracks){c=
Array.from(this.a.audioTracks);c=t(c);for(d=c.next();!d.done;d=c.next())d=d.value,ne(d)==b.id&&(d.enabled=!0);gj(this)}};Z.prototype.selectVariantTrack=Z.prototype.Oe;Z.prototype.Ld=function(){return ij(this.pc())};Z.prototype.getAudioLanguagesAndRoles=Z.prototype.Ld;Z.prototype.ce=function(){return ij(this.gb())};Z.prototype.getTextLanguagesAndRoles=Z.prototype.ce;Z.prototype.Kd=function(){return Array.from(jj(this.pc()))};Z.prototype.getAudioLanguages=Z.prototype.Kd;Z.prototype.be=function(){return Array.from(jj(this.gb()))};
Z.prototype.getTextLanguages=Z.prototype.be;Z.prototype.Le=function(b,c){if(this.c&&this.s){var d=Ti(this);this.Cb=new Zf(b,c||"",0);Xi(this,d)}else if(this.a&&this.a.audioTracks){d=Array.from(this.a.audioTracks);d=t(d);for(var e=d.next();!e.done;e=d.next())e=e.value,e.language==b&&(e.enabled=!0);gj(this)}};Z.prototype.selectAudioLanguage=Z.prototype.Le;
Z.prototype.Ne=function(b,c){if(this.c&&this.s){var d=Ti(this);this.ia=b;this.Wa=c||"";var e=se(d.textStreams,this.ia,this.Wa)[0]||null;e&&(cj(this,d,e,!1),(this.b.streaming.alwaysStreamText||this.Pb())&&dj(this,e))}else(d=this.gb().filter(function(c){return c.language==b})[0])&&this.Dc(d)};Z.prototype.selectTextLanguage=Z.prototype.Ne;
Z.prototype.Pb=function(){var b=this.Xa;return this.c?this.I.g.isTextVisible():this.a&&this.a.src&&this.a.textTracks?Array.from(this.a.textTracks).some(function(b){return"showing"==b.mode}):b};Z.prototype.isTextTrackVisible=Z.prototype.Pb;
Z.prototype.Se=function(b){var c=this;return u(function e(){var f,g,h,k,l,m;return y(e,function(e){switch(e.m){case 1:f=c.Xa;g=b;if(f==g)return e["return"]();c.Xa=g;if(c.h!=Qi){if(c.a&&c.a.src&&c.a.textTracks){h=Array.from(c.a.textTracks);for(var n=t(h),r=n.next();!r.done;r=n.next())k=r.value,"disabled"!=k.mode&&(k.mode=b?"showing":"hidden")}e.m=2;break}c.I.g.setTextVisibility(b);if(c.b.streaming.alwaysStreamText){e.m=2;break}if(!b){n=c.f;n.I=!0;if(r=n.b.get("text"))Wg(r),n.b["delete"]("text");e.m=
2;break}l=Ti(c);m=se(l.textStreams,c.ia,c.Wa);if(!(0<m.length)){e.m=2;break}return v(e,bh(c.f,m[0]),2);case 2:kj(c),w(e)}})})};Z.prototype.setTextTrackVisibility=Z.prototype.Se;
Z.prototype.Zd=function(){if(!this.$())return B("getPlayheadTimeAsDate is for live streams!"),null;if(this.c)return new Date(1E3*(this.c.presentationTimeline.f+this.a.currentTime));if(this.a&&this.a.getStartDate){var b=this.a.getStartDate();return isNaN(b.getTime())?(B("EXT-X-PROGRAM-DATETIME required to get playhead time as Date!"),null):new Date(b.getTime()+1E3*this.a.currentTime)}B("No way to get playhead time as Date!");return null};Z.prototype.getPlayheadTimeAsDate=Z.prototype.Zd;
Z.prototype.ae=function(){if(!this.$())return B("getPresentationStartTimeAsDate is for live streams!"),null;if(this.c)return new Date(1E3*this.c.presentationTimeline.f);if(this.a&&this.a.getStartDate){var b=this.a.getStartDate();return isNaN(b.getTime())?(B("EXT-X-PROGRAM-DATETIME required to get presentation start time as Date!"),null):b}B("No way to get presentation start time as Date!");return null};Z.prototype.getPresentationStartTimeAsDate=Z.prototype.ae;
Z.prototype.lc=function(){var b={total:[],audio:[],video:[],text:[]};this.h==Vi&&(b.total=hd(this.a.buffered));this.h==Qi&&this.I.lc(b);return b};Z.prototype.getBufferedInfo=Z.prototype.lc;
Z.prototype.getStats=function(){if(this.h!=Qi&&this.h!=Vi)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,switchHistory:[],stateHistory:[]};Gi(this);var b=this.a;if(b.getVideoPlaybackQuality){b=b.getVideoPlaybackQuality();var c=this.v,d=Number(b.totalVideoFrames);c.i=Number(b.droppedVideoFrames);c.h=d}if(this.h==Qi){if(b=Zi(this))this.v.j=b.bandwidth;b&&b.video&&(c=this.v,d=b.video.height||
NaN,c.l=b.video.width||NaN,c.g=d);b=this.j.getBandwidthEstimate();this.v.f=b}var e=this.v;b=e.l;c=e.g;d=e.j;var f=e.h,g=e.i,h=e.f,k=e.b,l=bi(e.a,"playing"),m=bi(e.a,"paused"),n=bi(e.a,"buffering"),q=ci(e.a),r=[];e=t(e.c.a);for(var x=e.next();!x.done;x=e.next())x=x.value,r.push({timestamp:x.timestamp,id:x.id,type:x.type,fromAdaptation:x.fromAdaptation,bandwidth:x.bandwidth});return{width:b,height:c,streamBandwidth:d,decodedFrames:f,droppedFrames:g,estimatedBandwidth:h,loadLatency:k,playTime:l,pauseTime:m,
bufferingTime:n,stateHistory:q,switchHistory:r}};Z.prototype.getStats=Z.prototype.getStats;
Z.prototype.addTextTrack=function(b,c,d,e,f,g){var h=this;return u(function l(){var m,n,q,r,x,E,F,L,V;return y(l,function(l){switch(l.m){case 1:if(h.h==Vi)throw A("Cannot add text when loaded with src="),Error("State error!");if(h.h!=Qi)throw A("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");m=Ti(h);n=ld;q=h.c.periods.indexOf(m);r=q+1;x=r>=h.c.periods.length?h.c.presentationTimeline.Y():h.c.periods[r].startTime;E=x-m.startTime;if(Infinity==E)throw new J(1,
4,4033);F=new U(1,0,E,function(){return[b]},0,null);L={id:h.Vc++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return 1},getSegmentReference:function(b){return 1==b?F:null},initSegmentReference:null,presentationTimeOffset:0,mimeType:e,codecs:f||"",kind:d,encrypted:!1,keyId:null,language:c,label:g||null,type:n.Ja,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null};h.Db.add(L);m.textStreams.push(L);return v(l,
bh(h.f,L),2);case 2:return(V=$g(h.f,"text"))&&Rf(h.ha,m,V),h.Db["delete"](L),D("Choosing new streams after adding a text stream"),Xi(h,m),Si(h),l["return"](me(L))}})})};Z.prototype.addTextTrack=Z.prototype.addTextTrack;Z.prototype.Re=function(b,c){this.Eb.width=b;this.Eb.height=c};Z.prototype.setMaxHardwareResolution=Z.prototype.Re;
Z.prototype.Cc=function(){if(this.h==Qi){var b=this.f;if(b.f)A("Unable to retry after StreamingEngine is destroyed!"),b=!1;else if(b.l)A("Unable to retry after StreamingEngine encountered a fatal error!"),b=!1;else{for(var c=t(b.b.values()),d=c.next();!d.done;d=c.next()){d=d.value;var e=kh(d);d.tb&&(C(e,"Retrying after failure..."),d.tb=!1,eh(b,d,.1))}b=!0}}else b=!1;return b};Z.prototype.retryStreaming=Z.prototype.Cc;Z.prototype.Rd=function(){return this.c};Z.prototype.getManifest=Z.prototype.Rd;
Z.prototype.Sd=function(){return this.l?this.l.constructor:null};Z.prototype.getManifestParserFactory=Z.prototype.Sd;function Ji(b,c,d,e){Sf(b.ha,c).variant=d;b=b.v.c;b.c!=d&&(b.c=d,b.a.push({timestamp:Date.now()/1E3,id:d.id,type:"variant",fromAdaptation:e,bandwidth:d.bandwidth}))}function cj(b,c,d,e){Rf(b.ha,c,d);b=b.v.c;b.b!=d&&(b.b=d,b.a.push({timestamp:Date.now()/1E3,id:d.id,type:"text",fromAdaptation:e,bandwidth:null}))}
function gi(b){var c=Xh();c.streaming.failureCallback=function(c){var d=[1001,1002,1003];b.$()&&d.includes(c.code)&&(c.severity=1,B("Live streaming error.  Retrying automatically..."),b.Cc())};c.textDisplayFactory=function(){return new Rh(b.a)};return c}
function Hi(b,c){for(var d=0;d<c.length;d++){for(var e=c[d],f=new Map,g=t(e.variants),h=g.next();!h.done;h=g.next())if(h=h.value,h.video&&h.video.closedCaptions){h=h.video;for(var k=t(h.closedCaptions.keys()),l=k.next();!l.done;l=k.next())if(l=l.value,!f.has(l)){var m={id:b.Vc++,originalId:l,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"application/cea-608",
codecs:"",kind:"caption",encrypted:!1,keyId:null,language:h.closedCaptions.get(l),label:null,type:"text",primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:h.roles,channelsCount:null,closedCaptions:null};f.set(l,m)}}f=t(f.values());for(g=f.next();!g.done;g=f.next())e.textStreams.push(g.value)}}
function Ci(b,c){var d=b.f?Zg(b.f):null,e=b.f?ah(b.f):null;c.forEach(ie.bind(null,b.g,d,e));d=zb(c,function(b){return b.variants.some(qe)});if(0==d)throw new J(2,4,4032);if(d<c.length)throw new J(2,4,4011);c.forEach(function(b){he(b.variants,this.b.restrictions,this.Eb)&&this.f&&Ti(this)==b&&Si(this);lj(this,b.variants)}.bind(b))}p=Z.prototype;
p.jc=function(b){var c=this.f?Zg(this.f):null,d=this.f?ah(this.f):null;ie(this.g,c,d,b);c=b.variants;if(!c.some(qe))throw new J(2,4,4011);lj(this,b.variants);he(c,this.b.restrictions,this.Eb)&&this.f&&Ti(this)==b&&Si(this);if(b=this.g?this.g.a:null)for(c=t(c),d=c.next();!d.done;d=c.next()){d=t(d.value.drmInfos);for(var e=d.next();!e.done;e=d.next())if(e=e.value,e.keySystem==b.keySystem){e=t(e.initData||[]);for(var f=e.next();!f.done;f=e.next())f=f.value,Oc(this.g,f.initDataType,f.initData)}}};
function fj(b,c,d,e){d=void 0===d?!1:d;e=void 0===e?0:e;b.ab?(b.xa=c,b.Rc=d,b.Oc=e):(hh(b.f,c,d,e),gj(b))}function dj(b,c){b.ab?b.ja=c:(gh(b.f,c,!0,0,!1),ej(b))}function Ri(b,c){function d(b,c){if(!b)return null;var d=b.findSegmentPosition(c-g.startTime);return null==d?null:(d=b.getSegmentReference(d))?d.startTime+g.startTime:null}var e=Zg(b.f),f=ah(b.f),g=Ti(b);e=d(e,c);f=d(f,c);return null!=f&&null!=e?Math.max(f,e):null!=f?f:null!=e?e:c}
function Ai(b){var c=b.Yc();if(b.v&&b.V&&b.s){var d=b.ca;d.f=c;zg(d);Gi(b)}b.dispatchEvent(new M("buffering",{buffering:c}))}function Gi(b){if(b.v&&b.V){var c=b.v.a;b.V.a==dg?ai(c,"buffering"):b.a.paused?ai(c,"paused"):b.a.ended?ai(c,"ended"):ai(c,"playing")}}function Ui(b,c){try{lj(b,c)}catch(e){return b.Fa(e),null}var d=c.filter(function(b){return qe(b)});d=b.Cb.create(d);b.j.setVariants(Array.from(d.values()));return b.j.chooseVariant()}
function Xi(b,c){var d=Ui(b,c.variants);d&&(Ji(b,c,d,!0),fj(b,d,!0));(d=se(c.textStreams,b.ia,b.Wa)[0]||null)&&(b.b.streaming.alwaysStreamText||b.Pb())&&(cj(b,c,d,!0),dj(b,d));Ki(b)}
p.he=function(b){D("onChooseStreams_",b);try{H("onChooseStreams_, choosing variant from ",b.variants);H("onChooseStreams_, choosing text from ",b.textStreams);this.ab=!0;this.j.disable();Yi(this);D("Choosing new streams after period changed");var c=Ui(this,b.variants),d=se(b.textStreams,this.ia,this.Wa)[0]||null;this.xa&&(b.variants.includes(this.xa)&&(c=this.xa),this.xa=null);this.ja&&(b.textStreams.includes(this.ja)&&(d=this.ja),this.ja=null);c&&Ji(this,b,c,!0);d&&cj(this,b,d,!0);var e=this.f,f=
e.b.get("video");if(f)var g=e.c.periods[f.ka];else{var h=e.b.get("audio");g=h?e.c.periods[h.ka]:null}var k=c?c.audio:null;if(!g&&d){var l;if(l=k){b=d;var m=P(this.b.preferredTextLanguage),n=P(k.language),q=P(b.language);l=be(q,m)&&!be(n,q)}l&&(this.Xa=!0);this.Xa&&this.I.g.setTextVisibility(!0);kj(this)}var r=this.b.streaming.alwaysStreamText||this.Pb()?{variant:c,text:d}:{variant:c,text:null};H("onChooseStreams_, chose variant ",r.variant);H("onChooseStreams_, chose text ",r.text);return r}catch(x){return this.Fa(x),
{variant:null,text:null}}};p.Bd=function(){D("canSwitch_");this.ab=!1;this.b.abr.enabled&&(this.j.enable(),Yi(this));this.xa&&(hh(this.f,this.xa,this.Rc,this.Oc),gj(this),this.xa=null);this.ja&&(gh(this.f,this.ja,!0,0,!1),ej(this),this.ja=null)};p.le=function(){this.l&&this.l.update&&this.l.update()};p.pe=function(){this.s&&this.s.s()};function Ki(b){mj(b,new M("adaptation"))}function Si(b){mj(b,new M("trackschanged"))}function gj(b){mj(b,new M("variantchanged"))}
function ej(b){mj(b,new M("textchanged"))}function kj(b){mj(b,new M("texttrackvisibility"))}function Yi(b){mj(b,new M("abrstatuschanged",{jf:b.b.abr.enabled}))}p.Fa=function(b){if(this.h!=si){var c=new M("error",{detail:b});this.dispatchEvent(c);c.defaultPrevented&&(b.handled=!0)}};function Bi(b,c,d){b.dispatchEvent(new M(c,{detail:{schemeIdUri:d.schemeIdUri,value:d.value,startTime:d.startTime,endTime:d.endTime,id:d.id,eventElement:d.eventElement}}))}
function zi(b){if(!b.a.error)return null;var c=b.a.error.code;if(1==c)return null;var d=b.a.error.msExtendedCode;d&&(0>d&&(d+=Math.pow(2,32)),d=d.toString(16));return new J(2,3,3016,c,d,b.a.error.message)}
function Ei(b,c){if(b.f){var d=Ti(b),e=!1,f=Object.keys(c);0==f.length&&B("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var g=1==f.length&&"00"==f[0];g&&B("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");f.length&&d.variants.forEach(function(b){ve(b).forEach(function(d){var f=
b.allowedByKeySystem;d.keyId&&(d=c[g?"00":d.keyId],b.allowedByKeySystem=!!d&&!ui.includes(d));f!=b.allowedByKeySystem&&(e=!0)})});f=Zg(b.f);var h=ah(b.f);(f=ue(f,h,d.variants))&&!f.allowedByKeySystem&&(D("Choosing new streams after key status changed"),Xi(b,d));e&&(Si(b),Ui(b,d.variants))}}function Fi(b,c,d){if(b.l&&b.l.onExpirationUpdated)b.l.onExpirationUpdated(c,d);b.dispatchEvent(new M("expirationupdated"))}
function Ii(b,c,d){0<c&&(b.$()?B("|playRangeStart| has been configured for live content. Ignoring the setting."):b.sd(c));d<b.Y()&&(b.$()?B("|playRangeEnd| has been configured for live content. Ignoring the setting."):b.Qa(d))}
function lj(b,c){var d=b.g?ac(b.g.ba):{},e=Object.keys(d);e=e.length&&"00"==e[0];for(var f=!1,g=!1,h=[],k=[],l=t(c),m=l.next();!m.done;m=l.next()){m=m.value;var n=[];m.audio&&n.push(m.audio);m.video&&n.push(m.video);n=t(n);for(var q=n.next();!q.done;q=n.next())if(q=q.value,q.keyId){var r=d[e?"00":q.keyId];r?ui.includes(r)&&(k.includes(r)||k.push(r)):h.includes(q.keyId)||h.push(q.keyId)}m.allowedByApplication?m.allowedByKeySystem&&(f=!0):g=!0}if(!f)throw new J(2,4,4012,{hasAppRestrictions:g,missingKeys:h,
restrictedKeyStatuses:k});}function mj(b,c){u(function e(){return y(e,function(e){switch(e.m){case 1:return v(e,Promise.resolve(),2);case 2:b.h!=si&&b.dispatchEvent(c),w(e)}})})}function jj(b){var c=new Set;b=t(b);for(var d=b.next();!d.done;d=b.next())d=d.value,d.language?c.add(P(d.language)):c.add("und");return c}
function ij(b){var c=new Map;b=t(b);for(var d=b.next();!d.done;d=b.next()){var e=d.value;d="und";var f=[];e.language&&(d=P(e.language));"variant"==e.type?f=e.audioRoles:f=e.roles;f&&f.length||(f=[""]);c.has(d)||c.set(d,new Set);e=t(f);for(f=e.next();!f.done;f=e.next())f=f.value,c.get(d).add(f)}var g=[];c.forEach(function(b,c){for(var d=t(b),e=d.next();!e.done;e=d.next())g.push({language:c,role:e.value})});return g}
function $i(b){b=Ti(b);return null==b?[]:b.variants.filter(function(b){return qe(b)})}function bj(b){var c=Ti(b);return null==c?[]:c.textStreams.filter(function(c){return!b.Db.has(c)})}function Ti(b){var c=b.s.h(),d=null;b=t(b.c.periods);for(var e=b.next();!e.done;e=b.next())e=e.value,e.startTime<=c&&(d=e);return d}function Zi(b){var c=Ti(b);return Sf(b.ha,c).variant}
function aj(b){var c=Ti(b);if(null==c)return null;if(!Sf(b.ha,c).text){var d=se(c.textStreams,b.ia,b.Wa);d.length&&Rf(b.ha,c,d[0])}return Sf(b.ha,c).text}function wi(){return new J(2,7,7E3)}function ri(b,c,d,e,f,g){return e==b&&f.o==g.o&&f.uri==g.uri&&f.mimeType==g.mimeType&&f.qa==g.qa?c:d}function Mh(){return{qa:null,o:null,mimeType:null,startTime:null,Gc:null,uri:null}}
function xi(b){return new Promise(function(c,d){b.Pa=function(){return d(wi())};b.Ub=function(){return c()};b.onError=function(b){return d(b)};b.Vb=function(){return d(wi())}})}var si=0,fi=1,Qi=2,Vi=3;Z.LoadMode={DESTROYED:si,NOT_LOADED:fi,MEDIA_SOURCE:Qi,SRC_EQUALS:Vi};z("shaka.polyfill.installAll",function(){for(var b=0;b<nj.length;++b)nj[b].Ad()});var nj=[];function oj(b,c){c=c||0;for(var d={priority:c,Ad:b},e=0;e<nj.length;e++)if(nj[e].priority<c){nj.splice(e,0,d);return}nj.push(d)}z("shaka.polyfill.register",oj);function pj(b,c,d){if("input"==b)switch(this.type){case "range":b="change"}HTMLInputElement.prototype.originalAddEventListener.call(this,b,c,d)}oj(function(){D("InputEvent.install");ic("Trident/")&&!HTMLInputElement.prototype.originalAddEventListener&&(C("Patching input event support on IE."),HTMLInputElement.prototype.originalAddEventListener=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=pj)});oj(function(){navigator.languages||Object.defineProperty(navigator,"languages",{get:function(){return navigator.language?[navigator.language]:["en"]}})});oj(function(){D("mathRound.install")});function qj(){var b=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e]=arguments[e];d=b.apply(this,d);d.abort=function(){};return d}}function rj(){var b=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(c,d){return b.call(this,c,d-.001)}}
function sj(){var b=MediaSource.prototype.endOfStream;MediaSource.prototype.endOfStream=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e]=arguments[e];for(var h=e=0;h<this.sourceBuffers.length;++h){var k=this.sourceBuffers[h];k=k.buffered.end(k.buffered.length-1);e=Math.max(e,k)}if(!isNaN(this.duration)&&e<this.duration)for(this.Wc=!0,e=0;e<this.sourceBuffers.length;++e)this.sourceBuffers[e].Pc=!1;return b.apply(this,d)};var c=!1,d=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=
function(b){for(var e=[],g=0;g<arguments.length;++g)e[g]=arguments[g];e=d.apply(this,e);e.mediaSource_=this;e.addEventListener("updateend",tj,!1);c||(this.addEventListener("sourceclose",uj,!1),c=!0);return e}}function tj(b){var c=b.target,d=c.mediaSource_;if(d.Wc){b.preventDefault();b.stopPropagation();b.stopImmediatePropagation();c.Pc=!0;for(b=0;b<d.sourceBuffers.length;++b)if(0==d.sourceBuffers[b].Pc)return;d.Wc=!1}}
function uj(b){b=b.target;for(var c=0;c<b.sourceBuffers.length;++c)b.sourceBuffers[c].removeEventListener("updateend",tj,!1);b.removeEventListener("sourceclose",uj,!1)}function vj(){var b=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(c){return"mp2t"==c.split(/ *; */)[0].split("/")[1].toLowerCase()?!1:b(c)}}function wj(){var b=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(c){return"opus"!=ec(c)[0]&&b(c)}}
function xj(){var b=MediaSource.isTypeSupported,c=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=function(d){for(var e=d.split(/ *; */),f=e[0],g={},h=1;h<e.length;++h){var k=e[h].split("="),l=k[0];k=k[1].replace(/"(.*)"/,"$1");g[l]=k}e=g.codecs;if(!e)return b(d);var m=!1,n=!1;d=e.split(",").filter(function(b){c.test(b)&&(n=!0);/^(hev|hvc)1\.2/.test(b)&&(m=!0);return!0});n&&(m=!1);g.codecs=d.join(",");m&&(g.eotf="smpte2084");for(var q in g)f+="; "+q+'="'+g[q]+'"';return cast.__platform__.canDisplayType(f)}}
oj(function(){D("MediaSource.install");if(window.MediaSource)if(window.cast&&cast.__platform__&&cast.__platform__.canDisplayType)C("Patching Chromecast MSE bugs."),xj();else if(navigator.vendor&&navigator.vendor.includes("Apple")){var b=navigator.appVersion;vj();if(b.includes("Version/8"))C("Blacklisting Safari 8 MSE."),window.MediaSource=null;else if(b.includes("Version/9"))C("Patching Safari 9 MSE bugs."),qj();else if(b.includes("Version/10"))C("Patching Safari 10 MSE bugs."),qj(),sj();else if(b.includes("Version/11")||
b.includes("Version/12"))C("Patching Safari 11/12 MSE bugs."),qj(),rj()}else ic("Tizen")?wj():C("Using native MSE as-is.");else C("No MSE implementation available.")});function yj(b,c){D("PatchedMediaKeysMs.requestMediaKeySystemAccess");try{var d=new zj(b,c);return Promise.resolve(d)}catch(e){return Promise.reject(e)}}
function zj(b,c){D("PatchedMediaKeysMs.MediaKeySystemAccess");this.keySystem=b;for(var d=!1,e=0;e<c.length;++e){var f=c[e],g={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:f.initDataTypes,sessionTypes:["temporary"],label:f.label},h=!1;if(f.audioCapabilities)for(var k=0;k<f.audioCapabilities.length;++k){var l=f.audioCapabilities[k];if(l.contentType){h=!0;var m=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,
m)&&(g.audioCapabilities.push(l),d=!0)}}if(f.videoCapabilities)for(k=0;k<f.videoCapabilities.length;++k)l=f.videoCapabilities[k],l.contentType&&(h=!0,m=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,m)&&(g.videoCapabilities.push(l),d=!0));h||(d=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4"));"required"==f.persistentState&&(d=!1);if(d){this.a=g;return}}d=Error("Unsupported keySystem");d.name="NotSupportedError";d.code=DOMException.NOT_SUPPORTED_ERR;throw d;}
zj.prototype.createMediaKeys=function(){D("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var b=new Aj(this.keySystem);return Promise.resolve(b)};zj.prototype.getConfiguration=function(){D("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration");return this.a};function Bj(b){D("PatchedMediaKeysMs.setMediaKeys");var c=this.mediaKeys;c&&c!=b&&Cj(c,null);delete this.mediaKeys;return(this.mediaKeys=b)?Cj(b,this):Promise.resolve()}
function Aj(b){D("PatchedMediaKeysMs.MediaKeys");this.a=new MSMediaKeys(b);this.b=new O}Aj.prototype.createSession=function(b){D("PatchedMediaKeysMs.MediaKeys.createSession");b=b||"temporary";if("temporary"!=b)throw new TypeError("Session type "+b+" is unsupported on this platform.");return new Dj(this.a,b)};Aj.prototype.setServerCertificate=function(){D("PatchedMediaKeysMs.MediaKeys.setServerCertificate");return Promise.resolve(!1)};
function Cj(b,c){function d(){c.msSetMediaKeys(e.a);c.removeEventListener("loadedmetadata",d)}b.b.yb();if(!c)return Promise.resolve();b.b.w(c,"msneedkey",Ej);var e=b;try{return 1<=c.readyState?c.msSetMediaKeys(b.a):c.addEventListener("loadedmetadata",d),Promise.resolve()}catch(f){return Promise.reject(f)}}
function Dj(b){D("PatchedMediaKeysMs.MediaKeySession");wb.call(this);this.c=null;this.g=b;this.b=this.a=null;this.f=new O;this.sessionId="";this.expiration=NaN;this.closed=new mb;this.keyStatuses=new Fj}Ka(Dj,wb);p=Dj.prototype;
p.generateRequest=function(b,c){D("PatchedMediaKeysMs.MediaKeySession.generateRequest");this.a=new mb;try{this.c=this.g.createSession("video/mp4",new Uint8Array(c),null),this.f.w(this.c,"mskeymessage",this.oe.bind(this)),this.f.w(this.c,"mskeyadded",this.me.bind(this)),this.f.w(this.c,"mskeyerror",this.ne.bind(this)),Gj(this,"status-pending")}catch(d){this.a.reject(d)}return this.a};p.load=function(){D("PatchedMediaKeysMs.MediaKeySession.load");return Promise.reject(Error("MediaKeySession.load not yet supported"))};
p.update=function(b){D("PatchedMediaKeysMs.MediaKeySession.update");this.b=new mb;try{this.c.update(new Uint8Array(b))}catch(c){this.b.reject(c)}return this.b};p.close=function(){D("PatchedMediaKeysMs.MediaKeySession.close");try{this.c.close(),this.closed.resolve(),this.f.yb()}catch(b){this.closed.reject(b)}return this.closed};p.remove=function(){D("PatchedMediaKeysMs.MediaKeySession.remove");return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))};
function Ej(b){D("PatchedMediaKeysMs.onMsNeedKey_",b);if(b.initData){var c=document.createEvent("CustomEvent");c.initCustomEvent("encrypted",!1,!1,null);c.initDataType="cenc";c.initData=Hj(b.initData);this.dispatchEvent(c)}}
function Hj(b){if(!b)return b;var c=new Ee(b);if(1>=c.a.length)return b;for(var d=[],e=0;e<c.a.length;e++)d.push(b.subarray(c.a[e].start,c.a[e].end+1));b=[];c={};e=t(d);for(d=e.next();!d.done;c={Ob:c.Ob},d=e.next())c.Ob=d.value,b.some(function(b){return function(c){return uc(c,b.Ob)}}(c))||b.push(c.Ob);c=0;e=t(b);for(d=e.next();!d.done;d=e.next())c+=d.value.length;c=new Uint8Array(c);e=0;b=t(b);for(d=b.next();!d.done;d=b.next())d=d.value,c.set(d,e),e+=d.length;return c}
p.oe=function(b){D("PatchedMediaKeysMs.onMsKeyMessage_",b);this.a&&(this.a.resolve(),this.a=null);this.dispatchEvent(new M("message",{messageType:void 0==this.keyStatuses.a?"license-request":"license-renewal",message:b.message.buffer}))};p.me=function(b){D("PatchedMediaKeysMs.onMsKeyAdded_",b);this.a?(D("Simulating completion for a PR persistent license."),Gj(this,"usable"),this.a.resolve(),this.a=null):this.b&&(Gj(this,"usable"),this.b.resolve(),this.b=null)};
p.ne=function(b){D("PatchedMediaKeysMs.onMsKeyError_",b);b=Error("EME PatchedMediaKeysMs key error");b.errorCode=this.c.error;if(null!=this.a)this.a.reject(b),this.a=null;else if(null!=this.b)this.b.reject(b),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:Gj(this,"output-not-allowed");break;default:Gj(this,"internal-error")}};
function Gj(b,c){var d=b.keyStatuses;d.size=void 0==c?0:1;d.a=c;b.dispatchEvent(new M("keystatuseschange"))}function Fj(){this.size=0;this.a=void 0}var Ij;p=Fj.prototype;p.forEach=function(b){this.a&&b(this.a,Ij)};p.get=function(b){if(this.has(b))return this.a};p.has=function(b){var c=Ij;return this.a&&uc(new Uint8Array(b),new Uint8Array(c))?!0:!1};p.entries=function(){};p.keys=function(){};p.values=function(){};
oj(function(){!window.HTMLVideoElement||!window.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(C("Using ms-prefixed EME v20140218"),Ij=(new Uint8Array([0])).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Bj,window.MediaKeys=Aj,window.MediaKeySystemAccess=zj,navigator.requestMediaKeySystemAccess=yj)});function Jj(){D("PatchedMediaKeysNop.requestMediaKeySystemAccess");return Promise.reject(Error("The key system specified is not supported."))}function Kj(b){D("PatchedMediaKeysNop.setMediaKeys");return null==b?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Lj(){throw new TypeError("Illegal constructor.");}Lj.prototype.createSession=function(){};Lj.prototype.setServerCertificate=function(){};function Mj(){throw new TypeError("Illegal constructor.");}
Mj.prototype.getConfiguration=function(){};Mj.prototype.createMediaKeys=function(){};oj(function(){!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(C("EME not available."),navigator.requestMediaKeySystemAccess=Jj,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Kj,window.MediaKeys=Lj,window.MediaKeySystemAccess=Mj)},-10);var Nj="";function Oj(b){var c=Nj;return c?c+b.charAt(0).toUpperCase()+b.slice(1):b}function Pj(b,c){D("PatchedMediaKeysWebkit.requestMediaKeySystemAccess");try{var d=new Qj(b,c);return Promise.resolve(d)}catch(e){return Promise.reject(e)}}function Rj(b){D("PatchedMediaKeysWebkit.setMediaKeys");var c=this.mediaKeys;c&&c!=b&&Sj(c,null);delete this.mediaKeys;(this.mediaKeys=b)&&Sj(b,this);return Promise.resolve()}
function Qj(b,c){D("PatchedMediaKeysWebkit.MediaKeySystemAccess");this.a=this.keySystem=b;var d=!1;"org.w3.clearkey"==b&&(this.a="webkit-org.w3.clearkey",d=!1);var e=!1;var f=document.getElementsByTagName("video");f=f.length?f[0]:document.createElement("video");for(var g=0;g<c.length;++g){var h=c[g],k={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:h.initDataTypes,sessionTypes:["temporary"],label:h.label},l=!1;if(h.audioCapabilities)for(var m=
0;m<h.audioCapabilities.length;++m){var n=h.audioCapabilities[m];if(n.contentType){l=!0;var q=n.contentType.split(";")[0];f.canPlayType(q,this.a)&&(k.audioCapabilities.push(n),e=!0)}}if(h.videoCapabilities)for(m=0;m<h.videoCapabilities.length;++m)n=h.videoCapabilities[m],n.contentType&&(l=!0,f.canPlayType(n.contentType,this.a)&&(k.videoCapabilities.push(n),e=!0));l||(e=f.canPlayType("video/mp4",this.a)||f.canPlayType("video/webm",this.a));"required"==h.persistentState&&(d?(k.persistentState="required",
k.sessionTypes=["persistent-license"]):e=!1);if(e){this.b=k;return}}d="Unsupported keySystem";if("org.w3.clearkey"==b||"com.widevine.alpha"==b)d="None of the requested configurations were supported.";d=Error(d);d.name="NotSupportedError";d.code=DOMException.NOT_SUPPORTED_ERR;throw d;}Qj.prototype.createMediaKeys=function(){D("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var b=new Tj(this.a);return Promise.resolve(b)};
Qj.prototype.getConfiguration=function(){D("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration");return this.b};function Tj(b){D("PatchedMediaKeysWebkit.MediaKeys");this.g=b;this.b=null;this.a=new O;this.c=[];this.f={}}function Sj(b,c){b.b=c;b.a.yb();var d=Nj;c&&(b.a.w(c,d+"needkey",b.ue.bind(b)),b.a.w(c,d+"keymessage",b.te.bind(b)),b.a.w(c,d+"keyadded",b.re.bind(b)),b.a.w(c,d+"keyerror",b.se.bind(b)))}p=Tj.prototype;
p.createSession=function(b){D("PatchedMediaKeysWebkit.MediaKeys.createSession");b=b||"temporary";if("temporary"!=b&&"persistent-license"!=b)throw new TypeError("Session type "+b+" is unsupported on this platform.");var c=this.b||document.createElement("video");c.src||(c.src="about:blank");b=new Uj(c,this.g,b);this.c.push(b);return b};p.setServerCertificate=function(){D("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate");return Promise.resolve(!1)};
p.ue=function(b){D("PatchedMediaKeysWebkit.onWebkitNeedKey_",b);var c=document.createEvent("CustomEvent");c.initCustomEvent("encrypted",!1,!1,null);c.initDataType="webm";c.initData=b.initData;this.b.dispatchEvent(c)};
p.te=function(b){D("PatchedMediaKeysWebkit.onWebkitKeyMessage_",b);var c=Vj(this,b.sessionId);c?(b=new M("message",{messageType:void 0==c.keyStatuses.a?"licenserequest":"licenserenewal",message:b.message}),D("PatchedMediaKeysWebkit.MediaKeySession.generated"),c.b&&(c.b.resolve(),c.b=null),c.dispatchEvent(b)):A("Session not found",b.sessionId)};
p.re=function(b){D("PatchedMediaKeysWebkit.onWebkitKeyAdded_",b);if(b=Vj(this,b.sessionId))D("PatchedMediaKeysWebkit.MediaKeySession.ready"),Wj(b,"usable"),b.a&&b.a.resolve(),b.a=null};p.se=function(b){D("PatchedMediaKeysWebkit.onWebkitKeyError_",b);var c=Vj(this,b.sessionId);c&&c.handleError(b)};function Vj(b,c){var d=b.f[c];return d?(D("PatchedMediaKeysWebkit.MediaKeys.findSession_",d),d):(d=b.c.shift())?(d.sessionId=c,b.f[c]=d,D("PatchedMediaKeysWebkit.MediaKeys.findSession_",d),d):null}
function Uj(b,c,d){D("PatchedMediaKeysWebkit.MediaKeySession");wb.call(this);this.f=b;this.h=!1;this.a=this.b=null;this.c=c;this.g=d;this.sessionId="";this.expiration=NaN;this.closed=new mb;this.keyStatuses=new Xj}Ka(Uj,wb);p=Uj.prototype;
p.handleError=function(b){D("PatchedMediaKeysWebkit.MediaKeySession.handleError",b);var c=Error("EME v0.1b key error");c.errorCode=b.errorCode;c.errorCode.systemCode=b.systemCode;!b.sessionId&&this.b?(c.method="generateRequest",45==b.systemCode&&(c.message="Unsupported session type."),this.b.reject(c),this.b=null):b.sessionId&&this.a?(c.method="update",this.a.reject(c),this.a=null):(c=b.systemCode,b.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Wj(this,"output-restricted"):1==c?Wj(this,"expired"):
Wj(this,"internal-error"))};
function Yj(b,c,d){if(b.h)return Promise.reject(Error("The session is already initialized."));b.h=!0;try{if("persistent-license"==b.g)if(d)var e=new Uint8Array(oc("LOAD_SESSION|"+d));else{var f=oc("PERSISTENT|"),g=new Uint8Array(f.byteLength+c.byteLength);g.set(new Uint8Array(f),0);g.set(new Uint8Array(c),f.byteLength);e=g}else e=new Uint8Array(c)}catch(k){return Promise.reject(k)}b.b=new mb;var h=Oj("generateKeyRequest");try{b.f[h](b.c,e)}catch(k){if("InvalidStateError"!=k.name)return b.b=null,Promise.reject(k);
(new I(function(){try{b.f[h](b.c,e)}catch(l){b.b.reject(l),b.b=null}})).T(.01)}return b.b}
p.Fc=function(b,c){if(this.a)this.a.then(this.Fc.bind(this,b,c))["catch"](this.Fc.bind(this,b,c));else{this.a=b;if("webkit-org.w3.clearkey"==this.c){var d=lc(c);var e=JSON.parse(d);"oct"!=e.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null);d=rc(e.keys[0].k);e=rc(e.keys[0].kid)}else d=new Uint8Array(c),e=null;var f=Oj("addKey");try{this.f[f](this.c,d,e,this.sessionId)}catch(g){this.a.reject(g),this.a=null}}};
function Wj(b,c){var d=b.keyStatuses;d.size=void 0==c?0:1;d.a=c;b.dispatchEvent(new M("keystatuseschange"))}p.generateRequest=function(b,c){D("PatchedMediaKeysWebkit.MediaKeySession.generateRequest");return Yj(this,c,null)};p.load=function(b){D("PatchedMediaKeysWebkit.MediaKeySession.load");return"persistent-license"==this.g?Yj(this,null,b):Promise.reject(Error("Not a persistent session."))};p.update=function(b){D("PatchedMediaKeysWebkit.MediaKeySession.update",b);var c=new mb;this.Fc(c,b);return c};
p.close=function(){D("PatchedMediaKeysWebkit.MediaKeySession.close");if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var b=Oj("cancelKeyRequest");try{this.f[b](this.c,this.sessionId)}catch(c){}}this.closed.resolve();return this.closed};p.remove=function(){D("PatchedMediaKeysWebkit.MediaKeySession.remove");return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()};
function Xj(){this.size=0;this.a=void 0}var Zj;p=Xj.prototype;p.forEach=function(b){this.a&&b(this.a,Zj)};p.get=function(b){if(this.has(b))return this.a};p.has=function(b){var c=Zj;return this.a&&uc(new Uint8Array(b),new Uint8Array(c))?!0:!1};p.entries=function(){};p.keys=function(){};p.values=function(){};
oj(function(){if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)C("Using webkit-prefixed EME v0.1b"),Nj="webkit";else if(HTMLMediaElement.prototype.generateKeyRequest)C("Using nonprefixed EME v0.1b");else return;Zj=(new Uint8Array([0])).buffer;navigator.requestMediaKeySystemAccess=Pj;delete HTMLMediaElement.prototype.mediaKeys;HTMLMediaElement.prototype.mediaKeys=null;HTMLMediaElement.prototype.setMediaKeys=
Rj;window.MediaKeys=Tj;window.MediaKeySystemAccess=Qj}});oj(function(){D("VideoPlayPromise.install");if(window.HTMLMediaElement){var b=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var c=b.apply(this);c&&c["catch"](function(){});return c}}});function ak(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}oj(function(){if(window.HTMLVideoElement){var b=HTMLVideoElement.prototype;!b.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in b&&(b.getVideoPlaybackQuality=ak)}});function bk(b,c,d){return new window.TextTrackCue(b,c,d)}function ck(b,c,d){return new window.TextTrackCue(b+"-"+c+"-"+d,b,c,d)}
oj(function(){if(window.VTTCue)C("Using native VTTCue.");else if(window.TextTrackCue){var b=TextTrackCue.length;if(3==b)C("Using VTTCue polyfill from 3 argument TextTrackCue."),window.VTTCue=bk;else if(6==b)C("Using VTTCue polyfill from 6 argument TextTrackCue."),window.VTTCue=ck;else{try{var c=!!bk(1,2,"")}catch(d){c=!1}c&&(C("Using VTTCue polyfill from 3 argument TextTrackCue."),window.VTTCue=bk)}}else A("VTTCue not available.")});function dk(){}dk.prototype.parseInit=function(){};
dk.prototype.parseMedia=function(b,c){var d=lc(b),e=[],f=new DOMParser,g=null;try{g=f.parseFromString(d,"text/xml")}catch(Va){throw new J(2,2,2005);}if(g){if(g=g.getElementsByTagName("tt")[0]){var h=T.getAttributeNS(g,"http://www.w3.org/ns/ttml#parameter","frameRate");var k=T.getAttributeNS(g,"http://www.w3.org/ns/ttml#parameter","subFrameRate");var l=T.getAttributeNS(g,"http://www.w3.org/ns/ttml#parameter","frameRateMultiplier");var m=T.getAttributeNS(g,"http://www.w3.org/ns/ttml#parameter","tickRate");
d=g.getAttribute("xml:space")||"default";f=g.getAttribute("tts:extent")}else throw new J(2,2,2005);if("default"!=d&&"preserve"!=d)throw new J(2,2,2005);d="default"==d;h=new ek(h,k,l,m);k=fk(g.getElementsByTagName("metadata")[0]);l=fk(g.getElementsByTagName("styling")[0]);m=fk(g.getElementsByTagName("layout")[0]);for(var n=[],q=0;q<m.length;q++){var r=m[q],x=l,E=f;var F=new td;var L=r.getAttribute("xml:id");if(L){F.id=L;L=null;E&&(L=gk.exec(E)||hk.exec(E));E=L?Number(L[1]):null;L=L?Number(L[2]):null;
var V,fa;if(V=ik(r,x,"extent"))V=(fa=gk.exec(V))||hk.exec(V),null!=V&&(F.width=null!=E?100*Number(V[1])/E:Number(V[1]),F.height=null!=L?100*Number(V[2])/L:Number(V[2]),F.widthUnits=fa||null!=E?Gd:0,F.heightUnits=fa||null!=L?Gd:0);if(r=ik(r,x,"origin"))V=(fa=gk.exec(r))||hk.exec(r),null!=V&&(F.viewportAnchorX=null!=L?100*Number(V[1])/L:Number(V[1]),F.viewportAnchorY=null!=E?100*Number(V[2])/E:Number(V[2]),F.viewportAnchorUnits=fa||null!=E?Gd:0)}else B("TtmlTextParser parser encountered a region with no id. Region will be ignored."),
F=null;F&&n.push(F)}f=fk(g.getElementsByTagName("body")[0]);for(g=0;g<f.length;g++)(q=jk(f[g],c.periodStart,h,k,l,m,n,d))&&e.push(q)}return e};
var gk=/^(\d{1,2}|100)% (\d{1,2}|100)%$/,kk=/^(\d+px|\d+em)$/,hk=/^(\d+)px (\d+)px$/,lk=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,mk=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,nk=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,ok=/^(\d*(?:\.\d*)?)f$/,pk=/^(\d*(?:\.\d*)?)t$/,qk=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,rk={left:yd,center:"center",right:"end",start:yd,end:"end"},sk={left:"line-left",center:"center",right:"line-right"};
function fk(b){var c=[];if(!b)return c;for(var d=b.childNodes,e=0;e<d.length;e++){var f="span"==d[e].nodeName&&"p"==b.nodeName;d[e].nodeType!=Node.ELEMENT_NODE||"br"==d[e].nodeName||f||(f=fk(d[e]),c=c.concat(f))}c.length||c.push(b);return c}function tk(b,c){for(var d=b.childNodes,e=0;e<d.length;e++)if("br"==d[e].nodeName&&0<e)d[e-1].textContent+="\n";else if(0<d[e].childNodes.length)tk(d[e],c);else if(c){var f=d[e].textContent.trim();f=f.replace(/\s+/g," ");d[e].textContent=f}}
function jk(b,c,d,e,f,g,h,k){if(!b.hasAttribute("begin")&&!b.hasAttribute("end")&&/^\s*$/.test(b.textContent))return null;tk(b,k);k=uk(b.getAttribute("begin"),d);var l=uk(b.getAttribute("end"),d);d=uk(b.getAttribute("dur"),d);var m=b.textContent;null==l&&null!=d&&(l=k+d);if(null==k||null==l)throw new J(2,2,2001);c=new rd(k+c,l+c,m);if((g=vk(b,"region",g,""))&&g.getAttribute("xml:id")){var n=g.getAttribute("xml:id");h=h.filter(function(b){return b.id==n});c.region=h[0]}e=vk(b,"smpte:backgroundImage",
e,"#");wk(c,b,g,e,f);return c}
function wk(b,c,d,e,f){"rtl"==xk(c,d,f,"direction")&&(b.direction="rtl");var g=xk(c,d,f,"writingMode");"tb"==g||"tblr"==g?b.writingMode="vertical-lr":"tbrl"==g?b.writingMode="vertical-rl":"rltb"==g||"rl"==g?b.direction="rtl":g&&(b.direction=sd);if(g=xk(c,d,f,"textAlign"))b.positionAlign=sk[g],b.lineAlign=rk[g],b.textAlign=Cd[g.toUpperCase()];if(g=xk(c,d,f,"displayAlign"))b.displayAlign=Dd[g.toUpperCase()];if(g=xk(c,d,f,"color"))b.color=g;if(g=xk(c,d,f,"backgroundColor"))b.backgroundColor=g;if(g=xk(c,
d,f,"fontFamily"))b.fontFamily=g;(g=xk(c,d,f,"fontWeight"))&&"bold"==g&&(b.fontWeight=700);(g=xk(c,d,f,"wrapOption"))&&"noWrap"==g&&(b.wrapLine=!1);(g=xk(c,d,f,"lineHeight"))&&g.match(kk)&&(b.lineHeight=g);(g=xk(c,d,f,"fontSize"))&&g.match(kk)&&(b.fontSize=g);if(g=xk(c,d,f,"fontStyle"))b.fontStyle=Fd[g.toUpperCase()];if(e){g=e.getAttribute("imagetype");var h=e.getAttribute("encoding");e=e.textContent.trim();"PNG"==g&&"Base64"==h&&e&&(b.backgroundImage="data:image/png;base64,"+e)}(d=ik(d,f,"textDecoration"))&&
yk(b,d);(c=zk(c,f,"textDecoration"))&&yk(b,c)}
function yk(b,c){for(var d=c.split(" "),e=0;e<d.length;e++)switch(d[e]){case "underline":b.textDecoration.includes("underline")||b.textDecoration.push("underline");break;case "noUnderline":b.textDecoration.includes("underline")&&yb(b.textDecoration,"underline");break;case "lineThrough":b.textDecoration.includes("lineThrough")||b.textDecoration.push("lineThrough");break;case "noLineThrough":b.textDecoration.includes("lineThrough")&&yb(b.textDecoration,"lineThrough");break;case "overline":b.textDecoration.includes("overline")||
b.textDecoration.push("overline");break;case "noOverline":b.textDecoration.includes("overline")&&yb(b.textDecoration,"overline")}}function xk(b,c,d,e){return(b=zk(b,d,e))?b:ik(c,d,e)}function ik(b,c,d){for(var e=fk(b),f=0;f<e.length;f++){var g=T.getAttributeNS(e[f],"http://www.w3.org/ns/ttml#styling",d);if(g)return g}return(b=vk(b,"style",c,""))?T.getAttributeNS(b,"http://www.w3.org/ns/ttml#styling",d):null}
function zk(b,c,d){return(b=vk(b,"style",c,""))?T.getAttributeNS(b,"http://www.w3.org/ns/ttml#styling",d):null}function vk(b,c,d,e){if(!b||1>d.length)return null;var f=null,g=b;for(b=null;g&&!(b=g.getAttribute(c))&&(g=g.parentNode,g instanceof Element););if(c=b)for(b=0;b<d.length;b++)if(e+d[b].getAttribute("xml:id")==c){f=d[b];break}return f}
function uk(b,c){var d=null;if(lk.test(b)){d=lk.exec(b);var e=Number(d[1]),f=Number(d[2]),g=Number(d[3]),h=Number(d[4]);h+=(Number(d[5])||0)/c.b;g+=h/c.frameRate;d=g+60*f+3600*e}else mk.test(b)?d=Ak(mk,b):nk.test(b)?d=Ak(nk,b):ok.test(b)?(d=ok.exec(b),d=Number(d[1])/c.frameRate):pk.test(b)?(d=pk.exec(b),d=Number(d[1])/c.a):qk.test(b)&&(d=Ak(qk,b));return d}
function Ak(b,c){var d=b.exec(c);return null==d||""==d[0]?null:(Number(d[4])||0)/1E3+(Number(d[3])||0)+60*(Number(d[2])||0)+3600*(Number(d[1])||0)}function ek(b,c,d,e){this.frameRate=Number(b)||30;this.b=Number(c)||1;this.a=Number(e);0==this.a&&(this.a=b?this.frameRate*this.b:1);d&&(b=/^(\d+) (\d+)$/g.exec(d))&&(this.frameRate*=Number(b[1])/Number(b[2]))}Jd["application/ttml+xml"]=dk;function Bk(){this.a=new dk}Bk.prototype.parseInit=function(b){var c=!1;(new S).K("moov",Be).K("trak",Be).K("mdia",Be).K("minf",Be).K("stbl",Be).ra("stsd",Ce).K("stpp",function(b){c=!0;b.parser.stop()}).parse(b);if(!c)throw new J(2,2,2007);};Bk.prototype.parseMedia=function(b,c){var d=!1,e=[];(new S).K("mdat",De(function(b){d=!0;e=e.concat(this.a.parseMedia(b,c))}.bind(this))).parse(b);if(!d)throw new J(2,2,2007);return e};Jd['application/mp4; codecs="stpp"']=Bk;
Jd['application/mp4; codecs="stpp.TTML.im1t"']=Bk;function Ck(b){this.b=b;this.a=0}function Dk(b){Ek(b,/[ \t]+/gm)}function Ek(b,c){c.lastIndex=b.a;var d=c.exec(b.b);d=null==d?null:{position:d.index,length:d[0].length,Ie:d};if(b.a==b.b.length||null==d||d.position!=b.a)return null;b.a+=d.length;return d.Ie}function Fk(b){return b.a==b.b.length?null:(b=Ek(b,/[^ \t\n]*/gm))?b[0]:null};function Gk(){}Gk.prototype.parseInit=function(){};
Gk.prototype.parseMedia=function(b,c){var d=lc(b);d=d.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n");d=d.split(/\n{2,}/m);if(!/^WEBVTT($|[ \t\n])/m.test(d[0]))throw new J(2,2,2E3);var e=c.segmentStart;if(null==e&&(e=0,d[0].includes("X-TIMESTAMP-MAP"))){var f=d[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),g=d[0].match(/MPEGTS:(\d+)/m);if(f&&g){e=Hk(new Ck(f[1]));if(null==e)throw new J(2,2,2E3);e=c.periodStart+(Number(g[1])/9E4-e)}}g=[];var h=d[0].split("\n");for(f=1;f<h.length;f++)if(/^Region:/.test(h[f])){var k=
new Ck(h[f]),l=new td;Fk(k);Dk(k);for(var m=Fk(k);m;){var n;a:{var q=l,r=m;if(n=/^id=(.*)$/.exec(r))q.id=n[1];else if(n=/^width=(\d{1,2}|100)%$/.exec(r))q.width=Number(n[1]);else if(n=/^lines=(\d+)$/.exec(r))q.height=Number(n[1]),q.heightUnits=2;else if(n=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(r))q.regionAnchorX=Number(n[1]),q.regionAnchorY=Number(n[2]);else if(n=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(r))q.viewportAnchorX=Number(n[1]),q.viewportAnchorY=Number(n[2]);else if(/^scroll=up$/.exec(r))q.scroll=
"up";else{n=!1;break a}n=!0}n||B("VTT parser encountered an invalid VTTRegion setting: ",m," The setting will be ignored.");Dk(k);m=Fk(k)}g.push(l)}f=[];for(k=1;k<d.length;k++){h=d[k].split("\n");n=h;q=e;h=g;if(1==n.length&&!n[0]||/^NOTE($|[ \t])/.test(n[0])||"STYLE"==n[0])h=null;else{l=null;n[0].includes("--\x3e")||(l=n[0],n.splice(0,1));m=new Ck(n[0]);r=Hk(m);var x=Ek(m,/[ \t]+--\x3e[ \t]+/g),E=Hk(m);if(null==r||null==x||null==E)throw new J(2,2,2001);n=new rd(r+q,E+q,n.slice(1).join("\n").trim());
Dk(m);for(q=Fk(m);q;)Ik(n,q,h)||B("VTT parser encountered an invalid VTT setting: ",q," The setting will be ignored."),Dk(m),q=Fk(m);null!=l&&(n.id=l);h=n}h&&f.push(h)}return f};
function Ik(b,c,d){var e;if(e=/^align:(start|middle|center|end|left|right)$/.exec(c))c=e[1],"middle"==c?b.textAlign=vd:b.textAlign=Cd[c.toUpperCase()];else if(e=/^vertical:(lr|rl)$/.exec(c))b.writingMode="lr"==e[1]?"vertical-lr":"vertical-rl";else if(e=/^size:([\d.]+)%$/.exec(c))b.size=Number(e[1]);else if(e=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(c))b.position=Number(e[1]),e[2]&&(c=e[2],b.positionAlign="line-left"==c||"start"==c?"line-left":"line-right"==c||"end"==
c?"line-right":"center");else if(e=/^region:(.*)$/.exec(c)){if(c=Jk(d,e[1]))b.region=c}else{a:{if(d=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(c))b.lineInterpretation=1,b.line=Number(d[1]),d[2]&&(b.lineAlign=Ed[d[2].toUpperCase()]);else if(d=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(c))b.lineInterpretation=xd,b.line=Number(d[1]),d[2]&&(b.lineAlign=Ed[d[2].toUpperCase()]);else{b=!1;break a}b=!0}return b}return!0}
function Jk(b,c){var d=b.filter(function(b){return b.id==c});return d.length?d[0]:(B("VTT parser could not find a region with id: ",c," The region will be ignored."),null)}function Hk(b){b=Ek(b,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g);if(null==b)return null;var c=Number(b[2]),d=Number(b[3]);return 59<c||59<d?null:Number(b[4])/1E3+d+60*c+3600*(Number(b[1])||0)}Jd["text/vtt"]=Gk;Jd['text/vtt; codecs="vtt"']=Gk;function Kk(){this.a=null}Kk.prototype.parseInit=function(b){var c=!1;(new S).K("moov",Be).K("trak",Be).K("mdia",Be).ra("mdhd",function(b){0==b.version?(b.reader.H(4),b.reader.H(4),this.a=b.reader.F(),b.reader.H(4)):(b.reader.H(8),b.reader.H(8),this.a=b.reader.F(),b.reader.H(8));b.reader.H(4)}.bind(this)).K("minf",Be).K("stbl",Be).ra("stsd",Ce).K("wvtt",function(){c=!0}).parse(b);if(!this.a)throw new J(2,2,2008);if(!c)throw new J(2,2,2008);};
Kk.prototype.parseMedia=function(b,c){var d=this;if(!this.a)throw A("No init segment for MP4+VTT!"),new J(2,2,2008);var e=0,f=[],g,h=[],k=!1,l=!1,m=!1,n=null;(new S).K("moof",Be).K("traf",Be).ra("tfdt",function(b){k=!0;e=0==b.version?b.reader.F():b.reader.xb()}).ra("tfhd",function(b){var c=b.flags;b=b.reader;b.H(4);c&1&&b.H(8);c&2&&b.H(4);n=c&8?b.F():null}).ra("trun",function(b){l=!0;var c=b.version,d=b.flags;b=b.reader;var e=b.F();d&1&&b.H(4);d&4&&b.H(4);for(var g=[],h=0;h<e;h++){var k={duration:null,
sampleSize:null,Hc:null};d&256&&(k.duration=b.F());d&512&&(k.sampleSize=b.F());d&1024&&b.H(4);d&2048&&(k.Hc=0==c?b.F():b.hd());g.push(k)}f=g}).K("mdat",De(function(b){m=!0;g=b})).parse(b);if(!m&&!k&&!l)throw new J(2,2,2008);var q=e,r=new DataView(g.buffer,g.byteOffset,g.byteLength),x=new R(r,0);f.forEach(function(b){var f=b.duration||n,g=b.Hc?e+b.Hc:q;q=g+(f||0);var k=0;do{var l=x.F();k+=l;var m=x.F();m=Ae(m);var r=null;"vttc"==m?8<l&&(r=x.ob(l-8)):("vtte"!=m&&A("Unknown box "+m+"! Skipping!"),x.H(l-
8));f?r&&h.push(Lk(r,c.periodStart+g/d.a,c.periodStart+q/d.a)):A("WVTT sample duration unknown, and no default found!")}while(b.sampleSize&&k<b.sampleSize)});return h.filter(id.Ba)};function Lk(b,c,d){var e,f,g;(new S).K("payl",De(function(b){e=lc(b)})).K("iden",De(function(b){f=lc(b)})).K("sttg",De(function(b){g=lc(b)})).parse(b);return e?Mk(e,f,g,c,d):null}
function Mk(b,c,d,e,f){b=new rd(e,f,b);c&&(b.id=c);if(d)for(c=new Ck(d),d=Fk(c);d;)Ik(b,d,[])||B("VTT parser encountered an invalid VTT setting: ",d," The setting will be ignored."),Dk(c),d=Fk(c);return b}Jd['application/mp4; codecs="wvtt"']=Kk;z("shaka.util.Dom.createHTMLElement",function(b){return document.createElement(b)});z("shaka.util.Dom.createVideoElement",function(){var b=document.createElement("video");b.muted=!0;b.width=600;b.height=400;return b});z("shaka.util.Dom.asHTMLElement",function(b){return b});z("shaka.util.Dom.asHTMLMediaElement",function(b){return b});z("shaka.util.Dom.removeAllChildren",function(b){for(;b.firstChild;)b.removeChild(b.firstChild)});}).call(exportTo,innerGlobal,innerGlobal);if(typeof exports!="undefined")for(var k in exportTo.shaka)exports[k]=exportTo.shaka[k];else if(typeof define!="undefined"&&define.amd)define(function(){return exportTo.shaka});else innerGlobal.shaka=exportTo.shaka})();

//# sourceMappingURL=shaka-player.compiled.js.map