<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shaka</title>
    <style>
        #video {
            background: #333;
        }
    </style>
    <!--<script src="https://betastatic.yastatic.net/shaka-player/2.4.6-yandex-patched/shaka-player.compiled.js"></script>-->
<!--    <script src="https://yastatic.net/shaka-player/2.5.5-yandex-patched-1795-2180/shaka-player.compiled.js"></script>-->
    <script src="/dist/shaka-player.compiled.modern.js"></script>
    <script>
        // var manifestUri = 'https://stream-player-js.s3.mds.yandex.net/dash-best-offer/manifest.mpd';
        // var manifestUri = 'http://livesim.dashif.org/livesim/testpic_2s/Manifest.mpd';
        var manifestUri = 'https://strm.yandex.ru/kal/sibir/manifest.mpd';

        function initApp() {
            shaka.polyfill.installAll();
            if (shaka.Player.isBrowserSupported()) {
                initPlayer();
            } else {
                console.log('DASH: BROWSER NOT SUPPORTED!');
            }
        }

        function initPlayer() {
            var video = document.getElementById('video');
            var player = new shaka.Player(video);

            // player.configure({
            //   streaming: {
            //     retryParameters: {
            //       timeout: 100,
            //       maxAttempts: 100,
            //
            //     }
            //   }
            // })

            window.player = player;
            player.addEventListener('error', onErrorEvent);
            player.load(manifestUri).then(function() {
                console.log('The video has now been loaded!');
            }).catch(onError);
        }

        function onErrorEvent(event) {
            onError(event.detail);
        }

        function onError(error) {
            console.error('Error code', error.code, 'object', error);
            debugger;
        }

        window.addEventListener("load", function load(e){
            console.log('load');
            initApp();
        }, false);
    </script>
</head>
<body>
<video id="video"
       width="640"
       poster="//shaka-player-demo.appspot.com/assets/poster.jpg"
       controls autoplay></video>
</body>
</html>
